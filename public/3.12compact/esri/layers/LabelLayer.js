// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.12/esri/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(w,x,y,E,F,C,D,d){w=w(d,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(b,a){b&&x.isString(b)&&(this._url=D.urlToObject(this.url=b));a&&a.requestOptions&&(this.requestOptions=a.requestOptions);this.normalization=!0;this._errorHandler=x.hitch(this,this._errorHandler);
this.registerConnectEvents()},_useSSL:function(){var b=this._url,a=/^http:/i;this.url&&(this.url=this.url.replace(a,"https:"));b&&b.path&&(b.path=b.path.replace(a,"https:"))},_encode:function(b,a,d){var c,f,h={},e,k;for(e in b)if("declaredClass"!==e&&(c=b[e],f=typeof c,null!==c&&void 0!==c&&"function"!==f))if(x.isArray(c)){h[e]=[];k=c.length;for(f=0;f<k;f++)h[e][f]=this._encode(c[f])}else"object"===f?c.toJson&&(f=c.toJson(d&&d[e]),"esri.tasks.FeatureSet"===c.declaredClass&&f.spatialReference&&(f.sr=
f.spatialReference,delete f.spatialReference),h[e]=a?f:y.toJson(f)):h[e]=c;return h},_successHandler:function(b,a,d,c){a&&this[a].apply(this,b);d&&d.apply(null,b);c&&C._resDfd(c,b)},_errorHandler:function(b,a,d){this.onError(b);a&&a(b);d&&d.errback(b)},setNormalization:function(b){this.normalization=b},onError:function(){}});E("extend-esri")&&(F.Task=w);return w})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(w,x,y,E,F,C,D,d,b,a,g,c,f){w=w(c,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(a,b){this._handler=x.hitch(this,this._handler);this._relationshipQueryHandler=x.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=x.hitch(this,this._executeForIdsHandler);this._countHandler=x.hitch(this,this._countHandler);
this._extentHandler=x.hitch(this,this._extentHandler);this.source=b&&b.source;this.gdbVersion=b&&b.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},
onExecuteForExtentComplete:function(){},execute:function(a,b,c,m,n){var l=n.assembly;a=this._encode(x.mixin({},this._url.query,{f:"json"},a.toJson(l&&l[0])));var f=this._handler,g=this._errorHandler;this.source&&(l={source:this.source.toJson()},a.layer=F.toJson(l));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,m){f(a,m,b,c,n.dfd)},error:function(a){g(a,c,n.dfd)},callbackSuffix:m},this.requestOptions)},executeRelationshipQuery:function(a,
c,f){a=this._encode(x.mixin({},this._url.query,{f:"json"},a.toJson()));var m=this._relationshipQueryHandler,n=this._errorHandler;this.gdbVersion&&(a.gdbVersion=this.gdbVersion);var l=new E(b._dfdCanceller);l._pendingDfd=d({url:this._url.path+"/queryRelatedRecords",content:a,callbackParamName:"callback",load:function(a,b){m(a,b,c,f,l)},error:function(a){n(a,f,l)}},this.requestOptions);return l},executeForIds:function(a,b,c,m){var n=m.assembly;a=this._encode(x.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
a.toJson(n&&n[0])));var l=this._executeForIdsHandler,f=this._errorHandler;this.source&&(n={source:this.source.toJson()},a.layer=F.toJson(n));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,d){l(a,d,b,c,m.dfd)},error:function(a){f(a,c,m.dfd)}},this.requestOptions)},executeForCount:function(a,b,c,m){var n=m.assembly;a=this._encode(x.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(n&&
n[0])));var l=this._countHandler,f=this._errorHandler;this.source&&(n={source:this.source.toJson()},a.layer=F.toJson(n));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,d){l(a,d,b,c,m.dfd)},error:function(a){f(a,c,m.dfd)}},this.requestOptions)},executeForExtent:function(a,b,c,m){var n=m.assembly;a=this._encode(x.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(n&&n[0])));
var l=this._extentHandler,f=this._errorHandler;this.source&&(n={source:this.source.toJson()},a.layer=F.toJson(n));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return d({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,d){l(a,d,b,c,m.dfd)},error:function(a){f(a,c,m.dfd)}},this.requestOptions)},_handler:function(a,b,c,m,d){try{var l=new f(a);this._successHandler([l],"onComplete",c,d)}catch(g){this._errorHandler(g,m,d)}},_relationshipQueryHandler:function(a,b,c,d,
n){try{var l=a.geometryType,g=a.spatialReference,s={};y.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=l;b.spatialReference=g;b.features=a.relatedRecords;b=new f(b);if(null!=a.objectId)s[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&"relatedRecords"!==c&&(s[a[c]]=b)});this._successHandler([s],"onExecuteRelationshipQueryComplete",c,n)}catch(r){this._errorHandler(r,d,n)}},_executeForIdsHandler:function(a,b,c,d,f){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",
c,f)}catch(l){this._errorHandler(l,d,f)}},_countHandler:function(a,b,c,d,f){try{var l,g=a.features,s=a.objectIds;if(s)l=s.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");l=a.count}this._successHandler([l],"onExecuteForCountComplete",c,f)}catch(r){this._errorHandler(r,d,f)}},_extentHandler:function(b,c,d,m,f){try{b.extent&&(b.extent=new a(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",d,f)}catch(l){this._errorHandler(l,m,f)}}});g._createWrappers(w);
C("extend-esri")&&x.setObject("tasks.QueryTask",w,D);return w})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(w,x,y,E){w=w(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});
y("extend-esri")&&x.setObject("tasks.StatisticDefinition",w,E);return w})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../GraphicsLayer ../../geometry/Extent ../../geometry/Polygon".split(" "),function(w,x,y,E,F,C,D){w=w(F,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=
1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=0.75},setMap:function(d,b){this._labelLayer=b;this._map=d;this._xmin=d.extent.xmin;this._xmax=d.extent.xmax;this._ymin=d.extent.ymin;this._ymax=d.extent.ymax;this._scale=(this._xmax-this._xmin)/d.width},_process:function(d){var b,a,g,c,f,h,e,k;this._preparedLabels=d;this._placedLabels=[];for(d=this._preparedLabels.length-1;0<=d;d--){b=this._preparedLabels[d];c=b.labelWidth;f=b.labelHeight;e=(h=b.options)&&void 0!==
h.lineLabelPlacement?h.lineLabelPlacement:"PlaceAtCenter";k=h&&void 0!==h.lineLabelPosition?h.lineLabelPosition:"Above";a=h&&void 0!==h.labelRotation?h.labelRotation:!0;g=b.angle*(Math.PI/180);var m=[];if("point"===b.geometry.type)this._generatePointPositions(b.geometry.x,b.geometry.y,b.text,g,c,f,b.symbolWidth,b.symbolHeight,h,m);else if("multipoint"===b.geometry.type)for(a=0;a<b.geometry.points.length;a++)this._generatePointPositions(b.geometry.points[a][0],b.geometry.points[a][1],b.text,g,c,f,
b.symbolWidth,b.symbolHeight,h,m);else if("polyline"===b.geometry.type)if("PlaceAtStart"===e)this._generateLinePositionsPlaceAtStart(b.geometry,!0,b.text,c,f,2*b.symbolHeight+f,e,k,a,m);else if("PlaceAtEnd"===e)this._generateLinePositionsPlaceAtEnd(b.geometry,!0,b.text,c,f,2*b.symbolHeight+f,e,k,a,m);else{h=[];var n=b.geometry.getExtent(),l=this._map.extent;n.getWidth()<c*this._scale&&n.getHeight()<c*this._scale||(0.5*n.getWidth()<l.getWidth()&&0.5*n.getHeight()<l.getHeight()?(l=0.1*Math.min(this._map.width,
this._map.height)*this._scale,this._generateLinePositionsPlaceAtCenter(b.geometry,!1,l,b.text,c,f,2*b.symbolHeight+f,e,k,a,h)):(l=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,this._generateLinePositionsPlaceAtCenter(b.geometry,!0,l,b.text,c,f,2*b.symbolHeight+f,e,k,a,h)));this._postSorting(n,h,m)}else if("polygon"===b.geometry.type)for(a=0;a<b.geometry.rings.length;a++){e=b.geometry.rings[a];for(var l=n=h=k=null,p=0;p<e.length;p++){var s=e[p][0],r=e[p][1];null===k&&
(k=s);null===n&&(n=s);null===h&&(h=r);null===l&&(l=r);s<k&&(k=s);s>n&&(n=s);r<h&&(h=r);r>l&&(l=r)}n-k<4*c*this._scale&&l-h<4*f*this._scale||D.prototype.isClockwise(e)&&this._generatePolygonPositionsForManyLabels(e,b.geometry.spatialReference,b.text,g,c,f,m)}for(a=0;a<m.length;a++)e=m[a].x,k=m[a].y,void 0!==m[a].angle&&(g=m[a].angle),this._findPlace(b,b.text,e,k,g,c,f)}return this._placedLabels},_generatePointPositions:function(d,b,a,g,c,f,h,e,k,m){a=k&&k.pointPriorities?k.pointPriorities:"AboveRight";
c=(h+c)*this._scale;f=(e+f)*this._scale;switch(a.toLowerCase()){case "aboveleft":d-=c;b+=f;break;case "abovecenter":b+=f;break;case "aboveright":d+=c;b+=f;break;case "centerleft":d-=c;break;case "centercenter":break;case "centerright":d+=c;break;case "belowleft":d-=c;b-=f;break;case "belowcenter":b-=f;break;case "belowright":d+=c;b-=f;break;default:return}m.push({x:d,y:b})},_generateLinePositionsPlaceAtStart:function(d,b,a,g,c,f,h,e,k,m){h=g*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,
this._map.height)*this._scale,l,p,s,r,t,u,q,A;for(l=0;l<d.paths.length;l++){var v=d.paths[l],B=h,z=0;for(p=0;p<v.length-1;p++)s=v[p][0],r=v[p][1],t=v[p+1][0],u=v[p+1][1],q=t-s,A=u-r,q=Math.sqrt(q*q+A*A),z+q>B?(z=this._generatePositionsOnLine(d.spatialReference,b,B,n,z,s,r,t,u,a,g,c,f,e,k,m),B=n):z+=q}},_generateLinePositionsPlaceAtEnd:function(d,b,a,g,c,f,h,e,k,m){h=g*this._scale;var n=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,p,s,r,t,u,q,A;for(l=0;l<d.paths.length;l++){var v=
d.paths[l],B=h,z=0;for(p=v.length-2;0<=p;p--)s=v[p+1][0],r=v[p+1][1],t=v[p][0],u=v[p][1],q=t-s,A=u-r,q=Math.sqrt(q*q+A*A),z+q>B?(z=this._generatePositionsOnLine(d.spatialReference,b,B,n,z,s,r,t,u,a,g,c,f,e,k,m),B=n):z+=q}},_generateLinePositionsPlaceAtCenter:function(d,b,a,g,c,f,h,e,k,m,n){var l,p,s,r,t,u,q,A;for(e=0;e<d.paths.length;e++){var v=d.paths[e];if(!(2>v.length)){var B=0;for(l=0;l<v.length-1;l++)s=v[l][0],r=v[l][1],t=v[l+1][0],u=v[l+1][1],q=t-s,A=u-r,B+=Math.sqrt(q*q+A*A);var z=0;for(l=
0;l<v.length-1;l++){s=v[l][0];r=v[l][1];t=v[l+1][0];u=v[l+1][1];q=t-s;A=u-r;q=Math.sqrt(q*q+A*A);if(z+q>B/2)break;z+=q}l==v.length-1&&l--;s=v[l][0];r=v[l][1];t=v[l+1][0];u=v[l+1][1];q=t-s;A=u-r;z=B/2-z;A=Math.atan2(A,q);q=s+z*Math.cos(A);A=r+z*Math.sin(A);s=this._angleAndShifts(s,r,t,u,h,k,m);n.push({x:q+s.shiftX,y:A+s.shiftY,angle:s.angle});var B=q,G=A,z=0;for(p=l;p<v.length-1;p++)p==l?(s=B,r=G):(s=v[p][0],r=v[p][1]),t=v[p+1][0],u=v[p+1][1],q=t-s,A=u-r,q=Math.sqrt(q*q+A*A),z=z+q>a?this._generatePositionsOnLine(d.spatialReference,
b,a,a,z,s,r,t,u,g,c,f,h,k,m,n):z+q;z=0;for(p=l;0<=p;p--)p==l?(s=B,r=G):(s=v[p+1][0],r=v[p+1][1]),t=v[p][0],u=v[p][1],q=t-s,A=u-r,q=Math.sqrt(q*q+A*A),z=z+q>a?this._generatePositionsOnLine(d.spatialReference,b,a,a,z,s,r,t,u,g,c,f,h,k,m,n):z+q}}},_generatePositionsOnLine:function(d,b,a,g,c,f,h,e,k,m,n,l,p,s,r,t){m=Math.atan2(k-h,e-f);n=f;l=h;var u=n,q=l;do if(c=a-c,n+=c*Math.cos(m),l+=c*Math.sin(m),this._belongs(n,l,f,h,e,k))c=this._angleAndShifts(f,h,e,k,p,s,r),a=n+c.shiftX,q=l+c.shiftY,b?this._labelLayer._isWithinScreenArea(new C(a,
q,a,q,d))&&t.push({x:a,y:q,angle:c.angle}):t.push({x:a,y:q,angle:c.angle}),u=n,q=l,c=0,a=g;else return d=e-u,k-=q,Math.sqrt(d*d+k*k);while(1)},_postSorting:function(d,b,a){if(d&&0<b.length){var g=0.5*(d.xmin+d.xmax);d=0.5*(d.ymin+d.ymax);for(var c=b[0].x,f=b[0].y,h=Math.sqrt((c-g)*(c-g)+(f-d)*(f-d)),e=b[0].angle,k=0;k<b.length;k++){var m=b[k].x,n=b[k].y,l=Math.sqrt((m-g)*(m-g)+(n-d)*(n-d));l<h&&(c=m,f=n,h=l,e=b[k].angle)}a.push({x:c,y:f,angle:e})}},_belongs:function(d,b,a,g,c,f){if(c==a&&f==g)return!1;
if(c>a){if(d>c||d<a)return!1}else if(d<c||d>a)return!1;if(f>g){if(b>f||b<g)return!1}else if(b<f||b>g)return!1;return!0},_angleAndShifts:function(d,b,a,g,c,f,h){for(d=Math.atan2(g-b,a-d);d>Math.PI/2;)d-=Math.PI;for(;d<-(Math.PI/2);)d+=Math.PI;g=Math.sin(d);var e=Math.cos(d);a=b=0;"Above"==f&&(b=c*g*this._scale,a=c*e*this._scale);"Below"==f&&(b=-c*g*this._scale,a=-c*e*this._scale);c=[];c.angle=h?-d:0;c.shiftX=-b;c.shiftY=a;return c},_generatePolygonPositionsForManyLabels:function(d,b,a,g,c,f,h){g=this._calcRingExtent(d);
if(0.75*(g.xmax-g.xmin)>this._map.width*this._scale||0.75*(g.ymax-g.ymin)>this._map.height*this._scale){var e=this._findCentroidForRing(d);f=this._map.width*this._scale<g.xmax-g.xmin?this._POLYGON_X_STEP_CONST*this._map.width*this._scale:this._POLYGON_X_STEP_CONST*(g.xmax-g.xmin);c=this._map.height*this._scale<g.ymax-g.ymin?this._POLYGON_Y_STEP_CONST*this._map.height*this._scale:this._POLYGON_Y_STEP_CONST*(g.ymax-g.ymin);var k=e[0]-Math.round((e[0]-g.xmin)/f)*f,m=e[1]-Math.round((e[1]-g.ymin)/c)*
c,n,e=!0;for(n=m;n<g.ymax;n+=c)if(e=!e,!(n<this._ymin||n>this._ymax))for(m=k+(e?0:f/2);m<g.xmax;m+=f)this._labelLayer._isWithinScreenArea(new C(m,n,m,n,b))&&this._isPointWithinRing(a,d,m,n)&&h.push({x:m,y:n})}else{e=this._findCentroidForRing(d);for(g=0;10>g;g++)if(c=e[0],k=e[1]+(g%2?-1:1)*Math.floor(g/2)*f*this._scale,this._labelLayer._isWithinScreenArea(new C(c,k,c,k,b))&&this._isPointWithinRing(a,d,c,k)){h.push({x:c,y:k});break}}},_calcRingExtent:function(d){var b,a;a=new C;for(b=0;b<d.length-1;b++){var g=
d[b][0],c=d[b][1];if(void 0===a.xmin||g<a.xmin)a.xmin=g;if(void 0===a.ymin||c<a.ymin)a.ymin=c;if(void 0===a.xmax||g>a.xmax)a.xmax=g;if(void 0===a.ymax||c>a.ymax)a.ymax=c}return a},_isPointWithinPolygon:function(d,b,a,g){var c;for(c=0;c<b.rings.length;c++)if(this._isPointWithinRing(d,b.rings[c],a,g))return!0;return!1},_isPointWithinRing:function(d,b,a,g){var c,f,h,e,k=[],m=b.length;for(d=0;d<m-1;d++)if(c=b[d][0],f=b[d][1],h=b[d+1][0],e=b[d+1][1],!(c==h&&f==e)){if(f==e)if(g==f)k.push(c);else continue;
c==h?(f<e&&(g>=f&&g<e)&&k.push(c),f>e&&(g<=f&&g>e)&&k.push(c)):(f=(h-c)/(e-f)*(g-f)+c,c<h&&(f>=c&&f<h)&&k.push(f),c>h&&(f<=c&&f>h)&&k.push(f))}k.sort(function(a,b){return a-b});for(d=0;d<k.length-1;d++)if(c=k[d],h=k[d+1],a>=c&&a<h)if(d%2)break;else return!0;return!1},_findCentroidForRing:function(d){for(var b=d.length,a=[0,0],g=0,c=d[0][0],f=d[0][1],h=1;h<b-1;h++){var e=d[h][0],k=d[h][1],m=d[h+1][0],n=d[h+1][1],l=(e-c)*(n-f)-(m-c)*(k-f);a[0]+=l*(c+e+m);a[1]+=l*(f+k+n);g+=l}a[0]/=3*g;a[1]/=3*g;return a},
_findCentroidForFeature:function(d){for(var b=0,a=[0,0],g=0;g<d.rings.length;g++)for(var c=d.rings[g],f=c.length,h=c[0][0],e=c[0][1],k=1;k<f-1;k++){var m=c[k][0],n=c[k][1],l=c[k+1][0],p=c[k+1][1],s=(m-h)*(p-e)-(l-h)*(n-e);a[0]+=s*(h+m+l);a[1]+=s*(e+n+p);b+=s}a[0]/=3*b;a[1]/=3*b;return a},_findPlace:function(d,b,a,g,c,f,h){if(isNaN(a)||isNaN(g))return!1;for(var e=0;e<this._placedLabels.length;e++){var k=this._placedLabels[e].angle,m=this._placedLabels[e].width*this._scale,n=this._placedLabels[e].height*
this._scale,l=this._placedLabels[e].x-a,p=this._placedLabels[e].y-g;if(0===c&&0===k){if(this._findPlace2(-f*this._scale,-h*this._scale,f*this._scale,h*this._scale,l-m,p-n,l+m,p+n))return!1}else{var s=new C(-f*this._scale,-h*this._scale,f*this._scale,h*this._scale,null),r=0,t=1;0!==c&&(r=Math.sin(c),t=Math.cos(c));var u=l*t-p*r,l=l*r+p*t,k=k-c,r=Math.sin(k),t=Math.cos(k),q=-m*t- -n*r,p=-m*r+-n*t,k=+m*t- -n*r,A=+m*r+-n*t,m=u+q,n=l-p,r=u+k,t=l-A,q=u-q,p=l+p,u=u-k,l=l+A,k=new D;k.addRing([[m,n],[r,t],
[q,p],[u,l],[m,n]]);if(s.intersects(k))return!1}}for(;c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;e={};e.layer=d;e.text=b;e.angle=c;e.x=a;e.y=g;e.width=f;e.height=h;this._placedLabels.push(e);return!0},_findPlace2:function(d,b,a,g,c,f,h,e){return(d>=c&&d<=h||a>=c&&a<=h||d<=c&&a>=h)&&(b>=f&&b<=e||g>=f&&g<=e||b<=f&&g>=e)?!0:!1}});y("extend-esri")&&x.setObject("layers.labelLayerUtils.StaticLabel",w,E);return w})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../GraphicsLayer ../../geometry/Extent ../../geometry/Polygon".split(" "),
function(w,x,y,E,F,C,D){w=w(F,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(d,b){this._labelLayer=b;this._xmin=d.extent.xmin;this._xmax=d.extent.xmax;this._ymin=d.extent.ymin;this._ymax=d.extent.ymax;this._scale=(this._xmax-this._xmin)/d.width},_process:function(d){this._preparedLabels=
d;this._placedLabels=[];var b;for(d=this._preparedLabels.length-1;0<=d;d--){var a=this._preparedLabels[d],g=Math.min(a.labelWidth,a.labelHeight),c=a.labelWidth+0*g,g=a.labelHeight+0*g,f=(b=a.options)&&void 0!==b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter",h=b&&void 0!==b.lineLabelPosition?b.lineLabelPosition:"Above",e=b&&void 0!==b.pointPriorities?b.pointPriorities:"AboveRight",k=[2,2,1,3,0,2,3,3,2];"AboveLeft"==e?k=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==e?k=[2,1,2,2,0,2,3,3,3]:"AboveRight"==
e?k=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==e?k=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==e?k=[0,0,0,0,1,0,0,0,0]:"CenterRight"==e?k=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==e?k=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==e?k=[3,3,3,2,0,2,2,1,2]:"BelowRight"==e&&(k=[3,3,2,3,0,2,2,2,1]);var m=b&&void 0!==b.labelRotation?b.labelRotation:!0,e=a.angle*(Math.PI/180);b=b&&void 0!==b.howManyLabels?b.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,e,c,g,a.symbolWidth,
a.symbolHeight,k);else if("multipoint"==a.geometry.type){f=a.geometry;for(h=0;h<f.points.length;h++)this._generatePointPositions(a,f.points[h][0],f.points[h][1],a.text,e,c,g,a.symbolWidth,a.symbolHeight,k)}else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,c,g,2*a.symbolHeight+g,f,h,m):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,b,a.geometry,a.text,e,c,g)}return this._placedLabels},_generatePointPositions:function(d,b,a,g,c,f,h,e,k,m){e=(e+f)*this._scale;
k=(k+h)*this._scale;var n,l;for(n=1;3>=n;n++)for(l=1;9>=l;l++)if(m[l-1]==n)switch(l){case 1:if(this._findPlace(d,g,b-e,a+k,c,f,h))return;break;case 2:if(this._findPlace(d,g,b,a+k,c,f,h))return;break;case 3:if(this._findPlace(d,g,b+e,a+k,c,f,h))return;break;case 4:if(this._findPlace(d,g,b-e,a,c,f,h))return;break;case 5:if(this._findPlace(d,g,b,a,c,f,h))return;break;case 6:if(this._findPlace(d,g,b+e,a,c,f,h))return;break;case 7:if(this._findPlace(d,g,b-e,a-k,c,f,h))return;break;case 8:if(this._findPlace(d,
g,b,a-k,c,f,h))return;break;case 9:if(this._findPlace(d,g,b+e,a-k,c,f,h))return}},_generateLinePositions:function(d,b,a,g,c,f,h,e,k){var m=g*this._scale*g*this._scale,n,l,p;for(n=0;n<b.paths.length;n++){var s=b.paths[n],r=s.length,t=Math.floor((r-1)/2),u=0!==(r-1)%2?1:-1;"PlaceAtStart"==h&&(t=0,u=1);"PlaceAtEnd"==h&&(t=r-2,u=-1);for(;0<=t&&t<r-1;){for(l=t;l<r;l++){var q=s[t][0],A=s[t][1],v=s[l][0]-q,B=s[l][1]-A;if(v*v+B*B>m){for(var z=Math.atan2(B,v);z>Math.PI/2;)z-=Math.PI;for(;z<-(Math.PI/2);)z+=
Math.PI;var G=Math.sin(z),H=Math.cos(z),x=0,y=0;"Above"==e&&(x=f*G*this._scale,y=f*H*this._scale);"Below"==e&&(x=-f*G*this._scale,y=-f*H*this._scale);if(1==l-t){if(this._clipLine(q,A,s[l][0],s[l][1])&&(q=this._x1-this._x0,p=this._y1-this._y0,q*q+p*p>m&&(l=Math.atan2(p,q),v=g/2+2*c,A=v*this._scale*Math.cos(l),v=v*this._scale*Math.sin(l),"PlaceAtStart"==h?(q=this._x0+A,p=this._y0+v):"PlaceAtEnd"==h?(q=this._x1-A,p=this._y1-v):(q=this._x0+q/2,p=this._y0+p/2),this._findPlace(d,a,q-x,p+y,k?-l:0,g,c))))return}else{var w=
0;for(p=t;p<=l;p++)w=Math.max(w,Math.abs((s[p][1]-A)*H-(s[p][0]-q)*G));if(w<c&&this._findPlace(d,a,q+v/2-x,A+B/2+y,k?-z:0,g,c))return}break}}t+=u}}},_generatePolygonPositions:function(d,b,a,g,c,f,h){var e;if("ManyLabels"==b)for(b=0;b<a.rings.length;b++)e=a.rings[b],D.prototype.isClockwise(e)&&(e=this._findCentroid(e,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(d,g,e[0],e[1],c,f,h));else{e=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var k=e[1],m=0;for(b=
0;10>b;b++){m+=h/4;e=this._findCentroidForFeature(a,this._xmin,k+(m-h/4),this._xmax,k+(m+h/4));if(this._findPlace(d,g,e[0],e[1],c,f,h))break;e=this._findCentroidForFeature(a,this._xmin,k-(m+h/4),this._xmax,k-(m-h/4));if(this._findPlace(d,g,e[0],e[1],c,f,h))break}}},_findCentroid:function(d,b,a,g,c){var f=d.length,h=[0,0],e=0,k=d[0][0],m=d[0][1];k>g&&(k=g);k<b&&(k=b);m>c&&(m=c);m<a&&(m=a);for(var n=1;n<f-1;n++){var l=d[n][0],p=d[n][1],s=d[n+1][0],r=d[n+1][1];l>g&&(l=g);l<b&&(l=b);p>c&&(p=c);p<a&&(p=
a);s>g&&(s=g);s<b&&(s=b);r>c&&(r=c);r<a&&(r=a);var t=(l-k)*(r-m)-(s-k)*(p-m);h[0]+=t*(k+l+s);h[1]+=t*(m+p+r);e+=t}h[0]/=3*e;h[1]/=3*e;if(isNaN(h[0])||isNaN(h[1]))return h;a=[];this._fillBuffer(d,a,h);h[0]=this._sortBuffer(a,h[0],b,g);return h},_findCentroidForFeature:function(d,b,a,g,c){for(var f,h=0,e=[0,0],k=0;k<d.rings.length;k++){var m=d.rings[k],n=m.length,l=m[0][0],p=m[0][1];l>g&&(l=g);l<b&&(l=b);p>c&&(p=c);p<a&&(p=a);for(f=1;f<n-1;f++){var s=m[f][0],r=m[f][1],t=m[f+1][0],u=m[f+1][1];s>g&&(s=
g);s<b&&(s=b);r>c&&(r=c);r<a&&(r=a);t>g&&(t=g);t<b&&(t=b);u>c&&(u=c);u<a&&(u=a);var q=(s-l)*(u-p)-(t-l)*(r-p);e[0]+=q*(l+s+t);e[1]+=q*(p+r+u);h+=q}}e[0]/=3*h;e[1]/=3*h;if(isNaN(e[0])||isNaN(e[1]))return e;a=[];for(f=0;f<d.rings.length;f++)this._fillBuffer(d.rings[f],a,e);e[0]=this._sortBuffer(a,e[0],b,g);return e},_fillBuffer:function(d,b,a){for(var g=d.length-1,c=d[0][1]>=d[g][1]?1:-1,f=0;f<=g;f++){var h=f,e=f+1;f==g&&(e=0);var k=d[h][0],h=d[h][1],m=d[e][0],e=d[e][1],n=e>=h?1:-1;if(h<=a[1]&&a[1]<=
e||e<=a[1]&&a[1]<=h)a[1]!=h&&a[1]!=e?(b.push((a[1]-h)*(m-k)/(e-h)+k),c=n):a[1]==h&&a[1]!=e?(c!=n&&b.push(k),c=n):a[1]!=h&&a[1]==e?(b.push(m),c=n):a[1]==h&&a[1]==e&&(1==c&&b.push(k),b.push(m),c=n)}},_sortBuffer:function(d,b,a,g){var c=d.length;d.sort();if(0<c){for(var f=0,h=b=0;h<c-1;h+=2){var e=Math.abs(d[h+1]-d[h]);!(d[h]<=a&&d[h+1]<=a)&&(!(d[h]>=g&&d[h+1]>=g)&&e>f)&&(f=e,b=h)}c=d[b];d=d[b+1];c>g&&(c=g);c<a&&(c=a);d>g&&(d=g);d<a&&(d=a);b=(c+d)/2}return b},_findPlace:function(d,b,a,g,c,f,h){if(isNaN(a)||
isNaN(g))return!1;for(var e=0;e<this._placedLabels.length;e++){var k=this._placedLabels[e].angle,m=this._placedLabels[e].width*this._scale,n=this._placedLabels[e].height*this._scale,l=this._placedLabels[e].x-a,p=this._placedLabels[e].y-g;if(0===c&&0===k){if(this._findPlace2(-f*this._scale,-h*this._scale,f*this._scale,h*this._scale,l-m,p-n,l+m,p+n))return!1}else{var s=new C(-f*this._scale,-h*this._scale,f*this._scale,h*this._scale,null),r=0,t=1;0!==c&&(r=Math.sin(c),t=Math.cos(c));var u=l*t-p*r,l=
l*r+p*t,k=k-c,r=Math.sin(k),t=Math.cos(k),q=-m*t- -n*r,p=-m*r+-n*t,k=+m*t- -n*r,A=+m*r+-n*t,m=u+q,n=l-p,r=u+k,t=l-A,q=u-q,p=l+p,u=u-k,l=l+A,k=new D;k.addRing([[m,n],[r,t],[q,p],[u,l],[m,n]]);if(s.intersects(k))return!1}}for(;c>Math.PI/2;)c-=Math.PI;for(;c<-(Math.PI/2);)c+=Math.PI;e={};e.layer=d;e.text=b;e.angle=c;e.x=a;e.y=g;e.width=f;e.height=h;this._placedLabels.push(e);return!0},_findPlace2:function(d,b,a,g,c,f,h,e){return(d>=c&&d<=h||a>=c&&a<=h||d<=c&&a>=h)&&(b>=f&&b<=e||g>=f&&g<=e||b<=f&&g>=
e)?!0:!1},_clipLine:function(d,b,a,g){for(var c=this._code(d,b),f=this._code(a,g);0!==c||0!==f;){if(0!==(c&f))return!1;var h=a-d,e=g-b;0!==c?(d<this._xmin?(b+=e*(this._xmin-d)/h,d=this._xmin):d>this._xmax?(b+=e*(this._xmax-d)/h,d=this._xmax):b<this._ymin?(d+=h*(this._ymin-b)/e,b=this._ymin):b>this._ymax&&(d+=h*(this._ymax-b)/e,b=this._ymax),c=this._code(d,b)):(a<this._xmin?(g+=e*(this._xmin-a)/h,a=this._xmin):a>this._xmax?(g+=e*(this._xmax-a)/h,a=this._xmax):g<this._ymin?(a+=h*(this._ymin-g)/e,g=
this._ymin):g>this._ymax&&(a+=h*(this._ymax-g)/e,g=this._ymax),f=this._code(a,g))}this._x0=d;this._y0=b;this._x1=a;this._y1=g;return!0},_code:function(d,b){return(d<this._xmin?1:0)<<3|(d>this._xmax?1:0)<<2|(b<this._ymin?1:0)<<1|(b>this._ymax?1:0)}});y("extend-esri")&&x.setObject("layers.labelLayerUtils.DynamicLabelClass",w,E);return w})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(w,x,y,E,F,C,D,d,b,a,g){w=w(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(b){if(b){x.mixin(this,b);var f=this.features,h=b.spatialReference,e=a.getGeometryType(b.geometryType),h=this.spatialReference=new d(h);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);y.forEach(f,function(a,b){var c=a.geometry&&a.geometry.spatialReference;f[b]=new D(e&&a.geometry?new e(a.geometry):null,a.symbol&&g.fromJson(a.symbol),a.attributes);f[b].geometry&&!c&&f[b].geometry.setSpatialReference(h)});
this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(c){var d={};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=
a.getJsonType(this.features[0].geometry)),d.features=b._encodeGraphics(this.features,c));d.exceededTransferLimit=this.exceededTransferLimit;return C.fixJson(d)},_hydrate:function(){var a=this.transform;if(a){var b=this.features,d,e=a.translate[0],g=a.translate[1],m=a.scale[0],n=a.scale[1],l=function(a,b,d){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=d(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var c,m,e,l,f,n,h,g;c=0;for(m=
a.length;c<m;c++){f=a[c];e=0;for(l=f.length;e<l;e++)n=f[e],0<e?(h+=n[0],g+=n[1]):(h=n[0],g=n[1]),n[0]=b(h),n[1]=d(g)}};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=d(a.ymin);a.xmax=b(a.xmax);a.ymax=d(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var c,m,e;c=0;for(m=a.length;c<m;c++)e=a[c],e[0]=b(void 0),e[1]=d(void 0)}}(this.geometryType,function(a){return a*m+e},function(a){return g-a*n}),a=0;for(d=b.length;a<d;a++)b[a].geometry&&l(b[a].geometry);
this.transform=null}}});E("extend-esri")&&x.setObject("tasks.FeatureSet",w,F);return w})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(w,x,y,E,F,C,D,d,b,a,g,c,f,h,e,k){w=w(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){x.mixin(this,
b);this.info=a;this.title=this.getTitle;this.content=this.getContent;var d=this._fieldLabels={},c=this._fieldsMap={};a.fieldInfos&&y.forEach(a.fieldInfos,function(a){d[a.fieldName]=a.label;c[a.fieldName]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(a.title&&-1!==a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return E.fromJson(E.toJson(this.info))},getTitle:function(){},getContent:function(){},getComponents:function(a){var b=this.info,d=new D,c,e;
b.fieldInfos&&(e=y.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));e&&0<e.length&&(c=this._getRelatedRecords({graphic:a,fieldsInfo:e}));c?c.always(x.hitch(this,function(){d.resolve(this._getPopupValues(a))})):d.resolve(this._getPopupValues(a));return d.promise},_getPopupValues:function(b,d){var c=this.info,e=b.getLayer(),f=x.clone(b.attributes)||{},h=x.clone(f),g=c.fieldInfos,u="",q="",k,v,B,z,G,H=e&&e._getDateOpts&&e._getDateOpts().properties,w={dateFormat:{properties:H,
formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(z in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(z)){var C=this._relatedInfo[z],E=this._relatedLayersInfo[z];C&&(y.forEach(C.relatedFeatures,function(a){for(G in a.attributes)if(a.attributes.hasOwnProperty(G)&&"esriRelCardinalityOneToOne"===E.relation.cardinality){var b=this._toRelatedFieldName([E.relation.id,G]);f[b]=h[b]=a.attributes[G]}},this),y.forEach(C.relatedStatsFeatures,function(a){for(G in a.attributes)if(a.attributes.hasOwnProperty(G)){var b=
this._toRelatedFieldName([E.relation.id,G]);f[b]=h[b]=a.attributes[G]}},this))}g&&y.forEach(g,function(a){v=a.fieldName;h[v]=this._formatValue(h[v],v,w);H&&(a.format&&a.format.dateFormat)&&(a=y.indexOf(H,v),-1<a&&H.splice(a,1))},this);if(e){z=e.types;var F=(C=e.typeIdField)&&f[C];for(v in f)if(f.hasOwnProperty(v)&&-1===v.indexOf(this._relatedFieldPrefix)&&(B=f[v],a.isDefined(B))){var D=this._getDomainName(e,b,z,F,v,B);a.isDefined(D)?h[v]=D:v===C&&(D=this._getTypeName(e,b,B),a.isDefined(D)&&(h[v]=
D))}}c.title&&(u=this._processFieldsInLinks(this._fixTokens(c.title),f),u=x.trim(a.substitute(h,u,w)||""));if(d)return{title:u};c.description&&(q=this._processFieldsInLinks(this._fixTokens(c.description),f),q=x.trim(a.substitute(h,q,w)||""));g&&(k=[],y.forEach(g,function(b){(v=b.fieldName)&&b.visible&&k.push([b.label||v,a.substitute(h,"${"+v+"}",w)||""])}));var I,J;c.mediaInfos&&(I=[],y.forEach(c.mediaInfos,function(b){J=0;B=b.value;switch(b.type){case "image":var c=B.sourceURL,c=c&&x.trim(a.substitute(f,
this._fixTokens(c)));J=!!c;break;case "piechart":case "linechart":case "columnchart":case "barchart":J=y.some(B.fields,function(b){return a.isDefined(f[b])||-1!==b.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(J){b=x.clone(b);B=b.value;var c=b.title?this._processFieldsInLinks(this._fixTokens(b.title),f):"",d=b.caption?this._processFieldsInLinks(this._fixTokens(b.caption),f):"";b.title=c?x.trim(a.substitute(h,c,w)||""):"";b.caption=d?x.trim(a.substitute(h,d,w)||
""):"";if("image"===b.type)B.sourceURL=a.substitute(f,this._fixTokens(B.sourceURL)),B.linkURL&&(B.linkURL=x.trim(a.substitute(f,this._fixTokens(B.linkURL))||""));else{var e,m;y.forEach(B.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))m=this._getRelatedChartInfos(a,B,f,w),m instanceof Array?B.fields=m:B.fields[b]=m;else{var c=f[a],c=void 0===c?null:c;e=f[B.normalizeField]||0;c&&e&&(c/=e);B.fields[b]={y:c,tooltip:(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(c,a,w,!!e)}}},
this)}I.push(b)}},this));return{title:u,description:q,fields:k&&k.length?k:null,mediaInfos:I&&I.length?I:null,formatted:h,editSummary:e&&e.getEditSummary?e.getEditSummary(b):""}},_getRelatedChartInfos:function(a,b,c,d){var e,f,h,u,g,k;e=[];k=this._fromRelatedFieldName(a);g=k[0];f=this._relatedInfo[g];g=this._relatedLayersInfo[g];f&&y.forEach(f.relatedFeatures,function(f){f=f.attributes;var g,q;for(q in f)if(f.hasOwnProperty(q)&&q===k[1]){g={};u=f[q];b.normalizeField&&(h=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?
f[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);u&&h&&(u/=h);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var r=this._fromRelatedFieldName(b.tooltipField)[1];g.tooltip=f[r]+":\x3cbr/\x3e"+this._formatValue(u,f[r],d,!!h)}else g.tooltip=(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(u,b.tooltipField,d,!!h);else g.tooltip=u;g.y=u;e.push(g)}},this);return"esriRelCardinalityOneToMany"===g.relation.cardinality||"esriRelCardinalityManyToMany"===
g.relation.cardinality?e:e[0]},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&(b&&b.hasAttachments&&b.objectIdField)&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",
shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"[^\"]+\"/ig,_fixTokens:function(a){return a.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_processFieldsInLinks:function(b,c){return b&&
b.replace(this._reHref,function(b){return b=a.substitute(c,b)})},_formatValue:function(b,c,d,e){var f=this._fieldsMap[c],h=f&&f.format;c="number"===typeof b&&-1===y.indexOf(d.dateFormat.properties,c)&&(!h||!h.dateFormat);if(!a.isDefined(b)||!f||!a.isDefined(h))return c?this._forceLTR(b):b;var g="",u=[],f=h.hasOwnProperty("places")||h.hasOwnProperty("digitSeparator"),q=h.hasOwnProperty("digitSeparator")?h.digitSeparator:!0;if(f)g="NumberFormat",u.push("places: "+(a.isDefined(h.places)&&(!e||0<h.places)?
Number(h.places):"Infinity")),u.length&&(g+="("+u.join(",")+")");else if(h.dateFormat)g="DateFormat"+this._insertOffset(this._dateFormats[h.dateFormat]||this._dateFormats.shortDateShortTime);else return c?this._forceLTR(b):b;b=a.substitute({myKey:b},"${myKey:"+g+"}",d)||"";f&&!q&&k.group&&(b=b.replace(RegExp("\\"+k.group,"g"),""));return c?this._forceLTR(b):b},_forceLTR:function(a){var b=d("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(b){b&&
(b=a.isDefined(this.utcOffset)?b.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):b);return b},_getDomainName:function(a,b,c,d,e,f){return(a=a.getDomain&&a.getDomain(e,{feature:b}))&&a.codedValues?a.getName(f):null},_getTypeName:function(a,b,c){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,c=new D,d;this._relatedLayersInfo?this._queryRelatedLayers(b).then(x.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),x.hitch(this,this._handlerErrorResponse,
c)):this._getRelatedLayersInfo(a).then(x.hitch(this,function(a){for(d in a)a.hasOwnProperty(d)&&a[d]&&(this._relatedLayersInfo[d].relatedLayerInfo=a[d]);this._queryRelatedLayers(b).then(x.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),x.hitch(this,this._handlerErrorResponse,c))}),x.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(a){var d=a.fieldsInfo,f,h,g={};f=a.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});
y.forEach(d,function(a){var b,c,d,h;b=this._fromRelatedFieldName(a.fieldName);c=b[0];b=b[1];c&&(this._relatedLayersInfo[c]||(y.some(f.relationships,function(a){if(a.id==c)return h=a,!0}),h&&(this._relatedLayersInfo[c]={relation:h,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(d=new e,d.statisticType=a.statisticType,d.onStatisticField=b,d.outStatisticFieldName=b,this._relatedLayersInfo[c].outStatistics.push(d))))},
this);for(h in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(h)&&this._relatedLayersInfo[h]&&(a=this._relatedLayersInfo[h].relation,a=f.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[h].relatedLayerUrl=a,g[h]=c({url:a,content:{f:"json"},callbackParamName:"callback"}));return b(g)},_queryRelatedLayers:function(a){var c={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(c[d]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[d]}));
return b(c)},_queryRelatedLayer:function(a){var c,d,e,g,k,t,u,q,A,v;c=a.graphic;d=c.getLayer().url.match(/[0-9]+$/g)[0];q=a.relatedInfo;u=q.relatedLayerInfo;A=q.relatedLayerUrl;v=q.relation;y.some(u.relationships,function(a){if(a.relatedTableId===parseInt(d,10))return e=a,!0},this);e&&(a=new f,y.some(u.fields,function(a){if(a.name===e.keyField)return k=-1!==y.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),g="string"===
k?e.keyField+"\x3d'"+c.attributes[v.keyField]+"'":e.keyField+"\x3d"+c.attributes[v.keyField],a.where=g,a.outFields=q.relatedFields,q.outStatistics&&(0<q.outStatistics.length&&u.supportsStatistics)&&(t=new f,t.where=a.where,t.outFields=a.outFields,t.outStatistics=q.outStatistics),c=new h(A),g=[],g.push(c.execute(a)),t&&g.push(c.execute(t)));return b(g)},_setRelatedRecords:function(b,c){this._relatedInfo=[];for(var d in c)if(c.hasOwnProperty(d)&&c[d]){var e=c[d];this._relatedInfo[d]={};this._relatedInfo[d].relatedFeatures=
e[0].features;a.isDefined(e[1])&&(this._relatedInfo[d].relatedStatsFeatures=e[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});C("extend-esri")&&(g.PopupInfo=g.PopupInfoTemplate=w);return w})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer".split(" "),function(w,x,y,E,F,C,D,d,b,a,g,c,f,h,e,k,m,n,l,p,s,r){function t(a){return"sizeInfo"===
a.type}w=x(p,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){var b=this.inherited(arguments);this._map&&this._mapEventHandlers.push(this._map.on("extent-change",y.hitch(this,"refresh")));this.refresh();return b},_unsetMap:function(){var a;
for(a=0;a<this._mapEventHandlers.length;a++)C.disconnect(this._mapEventHandlers[a]);this.refresh();this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,d){if(!this.getFeatureLayer(a.layerId)){var e=[];e.push(a.on("update-end",y.hitch(this,"refresh")));e.push(a.on("suspend",y.hitch(this,"refresh")));e.push(a.on("resume",y.hitch(this,"refresh")));e.push(a.on("edits-complete",y.hitch(this,
"refresh")));e.push(a.on("labeling-info-change",y.hitch(this,"refresh")));e.push(a.on("time-extent-change",y.hitch(this,"refresh")));e.push(a.on("show-labels-change",y.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:d,LabelRenderer:b,EventHandlers:e});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;
a=this.getFeatureLayer(a);if(void 0!==a&&(b=F.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)C.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)C.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=
[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];return null},refresh:function(a){var b,c,d,e,g,l=[],k="DYNAMIC"===this._engineType?new f:new h;if(this._map){k.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(c=this.featureLayers[a],c.visible&&c.showLabels&&
c.visibleAtMapScale&&!c._suspended)if(b=this._featureLayerInfos[a],b.LabelRenderer){if(l=c.labelingInfo)if(g=l[0])e=this._getLabelExpression(g),this._convertOptions(g);d=b.LabelRenderer;b.LabelExpressionInfo&&(e=b.LabelExpressionInfo);g=this._convertOptions(null);b.LabelingOptions&&(void 0!==b.LabelingOptions.lineLabelPlacement&&(g.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(g.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==
b.LabelingOptions.labelRotation&&(g.labelRotation=b.LabelingOptions.labelRotation),void 0!==b.LabelingOptions.howManyLabels&&(g.howManyLabels=b.LabelingOptions.howManyLabels));d instanceof s&&(e=this._getLabelExpression(d),d=new r(d.symbol),g=this._convertOptions(d));this._addLabels(c,d,e,g)}else if(l=c.labelingInfo)for(b=l.length-1;0<=b;b--)if(g=l[b])d=new s(g instanceof s?g.toJson():g),e=this._getLabelExpression(g),g=this._convertOptions(g),this._addLabels(c,d,e,g);e=k._process(this._preparedLabels);
this.clear();this.drawLabels(this._map,e)}},drawLabels:function(a,b){this._scale=(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var d=b[c],f=d.x,h=d.y,l=d.text,k=d.angle,m=d.layer.labelSymbol;"polyline"==d.layer.geometry.type&&d.layer.options.labelRotation?m.setAngle(k*(180/Math.PI)):m.setAngle(0);m.setText(l);d=f;m instanceof e&&(f=m.getHeight(),k=Math.sin(k),d-=0.25*f*this._scale*k,h-=0.33*f*this._scale);k=new g(new n(d,h,a.extent.spatialReference));k.setSymbol(m);this.add(k)}},
_addLabels:function(a,b,c,d){var e,f,g,h;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==c){var k=this._map,m=!a.url&&!k.spatialReference.equals(a.spatialReference);for(e=0;e<a.graphics.length;e++)if(f=a.graphics[e],!1!==f.visible){g=f.geometry;if(m){if(!l.canProject(g,k))continue;g=l.project(g,k)}g&&(this._isWhere(b.where,f.attributes)&&this._isWithinScreenArea(g))&&(h=this._buildLabelText(c,f.attributes,a.fields,d),this._addLabel(h,b,a.renderer,f,d,g,k))}}},_isWithinScreenArea:function(a){a=
"point"===a.type?new m(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[c[0].substr(1,c[0].length-2)],c[1],c[2]);if(7===c.length){var d=this._sqlEquation(b[c[0].substr(1,c[0].length-2)],c[1],c[2]),e=c[3],f=this._sqlEquation(b[c[4].substr(1,
c[4].length-2)],c[5],c[6]);switch(e){case "AND":return d&&f;case "OR":return d||f}}}return!1}catch(g){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_getSizeInfo:function(a){return a?a.sizeInfo||F.filter(a.visualVariables,t)[0]:null},_addLabel:function(a,b,c,f,g,h,
l){var m,n,p,r;if(a&&""!==y.trim(a)&&b){m=b.getSymbol(f);m instanceof e?(m=new e(m.toJson()),m.setVerticalAlignment("baseline"),m.setHorizontalAlignment("center")):m=m instanceof k?new k(m.toJson()):new e;m.setText(a);b.symbol=m;if(p=this._getProportionalSize(b.sizeInfo,f.attributes))m instanceof e?m.setSize(p):m instanceof k&&(m.setWidth(p),m.setHeight(p));r=p=0;if(c){n=c.getSymbol(f);var s=this._getSizeInfo(c);if(s)r=p=c.getSize(f,{sizeInfo:s,resolution:l.getResolutionInMeters()});else if(n)if("simplemarkersymbol"==
n.type)r=p=n.size;else if("picturemarkersymbol"==n.type)p=n.width,r=n.height;else if("simplelinesymbol"==n.type||"cartographiclinesymbol"==n.type)p=n.width}c={};c.graphic=f;c.options=g;c.geometry=h;c.labelRenderer=b;c.labelSymbol=m;c.labelWidth=m.getWidth()/2;c.labelHeight=m.getHeight()/2;c.symbolWidth=d.normalizedLength(p)/2;c.symbolHeight=d.normalizedLength(r)/2;c.text=a;c.angle=m.angle;this._preparedLabels.push(c)}},_buildLabelText:function(b,d,e,f){return b.replace(/{[^}]*}/g,function(b){var g,
h=b;for(g=0;g<e.length;g++)if("{"+e[g].name+"}"==b){var h=d[e[g].name],k=e[g].domain;if(k&&y.isObject(k)){if("codedValue"==k.type)for(b=0;b<k.codedValues.length;b++)k.codedValues[b].code==h&&(h=k.codedValues[b].name);else"range"==k.type&&(k.minValue<=h&&h<=k.maxValue)&&(h=k.name);break}k=e[g].type;if("esriFieldTypeDate"==k)(k="DateFormat"+c.prototype._dateFormats[f&&f.dateFormat||"shortDate"])&&(h=a.substitute({myKey:h},"${myKey:"+k+"}"));else if("esriFieldTypeInteger"==k||"esriFieldTypeSmallInteger"==
k||"esriFieldTypeLong"==k||"esriFieldTypeDouble"==k)f&&(f.numberFormat&&f.numberFormat.digitSeparator&&f.numberFormat.places)&&(h=E.format(h,{places:f.numberFormat.places}))}return h})},_getLabelExpression:function(a){return a.labelExpressionInfo?a.labelExpressionInfo.value:this._validSyntax(a.labelExpression)?this._convertLabelExpression(a.labelExpression):""},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[","g"),"{").replace(RegExp("\\]",
"g"),"}")},_getProportionalSize:function(b,c){if(!b)return null;var d=a.substitute(c,"${"+b.field+"}",{first:!0});return!b.minSize||!b.maxSize||!b.minDataValue||!b.maxDataValue||!d||0>=b.maxDataValue-b.minDataValue?null:(b.maxSize-b.minSize)/(b.maxDataValue-b.minDataValue)*(d-b.minDataValue)+b.minSize},_convertOptions:function(a){var b="shortDate",c=null,d="",e=!0;a&&(void 0!==a.format&&(b=a.format.dateFormat,c={places:a.format.places,digitSeparator:a.format.digitSeparator}),d=a.labelPlacement);if("always-horizontal"==
d||"esriServerPolygonPlacementAlwaysHorizontal"==d)e=!1;return{dateFormat:b,numberFormat:c,pointPriorities:"above-center"==d||"esriServerPointLabelPlacementAboveCenter"==d?"AboveCenter":"above-left"==d||"esriServerPointLabelPlacementAboveLeft"==d?"AboveLeft":"above-right"==d||"esriServerPointLabelPlacementAboveRight"==d?"AboveRight":"below-center"==d||"esriServerPointLabelPlacementBelowCenter"==d?"BelowCenter":"below-left"==d||"esriServerPointLabelPlacementBelowLeft"==d?"BelowLeft":"below-right"==
d||"esriServerPointLabelPlacementBelowRight"==d?"BelowRight":"center-center"==d||"esriServerPointLabelPlacementCenterCenter"==d?"CenterCenter":"center-left"==d||"esriServerPointLabelPlacementCenterLeft"==d?"CenterLeft":"center-right"==d||"esriServerPointLabelPlacementCenterRight"==d?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==d||"below-start"==d||"center-start"==d?"PlaceAtStart":"above-end"==d||"below-end"==d||"center-end"==d?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==
d||"esriServerLinePlacementAboveAfter"==d||"above-along"==d||"esriServerLinePlacementAboveAlong"==d||"above-before"==d||"esriServerLinePlacementAboveBefore"==d||"above-start"==d||"esriServerLinePlacementAboveStart"==d||"above-end"==d||"esriServerLinePlacementAboveEnd"==d?"Above":"below-after"==d||"esriServerLinePlacementBelowAfter"==d||"below-along"==d||"esriServerLinePlacementBelowAlong"==d||"below-before"==d||"esriServerLinePlacementBelowBefore"==d||"below-start"==d||"esriServerLinePlacementBelowStart"==
d||"below-end"==d||"esriServerLinePlacementBelowEnd"==d?"Below":"center-after"==d||"esriServerLinePlacementCenterAfter"==d||"center-along"==d||"esriServerLinePlacementCenterAlong"==d||"center-before"==d||"esriServerLinePlacementCenterBefore"==d||"center-start"==d||"esriServerLinePlacementCenterStart"==d||"center-end"==d||"esriServerLinePlacementCenterEnd"==d?"OnLine":"Above",labelRotation:e,howManyLabels:"OneLabel"}}});D("extend-esri")&&y.setObject("layers.LabelLayer",w,b);return w});