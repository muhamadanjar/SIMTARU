// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.12/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(l,r,f,h,n,c){l=h("dijit._OnDijitClickMixin",null,{connect:function(f,a,w){return this.inherited(arguments,[f,"ondijitclick"==a?c:a,w])}});l.a11yclick=c;return l})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(l,r,f,h,n,c,k){var a={_isElementShown:function(a){var b=
h.get(a);return"hidden"!=b.visibility&&"collapsed"!=b.visibility&&"none"!=b.display&&"hidden"!=f.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return f.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var b;try{var c=a.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;b=c.body}catch(h){try{b=a.contentWindow.document.body}catch(n){return!1}}return b&&("true"==b.contentEditable||
b.firstChild&&"true"==b.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(c){return f.get(c,"disabled")?void 0:f.has(c,"tabIndex")?+f.get(c,"tabIndex"):a.hasDefaultTabStop(c)?0:void 0},isTabNavigable:function(c){return 0<=a.effectiveTabIndex(c)},isFocusable:function(c){return-1<=a.effectiveTabIndex(c)},_getTabNavigable:function(w){function b(b){return b&&"input"==b.tagName.toLowerCase()&&b.type&&"radio"==b.type.toLowerCase()&&b.name&&b.name.toLowerCase()}
var m,h,n,r,k,l,x={},E=a._isElementShown,A=a.effectiveTabIndex,s=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=c("ie")&&"HTML"!==a.scopeName||!E(a))){var q=A(a);if(0<=q){if(0==q)m||(m=a),h=a;else if(0<q){if(!n||q<r)r=q,n=a;if(!k||q>=l)l=q,k=a}q=b(a);f.get(a,"checked")&&q&&(x[q]=a)}"SELECT"!=a.nodeName.toUpperCase()&&s(a)}};E(w)&&s(w);return{first:x[b(m)]||m,last:x[b(h)]||h,lowest:x[b(n)]||n,highest:x[b(k)]||k}},getFirstInTabbingOrder:function(c,b){var f=a._getTabNavigable(r.byId(c,
b));return f.lowest?f.lowest:f.first},getLastInTabbingOrder:function(c,b){var f=a._getTabNavigable(r.byId(c,b));return f.last?f.last:f.highest}};n.mixin(k,a);return a})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(l,r,f,h){function n(a){if((a.keyCode===l.ENTER||a.keyCode===l.SPACE)&&!/input|button|textarea/i.test(a.target.nodeName))for(a=a.target;a;a=a.parentNode)if(a.dojoClick)return!0}var c;f(document,"keydown",function(a){n(a)?(c=a.target,a.preventDefault()):
c=null});f(document,"keyup",function(a){n(a)&&a.target==c&&(c=null,f.emit(a.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,metaKey:a.metaKey,altKey:a.altKey,_origType:a.type}))});var k=function(a,c){a.dojoClick=!0;return f(a,"click",c)};k.click=k;k.press=function(a,c){var b=f(a,h.press,function(b){("mousedown"!=b.type||r.isLeft(b))&&c(b)}),m=f(a,"keydown",function(b){(b.keyCode===l.ENTER||b.keyCode===l.SPACE)&&c(b)});return{remove:function(){b.remove();m.remove()}}};
k.release=function(a,c){var b=f(a,h.release,function(b){("mouseup"!=b.type||r.isLeft(b))&&c(b)}),m=f(a,"keyup",function(b){(b.keyCode===l.ENTER||b.keyCode===l.SPACE)&&c(b)});return{remove:function(){b.remove();m.remove()}}};k.move=h.move;return k})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),function(l,r,f,h,n,c){l=l([c],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(c){n.isDefined(this.visibility)&&
(this.visible=!!this.visibility)}});f("extend-esri")&&r.setObject("layers.KMLGroundOverlay",l,h);return l})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(l,r,f,h,n,c,k,a,w,b){function m(d,e,t){return B&&t?function(d,e){return c(d,t,e)}:x?function(t,p){var q=c(t,e,function(d){p.call(this,d);g=(new Date).getTime()}),b=c(t,d,function(d){(!g||(new Date).getTime()>g+1E3)&&p.call(this,d)});return{remove:function(){q.remove();
b.remove()}}}:function(e,g){return c(e,d,g)}}function C(d){do if(void 0!==d.dojoClick)return d;while(d=d.parentNode)}function D(g,t,a){var x=C(g.target);if(A=!g.target.disabled&&x&&x.dojoClick)if(u=(s="useTarget"==A)?x:g.target,s&&g.preventDefault(),q=g.changedTouches?g.changedTouches[0].pageX-b.global.pageXOffset:g.clientX,z=g.changedTouches?g.changedTouches[0].pageY-b.global.pageYOffset:g.clientY,e=("object"==typeof A?A.x:"number"==typeof A?A:0)||4,p=("object"==typeof A?A.y:"number"==typeof A?A:
0)||4,!E){E=!0;var m=function(d){A=s?f.isDescendant(b.doc.elementFromPoint(d.changedTouches?d.changedTouches[0].pageX-b.global.pageXOffset:d.clientX,d.changedTouches?d.changedTouches[0].pageY-b.global.pageYOffset:d.clientY),u):A&&(d.changedTouches?d.changedTouches[0].target:d.target)==u&&Math.abs((d.changedTouches?d.changedTouches[0].pageX-b.global.pageXOffset:d.clientX)-q)<=e&&Math.abs((d.changedTouches?d.changedTouches[0].pageY-b.global.pageYOffset:d.clientY)-z)<=p};b.doc.addEventListener(t,function(d){m(d);
s&&d.preventDefault()},!0);b.doc.addEventListener(a,function(g){m(g);if(A){d=(new Date).getTime();var e=s?u:g.target;"LABEL"===e.tagName&&(e=f.byId(e.getAttribute("for"))||e);var t=g.changedTouches?g.changedTouches[0]:g,p=document.createEvent("MouseEvents");p._dojo_click=!0;p.initMouseEvent("click",!0,!0,g.view,g.detail,t.screenX,t.screenY,t.clientX,t.clientY,g.ctrlKey,g.altKey,g.shiftKey,g.metaKey,0,null);setTimeout(function(){c.emit(e,"click",p);d=(new Date).getTime()},0)}},!0);g=function(g){b.doc.addEventListener(g,
function(e){!e._dojo_click&&((new Date).getTime()<=d+1E3&&!("INPUT"==e.target.tagName&&h.contains(e.target,"dijitOffScreen")))&&(e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),"click"==g&&(("INPUT"!=e.target.tagName||"radio"==e.target.type||"checkbox"==e.target.type)&&"TEXTAREA"!=e.target.tagName&&"AUDIO"!=e.target.tagName&&"VIDEO"!=e.target.tagName)&&e.preventDefault())},!0)};g("click");g("mousedown");g("mouseup")}}var y=5>k("ios"),B=k("pointer-events")||k("MSPointer"),
v=function(){var d={},g;for(g in{down:1,move:1,up:1,cancel:1,over:1,out:1})d[g]=k("MSPointer")?"MSPointer"+g.charAt(0).toUpperCase()+g.slice(1):"pointer"+g;return d}(),x=k("touch-events"),E,A,s=!1,u,q,z,e,p,d,g,t;B?w(function(){b.doc.addEventListener(v.down,function(d){D(d,v.move,v.up)},!0)}):x&&w(function(){function d(g){var e=n.delegate(g,{bubbles:!0});6<=k("ios")&&(e.touches=g.touches,e.altKey=g.altKey,e.changedTouches=g.changedTouches,e.ctrlKey=g.ctrlKey,e.metaKey=g.metaKey,e.shiftKey=g.shiftKey,
e.targetTouches=g.targetTouches);return e}t=b.body();b.doc.addEventListener("touchstart",function(d){g=(new Date).getTime();var e=t;t=d.target;c.emit(e,"dojotouchout",{relatedTarget:t,bubbles:!0});c.emit(t,"dojotouchover",{relatedTarget:e,bubbles:!0});D(d,"touchmove","touchend")},!0);c(b.doc,"touchmove",function(e){g=(new Date).getTime();var p=b.doc.elementFromPoint(e.pageX-(y?0:b.global.pageXOffset),e.pageY-(y?0:b.global.pageYOffset));p&&(t!==p&&(c.emit(t,"dojotouchout",{relatedTarget:p,bubbles:!0}),
c.emit(p,"dojotouchover",{relatedTarget:t,bubbles:!0}),t=p),c.emit(p,"dojotouchmove",d(e))||e.preventDefault())});c(b.doc,"touchend",function(e){g=(new Date).getTime();var t=b.doc.elementFromPoint(e.pageX-(y?0:b.global.pageXOffset),e.pageY-(y?0:b.global.pageYOffset))||b.body();c.emit(t,"dojotouchend",d(e))})});r={press:m("mousedown","touchstart",v.down),move:m("mousemove","dojotouchmove",v.move),release:m("mouseup","dojotouchend",v.up),cancel:m(a.leave,"touchcancel",B?v.cancel:null),over:m("mouseover",
"dojotouchover",v.over),out:m("mouseout","dojotouchout",v.out),enter:a._eventHandler(m("mouseover","dojotouchover",v.over)),leave:a._eventHandler(m("mouseout","dojotouchout",v.out))};return l.touch=r})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(l,r,f,h,n,c,k,a,w){var b=n.delegate(a,{mouseenter:c.enter,mouseleave:c.leave,keypress:f._keypress}),m;f=h("dijit._AttachMixin",
null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var a=b;;)if(1==a.nodeType&&(this._processTemplateNode(a,function(b,a){return b.getAttribute(a)},this._attach)||this.searchContainerNode)&&a.firstChild)a=a.firstChild;else{if(a==b)break;for(;!a.nextSibling;)if(a=a.parentNode,a==b)return;a=
a.nextSibling}},_processTemplateNode:function(b,a,c){var f=!0,m=this.attachScope||this,x=a(b,"dojoAttachPoint")||a(b,"data-dojo-attach-point");if(x)for(var E=x.split(/\s*,\s*/);x=E.shift();)n.isArray(m[x])?m[x].push(b):m[x]=b,f="containerNode"!=x,this._attachPoints.push(x);if(a=a(b,"dojoAttachEvent")||a(b,"data-dojo-attach-event")){x=a.split(/\s*,\s*/);for(E=n.trim;a=x.shift();)if(a){var h=null;-1!=a.indexOf(":")?(h=a.split(":"),a=E(h[0]),h=E(h[1])):a=E(a);h||(h=a);this._attachEvents.push(c(b,a,n.hitch(m,
h)))}}return f},_attach:function(a,c,f){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?m||(m=l("./a11yclick")):b[c]||c;return k(a,c,f)},_detachTemplateNodes:function(){var b=this.attachScope||this;r.forEach(this._attachPoints,function(a){delete b[a]});this._attachPoints=[];r.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});n.extend(w,{dojoAttachEvent:"",dojoAttachPoint:""});return f})},
"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(l,r,f,h,n,c,k,a,w,b,m,C,D,y,B,v){l=l(null,{declaredClass:"esri.PopupInfo",initialize:function(b,a){if(b){r.mixin(this,a);this.info=b;this.title=this.getTitle;this.content=this.getContent;var c=this._fieldLabels=
{},s=this._fieldsMap={};b.fieldInfos&&f.forEach(b.fieldInfos,function(b){c[b.fieldName]=b.label;s[b.fieldName]=b});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(b.title&&-1!==b.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return h.fromJson(h.toJson(this.info))},getTitle:function(){},getContent:function(){},getComponents:function(b){var a=this.info,c=new k,s,u;a.fieldInfos&&(u=f.filter(a.fieldInfos,function(b){return-1!==b.fieldName.indexOf(this._relatedFieldPrefix)},
this));u&&0<u.length&&(s=this._getRelatedRecords({graphic:b,fieldsInfo:u}));s?s.always(r.hitch(this,function(){c.resolve(this._getPopupValues(b))})):c.resolve(this._getPopupValues(b));return c.promise},_getPopupValues:function(a,c){var m=this.info,s=a.getLayer(),u=r.clone(a.attributes)||{},q=r.clone(u),z=m.fieldInfos,e="",p="",d,g,t,I,h,n=s&&s._getDateOpts&&s._getDateOpts().properties,w={dateFormat:{properties:n,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(I in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(I)){var k=
this._relatedInfo[I],l=this._relatedLayersInfo[I];k&&(f.forEach(k.relatedFeatures,function(d){for(h in d.attributes)if(d.attributes.hasOwnProperty(h)&&"esriRelCardinalityOneToOne"===l.relation.cardinality){var e=this._toRelatedFieldName([l.relation.id,h]);u[e]=q[e]=d.attributes[h]}},this),f.forEach(k.relatedStatsFeatures,function(d){for(h in d.attributes)if(d.attributes.hasOwnProperty(h)){var e=this._toRelatedFieldName([l.relation.id,h]);u[e]=q[e]=d.attributes[h]}},this))}z&&f.forEach(z,function(d){g=
d.fieldName;q[g]=this._formatValue(q[g],g,w);n&&(d.format&&d.format.dateFormat)&&(d=f.indexOf(n,g),-1<d&&n.splice(d,1))},this);if(s){I=s.types;var v=(k=s.typeIdField)&&u[k];for(g in u)if(u.hasOwnProperty(g)&&-1===g.indexOf(this._relatedFieldPrefix)&&(t=u[g],b.isDefined(t))){var y=this._getDomainName(s,a,I,v,g,t);b.isDefined(y)?q[g]=y:g===k&&(y=this._getTypeName(s,a,t),b.isDefined(y)&&(q[g]=y))}}m.title&&(e=this._processFieldsInLinks(this._fixTokens(m.title),u),e=r.trim(b.substitute(q,e,w)||""));if(c)return{title:e};
m.description&&(p=this._processFieldsInLinks(this._fixTokens(m.description),u),p=r.trim(b.substitute(q,p,w)||""));z&&(d=[],f.forEach(z,function(e){(g=e.fieldName)&&e.visible&&d.push([e.label||g,b.substitute(q,"${"+g+"}",w)||""])}));var C,D;m.mediaInfos&&(C=[],f.forEach(m.mediaInfos,function(d){D=0;t=d.value;switch(d.type){case "image":var e=t.sourceURL,e=e&&r.trim(b.substitute(u,this._fixTokens(e)));D=!!e;break;case "piechart":case "linechart":case "columnchart":case "barchart":D=f.some(t.fields,
function(d){return b.isDefined(u[d])||-1!==d.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(D){d=r.clone(d);t=d.value;var e=d.title?this._processFieldsInLinks(this._fixTokens(d.title),u):"",g=d.caption?this._processFieldsInLinks(this._fixTokens(d.caption),u):"";d.title=e?r.trim(b.substitute(q,e,w)||""):"";d.caption=g?r.trim(b.substitute(q,g,w)||""):"";if("image"===d.type)t.sourceURL=b.substitute(u,this._fixTokens(t.sourceURL)),t.linkURL&&(t.linkURL=r.trim(b.substitute(u,
this._fixTokens(t.linkURL))||""));else{var p,a;f.forEach(t.fields,function(d,e){if(-1!==d.indexOf(this._relatedFieldPrefix))a=this._getRelatedChartInfos(d,t,u,w),a instanceof Array?t.fields=a:t.fields[e]=a;else{var g=u[d],g=void 0===g?null:g;p=u[t.normalizeField]||0;g&&p&&(g/=p);t.fields[e]={y:g,tooltip:(this._fieldLabels[d]||d)+":\x3cbr/\x3e"+this._formatValue(g,d,w,!!p)}}},this)}C.push(d)}},this));return{title:e,description:p,fields:d&&d.length?d:null,mediaInfos:C&&C.length?C:null,formatted:q,editSummary:s&&
s.getEditSummary?s.getEditSummary(a):""}},_getRelatedChartInfos:function(b,a,c,s){var m,q,z,e,p,d;m=[];d=this._fromRelatedFieldName(b);p=d[0];q=this._relatedInfo[p];p=this._relatedLayersInfo[p];q&&f.forEach(q.relatedFeatures,function(g){g=g.attributes;var t,p;for(p in g)if(g.hasOwnProperty(p)&&p===d[1]){t={};e=g[p];a.normalizeField&&(z=-1!==a.normalizeField.indexOf(this._relatedFieldPrefix)?g[this._fromRelatedFieldName(a.normalizeField)[1]]:c[a.normalizeField]);e&&z&&(e/=z);if(a.tooltipField)if(-1!==
a.tooltipField.indexOf(this._relatedFieldPrefix)){var q=this._fromRelatedFieldName(a.tooltipField)[1];t.tooltip=g[q]+":\x3cbr/\x3e"+this._formatValue(e,g[q],s,!!z)}else t.tooltip=(this._fieldLabels[b]||b)+":\x3cbr/\x3e"+this._formatValue(e,a.tooltipField,s,!!z);else t.tooltip=e;t.y=e;m.push(t)}},this);return"esriRelCardinalityOneToMany"===p.relation.cardinality||"esriRelCardinalityManyToMany"===p.relation.cardinality?m:m[0]},getAttachments:function(b){var a=b.getLayer();b=b.attributes;if(this.info.showAttachments&&
(a&&a.hasAttachments&&a.objectIdField)&&(b=b&&b[a.objectIdField]))return a.queryAttachmentInfos(b)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",
shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",
shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"[^\"]+\"/ig,_fixTokens:function(b){return b.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_processFieldsInLinks:function(a,c){return a&&a.replace(this._reHref,function(a){return a=b.substitute(c,a)})},_formatValue:function(a,c,m,
s){var h=this._fieldsMap[c],q=h&&h.format;c="number"===typeof a&&-1===f.indexOf(m.dateFormat.properties,c)&&(!q||!q.dateFormat);if(!b.isDefined(a)||!h||!b.isDefined(q))return c?this._forceLTR(a):a;var z="",e=[],h=q.hasOwnProperty("places")||q.hasOwnProperty("digitSeparator"),p=q.hasOwnProperty("digitSeparator")?q.digitSeparator:!0;if(h)z="NumberFormat",e.push("places: "+(b.isDefined(q.places)&&(!s||0<q.places)?Number(q.places):"Infinity")),e.length&&(z+="("+e.join(",")+")");else if(q.dateFormat)z=
"DateFormat"+this._insertOffset(this._dateFormats[q.dateFormat]||this._dateFormats.shortDateShortTime);else return c?this._forceLTR(a):a;a=b.substitute({myKey:a},"${myKey:"+z+"}",m)||"";h&&!p&&v.group&&(a=a.replace(RegExp("\\"+v.group,"g"),""));return c?this._forceLTR(a):a},_forceLTR:function(b){var c=a("ie");return c&&10>=c?b:"\x3cspan class\x3d'esriNumericValue'\x3e"+b+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=b.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):
a);return a},_getDomainName:function(a,b,c,m,h,q){return(a=a.getDomain&&a.getDomain(h,{feature:b}))&&a.codedValues?a.getName(q):null},_getTypeName:function(a,b,c){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,c=new k,m;this._relatedLayersInfo?this._queryRelatedLayers(b).then(r.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),r.hitch(this,this._handlerErrorResponse,c)):this._getRelatedLayersInfo(a).then(r.hitch(this,function(a){for(m in a)a.hasOwnProperty(m)&&
a[m]&&(this._relatedLayersInfo[m].relatedLayerInfo=a[m]);this._queryRelatedLayers(b).then(r.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),r.hitch(this,this._handlerErrorResponse,c))}),r.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(a){var b=a.fieldsInfo,c,m,h={};c=a.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});f.forEach(b,function(a){var b,e,p,d;b=this._fromRelatedFieldName(a.fieldName);e=b[0];b=b[1];e&&
(this._relatedLayersInfo[e]||(f.some(c.relationships,function(g){if(g.id==e)return d=g,!0}),d&&(this._relatedLayersInfo[e]={relation:d,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[e]&&(this._relatedLayersInfo[e].relatedFields.push(b),a.statisticType&&(p=new B,p.statisticType=a.statisticType,p.onStatisticField=b,p.outStatisticFieldName=b,this._relatedLayersInfo[e].outStatistics.push(p))))},this);for(m in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(m)&&this._relatedLayersInfo[m]&&
(a=this._relatedLayersInfo[m].relation,a=c.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[m].relatedLayerUrl=a,h[m]=C({url:a,content:{f:"json"},callbackParamName:"callback"}));return w(h)},_queryRelatedLayers:function(a){var b={},c;for(c in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(c)&&(b[c]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[c]}));return w(b)},_queryRelatedLayer:function(a){var b,c,m,h,q,z,e,p,d,g;b=a.graphic;c=b.getLayer().url.match(/[0-9]+$/g)[0];
p=a.relatedInfo;e=p.relatedLayerInfo;d=p.relatedLayerUrl;g=p.relation;f.some(e.relationships,function(d){if(d.relatedTableId===parseInt(c,10))return m=d,!0},this);m&&(a=new D,f.some(e.fields,function(d){if(d.name===m.keyField)return q=-1!==f.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],d.type)?"number":"string",!0}),h="string"===q?m.keyField+"\x3d'"+b.attributes[g.keyField]+"'":m.keyField+"\x3d"+b.attributes[g.keyField],a.where=h,a.outFields=
p.relatedFields,p.outStatistics&&(0<p.outStatistics.length&&e.supportsStatistics)&&(z=new D,z.where=a.where,z.outFields=a.outFields,z.outStatistics=p.outStatistics),b=new y(d),h=[],h.push(b.execute(a)),z&&h.push(b.execute(z)));return w(h)},_setRelatedRecords:function(a,c){this._relatedInfo=[];for(var m in c)if(c.hasOwnProperty(m)&&c[m]){var h=c[m];this._relatedInfo[m]={};this._relatedInfo[m].relatedFeatures=h[0].features;b.isDefined(h[1])&&(this._relatedInfo[m].relatedStatsFeatures=h[1].features)}},
_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});c("extend-esri")&&(m.PopupInfo=m.PopupInfoTemplate=l);return l})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(l,r,f,h,n,c,k,a,w,b,m,C,D,y,B,v,x){var E,A,s=new (r([C,k],{curNode:null,activeStack:[],constructor:function(){var b=a.hitch(this,function(a){f.isDescendant(this.curNode,a)&&this.set("curNode",null);f.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});l.before(c,"empty",b);l.before(c,"destroy",b)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,b){var e=this,p=a.document&&a.document.body;if(p){var d=m("pointer-events")?"pointerdown":m("MSPointer")?
"MSPointerDown":m("touch-events")?"mousedown, touchstart":"mousedown",g=w(a.document,d,function(d){if(!d||!(d.target&&null==d.target.parentNode))e._onTouchNode(b||d.target,"mouse")}),t=w(p,"focusin",function(d){if(d.target.tagName){var a=d.target.tagName.toLowerCase();"#document"==a||"body"==a||(B.isFocusable(d.target)?e._onFocusNode(b||d.target):e._onTouchNode(b||d.target))}}),c=w(p,"focusout",function(d){e._onBlurNode(b||d.target)});return{remove:function(){g.remove();t.remove();c.remove();p=g=
t=c=null}}}},_onBlurNode:function(b){b=(new Date).getTime();b<E+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(a.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),b<A+100||(this._clearActiveWidgetsTimer=setTimeout(a.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){A=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);n.contains(a,"dijitPopup")&&(a=a.firstChild);var e=[];try{for(;a;){var p=h.get(a,"dijitPopupParent");if(p)a=v.byId(p).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===D.body())break;a=y.get(a.ownerDocument).frameElement}else{var d=a.getAttribute&&a.getAttribute("widgetId"),g=d&&v.byId(d);g&&!("mouse"==b&&g.get("disabled"))&&e.unshift(d);a=a.parentNode}}}catch(t){}this._setStack(e,
b)},_onFocusNode:function(a){a&&9!=a.nodeType&&(E=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var e=this.activeStack,p=e.length-1,d=a.length-1;if(a[d]!=e[p]){this.set("activeStack",a);var g;for(g=p;0<=g&&e[g]!=a[g];g--)if(p=v.byId(e[g]))p._hasBeenBlurred=!0,p.set("focused",!1),p._focusManager==this&&p._onBlur(b),
this.emit("widget-blur",p,b);for(g++;g<=d;g++)if(p=v.byId(a[g]))p.set("focused",!0),p._focusManager==this&&p._onFocus(b),this.emit("widget-focus",p,b)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));b(function(){var a=s.registerWin(y.get(document));m("ie")&&w(window,"unload",function(){a&&(a.remove(),a=null)})});x.focus=function(a){s.focus(a)};for(var u in s)/^_/.test(u)||(x.focus[u]="function"==typeof s[u]?a.hitch(s,u):s[u]);s.watch(function(a,b,e){x.focus[a]=e});return s})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),
function(l,r,f,h,n,c){return l([c,n],{_onMap:function(c){var a=this.constructor._onMap,h;if(!a||!a.FINAL)delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=!0;c=c.toLowerCase();a[c]?h=this[a[c].method]:(c=this._onCamelCase(c),this[c]&&(h=c));return h},on:function(c,a){var f=this._onMap(c),b=c.replace(/\-/g,""),m="on"+b in this.domNode;return f||!m?this.inherited(arguments):this.own(h(this.domNode,b,a))[0]},emit:function(c,a,h){var b,m,f,n=c.toLowerCase(),l=this.constructor._onMap||
this.registerConnectEvents();m=this[this._onMap(n)];a=a||{};a.target||(a.target=this);m&&(l&&l[n])&&(this._onObj2Arr(function(){b=Array.prototype.slice.call(arguments)},l[n].argKeys)(a),f=r.mixin({},arguments),f[2]=b,f[0]=l[n].name.replace(/^on/,""));return this.inherited(f||arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(l,r,f,h,n,c,k,a,w,b,m,C,D,y,B,v){function x(a){return eval("("+a+")")}function E(a){var e=a._nameCaseMap,b=a.prototype;if(!e||e._extendCnt<s){var e=a._nameCaseMap={},d;for(d in b)"_"!==d.charAt(0)&&(e[d.toLowerCase()]=d);e._extendCnt=s}return e}function A(a,e){var b=a.join();if(!u[b]){for(var d=[],g=0,t=a.length;g<t;g++){var c=a[g];d[d.length]=u[c]=u[c]||f.getObject(c)||~c.indexOf("/")&&(e?e(c):l(c))}g=d.shift();u[b]=d.length?g.createSubclass?g.createSubclass(d):g.extend.apply(g,d):g}return u[b]}
new Date("X");var s=0;w.after(f,"extend",function(){s++},!0);var u={},q={_clearCache:function(){s++;u={}},_functionFromScript:function(a,e){var b="",d="",g=a.getAttribute(e+"args")||a.getAttribute("args"),t=a.getAttribute("with"),g=(g||"").split(/\s*,\s*/);t&&t.length&&h.forEach(t.split(/\s*,\s*/),function(a){b+="with("+a+"){";d+="}"});return new Function(g,b+a.innerHTML+d)},instantiate:function(a,e,b){e=e||{};b=b||{};var d=(b.scope||r._scopeName)+"Type",g="data-"+(b.scope||r._scopeName)+"-",t=g+
"type",c=g+"mixins",m=[];h.forEach(a,function(a){var b=d in e?e[d]:a.getAttribute(t)||a.getAttribute(d);if(b){var g=a.getAttribute(c),b=g?[b].concat(g.split(/\s*,\s*/)):[b];m.push({node:a,types:b})}});return this._instantiate(m,e,b)},_instantiate:function(a,e,p,d){function g(d){!e._started&&!p.noStart&&h.forEach(d,function(d){"function"===typeof d.startup&&!d._started&&d.startup()});return d}a=h.map(a,function(d){var a=d.ctor||A(d.types,p.contextRequire);if(!a)throw Error("Unable to resolve constructor for: '"+
d.types.join()+"'");return this.construct(a,d.node,e,p,d.scripts,d.inherited)},this);return d?b(a).then(g):g(a)},construct:function(b,e,p,d,g,t){function c(d){C&&f.setObject(C,d);for(u=0;u<G.length;u++)w[G[u].advice||"after"](d,G[u].method,f.hitch(d,G[u].func),!0);for(u=0;u<L.length;u++)L[u].call(d);for(u=0;u<J.length;u++)d.watch(J[u].prop,J[u].func);for(u=0;u<K.length;u++)B(d,K[u].event,K[u].func);return d}var q=b&&b.prototype;d=d||{};var n={};d.defaults&&f.mixin(n,d.defaults);t&&f.mixin(n,t);var s;
D("dom-attributes-explicit")?s=e.attributes:D("dom-attributes-specified-flag")?s=h.filter(e.attributes,function(d){return d.specified}):(t=(/^input$|^img$/i.test(e.nodeName)?e:e.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),s=h.map(t.split(/\s+/),function(d){var a=d.toLowerCase();return{name:d,value:"LI"==e.nodeName&&"value"==d||"enctype"==a?e.getAttribute(a):e.getAttributeNode(a).value}}));var l=d.scope||r._scopeName;
t="data-"+l+"-";var k={};"dojo"!==l&&(k[t+"props"]="data-dojo-props",k[t+"type"]="data-dojo-type",k[t+"mixins"]="data-dojo-mixins",k[l+"type"]="dojoType",k[t+"id"]="data-dojo-id");for(var u=0,v,l=[],C,A;v=s[u++];){var F=v.name,H=F.toLowerCase();v=v.value;switch(k[H]||H){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":A=v;break;case "data-dojo-id":case "jsid":C=v;break;case "data-dojo-attach-point":case "dojoattachpoint":n.dojoAttachPoint=v;break;case "data-dojo-attach-event":case "dojoattachevent":n.dojoAttachEvent=
v;break;case "class":n["class"]=e.className;break;case "style":n.style=e.style&&e.style.cssText;break;default:if(F in q||(F=E(b)[H]||F),F in q)switch(typeof q[F]){case "string":n[F]=v;break;case "number":n[F]=v.length?Number(v):NaN;break;case "boolean":n[F]="false"!=v.toLowerCase();break;case "function":""===v||-1!=v.search(/[^\w\.]+/i)?n[F]=new Function(v):n[F]=f.getObject(v,!1)||new Function(v);l.push(F);break;default:H=q[F],n[F]=H&&"length"in H?v?v.split(/\s*,\s*/):[]:H instanceof Date?""==v?new Date(""):
"now"==v?new Date:m.fromISOString(v):H instanceof a?r.baseUrl+v:x(v)}else n[F]=v}}for(s=0;s<l.length;s++)k=l[s].toLowerCase(),e.removeAttribute(k),e[k]=null;if(A)try{A=x.call(d.propsThis,"{"+A+"}"),f.mixin(n,A)}catch(M){throw Error(M.toString()+" in data-dojo-props\x3d'"+A+"'");}f.mixin(n,p);g||(g=b&&(b._noScript||q._noScript)?[]:y("\x3e script[type^\x3d'dojo/']",e));var G=[],L=[],J=[],K=[];if(g)for(u=0;u<g.length;u++)k=g[u],e.removeChild(k),p=k.getAttribute(t+"event")||k.getAttribute("event"),d=
k.getAttribute(t+"prop"),A=k.getAttribute(t+"method"),l=k.getAttribute(t+"advice"),s=k.getAttribute("type"),k=this._functionFromScript(k,t),p?"dojo/connect"==s?G.push({method:p,func:k}):"dojo/on"==s?K.push({event:p,func:k}):n[p]=k:"dojo/aspect"==s?G.push({method:A,advice:l,func:k}):"dojo/watch"==s?J.push({prop:d,func:k}):L.push(k);b=(g=b.markupFactory||q.markupFactory)?g(n,e,b):new b(n,e);return b.then?b.then(c):c(b)},scan:function(a,b){function c(d){if(!d.inherited){d.inherited={};var a=d.node,b=
c(d.parent),a={dir:a.getAttribute("dir")||b.dir,lang:a.getAttribute("lang")||b.lang,textDir:a.getAttribute(n)||b.textDir},e;for(e in a)a[e]&&(d.inherited[e]=a[e])}return d.inherited}var d=[],g=[],t={},m=(b.scope||r._scopeName)+"Type",q="data-"+(b.scope||r._scopeName)+"-",f=q+"type",n=q+"textdir",q=q+"mixins",s=a.firstChild,k=b.inherited;if(!k){var u=function(d,a){return d.getAttribute&&d.getAttribute(a)||d.parentNode&&u(d.parentNode,a)},k={dir:u(a,"dir"),lang:u(a,"lang"),textDir:u(a,n)},w;for(w in k)k[w]||
delete k[w]}for(var k={inherited:k},v,x;;)if(s)if(1!=s.nodeType)s=s.nextSibling;else if(v&&"script"==s.nodeName.toLowerCase())(y=s.getAttribute("type"))&&/^dojo\/\w/i.test(y)&&v.push(s),s=s.nextSibling;else if(x)s=s.nextSibling;else{var y=s.getAttribute(f)||s.getAttribute(m);w=s.firstChild;if(!y&&(!w||3==w.nodeType&&!w.nextSibling))s=s.nextSibling;else{x=null;if(y){var B=s.getAttribute(q);v=B?[y].concat(B.split(/\s*,\s*/)):[y];try{x=A(v,b.contextRequire)}catch(E){}x||h.forEach(v,function(d){~d.indexOf("/")&&
!t[d]&&(t[d]=!0,g[g.length]=d)});B=x&&!x.prototype._noScript?[]:null;k={types:v,ctor:x,parent:k,node:s,scripts:B};k.inherited=c(k);d.push(k)}else k={node:s,scripts:v,parent:k};v=B;x=s.stopParser||x&&x.prototype.stopParser&&!b.template;s=w}}else{if(!k||!k.node)break;s=k.node.nextSibling;x=!1;k=k.parent;v=k.scripts}var G=new C;g.length?(D("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+g.join(", ")),(b.contextRequire||l)(g,function(){G.resolve(h.filter(d,function(d){if(!d.ctor)try{d.ctor=
A(d.types,b.contextRequire)}catch(a){}for(var g=d.parent;g&&!g.types;)g=g.parent;var t=d.ctor&&d.ctor.prototype;d.instantiateChildren=!(t&&t.stopParser&&!b.template);d.instantiate=!g||g.instantiate&&g.instantiateChildren;return d.instantiate}))})):G.resolve(d);return G.promise},_require:function(a,b){var c=x("{"+a.innerHTML+"}"),d=[],g=[],t=new C,m=b&&b.contextRequire||l,q;for(q in c)d.push(q),g.push(c[q]);m(g,function(){for(var a=0;a<d.length;a++)f.setObject(d[a],arguments[a]);t.resolve(arguments)});
return t.promise},_scanAmd:function(a,b){var c=new C,d=c.promise;c.resolve(!0);var g=this;y("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return g._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,b){var p;!b&&a&&a.rootNode?(b=a,p=b.rootNode):a&&f.isObject(a)&&!("nodeType"in a)?b=a:p=a;p=p?c.byId(p):k.body();b=b||{};var d=b.template?{template:!0}:{},g=[],t=this,m=this._scanAmd(p,b).then(function(){return t.scan(p,b)}).then(function(a){return t._instantiate(a,
d,b,!0)}).then(function(d){return g=g.concat(d)}).otherwise(function(d){console.error("dojo/parser::parse() error",d);throw d;});f.mixin(g,m);return g}};r.parser=q;n.parseOnLoad&&v(100,q,"parse");return q})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(l,r,f){return f("dijit.Destroyable",null,{destroy:function(h){this._destroyed=!0},own:function(){var h=["destroyRecursive","destroy","remove"];l.forEach(arguments,function(f){function c(){a.remove();
l.forEach(w,function(a){a.remove()})}var k,a=r.before(this,"destroy",function(a){f[k](a)}),w=[];f.then?(k="cancel",f.then(c,c)):l.forEach(h,function(a){"function"===typeof f[a]&&(k||(k=a),w.push(r.after(f,a,c,!0)))})},this);return arguments}})})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(l,r,f,h,n){return f("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,
_beforeFillContent:function(){if(this.widgetsInTemplate){var c=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);n.parse(c,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(h.hitch(this,function(c){this._startupWidgets=c;for(var a=0;a<c.length;a++)this._processTemplateNode(c[a],function(a,b){return a[b]},function(a,b,c){return b in
a?a.connect(a,b,c):a.on(b,c,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(c,h,a){return h(c,"dojoType")||h(c,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){l.forEach(this._startupWidgets,
function(c){c&&(!c._started&&c.startup)&&c.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(l,r,f,h,n,c,k,a){var w=r("dijit._TemplatedMixin",a,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var c=this.declaredClass,f=this;return k.substitute(a,this,
function(a,b){"!"==b.charAt(0)&&(a=h.getObject(b.substr(1),!1,f));if("undefined"==typeof a)throw Error(c+" template:"+b);return null==a?"":"!"==b.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=l(this.templatePath,{sanitize:!0}));var a=w.getCachedTemplate(this.templateString,
this._skipNodeCache,this.ownerDocument),c;if(h.isString(a)){if(c=f.toDom(this._stringRepl(a),this.ownerDocument),1!=c.nodeType)throw Error("Invalid template: "+a);}else c=a.cloneNode(!0);this.domNode=c}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var c=this.containerNode;if(a&&c)for(;a.hasChildNodes();)c.appendChild(a.firstChild)}});w._templateCache={};w.getCachedTemplate=function(a,c,h){var n=w._templateCache,l=a,r=n[l];
if(r){try{if(!r.ownerDocument||r.ownerDocument==(h||document))return r}catch(v){}f.destroy(r)}a=k.trim(a);if(c||a.match(/\$\{([^\}]+)\}/g))return n[l]=a;c=f.toDom(a,h);if(1!=c.nodeType)throw Error("Invalid template: "+a);return n[l]=c};c("ie")&&n(window,"unload",function(){var a=w._templateCache,c;for(c in a){var h=a[c];"object"==typeof h&&f.destroy(h);delete a[c]}});return w})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(l,
r,f,h,n){l=l(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(c){r.mixin(this,c);n.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});f("extend-esri")&&r.setObject("layers.KMLFolder",l,h);return l})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(l){return l.cache})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(l,r,f,h){f(function(){r("highcontrast")&&l.add(h.body(),"dijit_a11y")});return r})},
"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(l,r,f,h,n,c,k,a){l=l([c,k],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(a,b){r.mixin(this,b);this.initialize(a,b)},getTitle:function(a){var b;this.info&&(b=this.titleHasRelatedFields?"":this._getPopupValues(a,!0).title);return b||""},getContent:function(c){return this.info?
(new a({template:this,graphic:c,chartTheme:this.chartTheme},h.create("div"))).domNode:""}});f("extend-esri")&&r.setObject("dijit.PopupTemplate",l,n);return l})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(l,r,f,h,n,c,k){n.add("highcontrast",function(){var a=k.doc.createElement("div");a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+
(r.blankGif||l.toUrl("./resources/blank.gif"))+'");';k.body().appendChild(a);var c=h.getComputedStyle(a),b=c.backgroundImage,c=c.borderTopColor==c.borderRightColor||b&&("none"==b||"url(invalid-url:)"==b);8>=n("ie")?a.outerHTML="":k.body().removeChild(a);return c});c(function(){n("highcontrast")&&f.add(k.body(),"dj_a11y")});return n})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),
function(l,r,f,h,n,c,k){c.extend(l,{waiRole:"",waiState:""});return n("dijit._Templated",[r,f],{widgetsInTemplate:!1,constructor:function(){k.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(a,c){var b=this.inherited(arguments),f=c(a,"waiRole");f&&a.setAttribute("role",f);(f=c(a,"waiState"))&&h.forEach(f.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),a.setAttribute("aria-"+
b[0],b[1]))});return b}})})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(l,r,f,h){h.extend(r,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return f("dijit._FocusMixin",null,{_focusManager:l})})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(l,r,f,h,n,c,k,a,w,b,m,C,D){function y(){}function B(a){return function(b,c,h,s){return b&&"string"==typeof c&&b[c]==y?b.on(c.substring(2).toLowerCase(),k.hitch(h,s)):a.apply(f,arguments)}}l.around(f,"connect",B);c.connect&&l.around(c,"connect",B);l=h("dijit._Widget",[m,C,D],{onClick:y,onDblClick:y,onKeyDown:y,onKeyPress:y,onKeyUp:y,onMouseDown:y,onMouseMove:y,onMouseOut:y,onMouseOver:y,onMouseLeave:y,onMouseEnter:y,onMouseUp:y,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
y&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===y?f.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){c.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){c.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(b.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});n("dijit-legacy-requires")&&w(0,function(){require(["dijit/_base"])});
return l})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated ../kernel ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(l,r,f,h,n,c,k,a,w,b,m,C,D,y,B,v,x,E){var A=0;r=r([x,y,B],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=
h.mixin({},E.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(h.hitch(this,this._handleComponentsSuccess),h.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,h=a.length,q=this.domNode,f=this._prevMedia,e=this._nextMedia;if(1<h){var p=0,d=0;n.forEach(a,function(a){"image"===a.type?p++:-1!==a.type.indexOf("chart")&&d++});p&&(b.set(this._imageCount,"innerHTML",p),c.query(".summary .image",q).removeClass("hidden"));d&&(b.set(this._chartCount,"innerHTML",d),c.query(".summary .chart",q).removeClass("hidden"))}else c.query(".summary",
q).addClass("hidden"),m.add(f,"hidden"),m.add(e,"hidden");a=this._mediaPtr;0===a?m.add(f,"hidden"):m.remove(f,"hidden");a===h-1?m.add(e,"hidden"):m.remove(e,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],f=a.title,q=a.caption,n=c.query(".mediaSection .hzLine",this.domNode)[0];b.set(this._mediaTitle,"innerHTML",f);m[f?"remove":"add"](this._mediaTitle,"hidden");b.set(this._mediaCaption,"innerHTML",q);m[q?"remove":"add"](this._mediaCaption,"hidden");m[f&&
q?"remove":"add"](n,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var e=this,f=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],q=a.value.theme||this.chartTheme;h.isString(q)&&(q=q.replace(/\./gi,"/"),-1===q.indexOf("/")&&(q="dojox/charting/themes/"+q));q||(q="./Rainbow");f.push(q);try{var p=this._rid=A++;l(f,function(d,b,c){p===e._rid&&(e._rid=null,e._showChart(a.type,a.value,d,b,c))})}catch(d){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&h.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){m.add(this._mediaFrame,"image");var h=D.get(this._gallery,"height"),q="\x3cimg class\x3d'esriPopupMediaImage' src\x3d'"+a.sourceURL+"' /\x3e";a.linkURL&&(q="\x3ca "+(this._preventNewTab(a.linkURL)?"":"target\x3d'_blank' ")+"href\x3d'"+a.linkURL+"'\x3e"+q+"\x3c/a\x3e");b.set(this._mediaFrame,"innerHTML",q);var n=c.query(".esriPopupMediaImage",this._mediaFrame)[0],e=this,p;p=f.connect(n,"onload",function(){f.disconnect(p);
p=null;e._imageLoaded(n,h)})},_showChart:function(a,b,c,h,e){m.remove(this._mediaFrame,"image");c=this._chart=new c(C.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});e&&c.setTheme(e);switch(a){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",b.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});
n.forEach(b.fields,function(a,d){a.x=d+1});c.addSeries("Series A",b.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",gap:3});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",b.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",b.fields)}this._action=new h(c);
c.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);b.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),D.set(a,"marginTop",c+"px"))},_attListHandler:function(a,c){if(a===this._dfd){this._dfd=null;var h="";!(c instanceof Error)&&(c&&c.length)&&n.forEach(c,function(a){h+="\x3cli\x3e";h+="\x3ca href\x3d'"+a.url+"' target\x3d'_blank'\x3e"+
(a.name||"[No name]")+"\x3c/a\x3e";h+="\x3c/li\x3e"});b.set(this._attachmentsList,"innerHTML",h||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_handleComponentsSuccess:function(a){if(a){var f=this.showTitle?a.title:"",k=a.description,l=a.fields,e=a.mediaInfos,p=this.domNode,d=this._nls,g=this,t=this.template,r=this.graphic;this._prevMedia.title=d.NLS_prevMedia;this._nextMedia.title=d.NLS_nextMedia;b.set(this._title,"innerHTML",f);f||m.add(this._title,"hidden");!k&&l&&(k="",n.forEach(l,function(a){k+=
"\x3ctr valign\x3d'top'\x3e";k+="\x3ctd class\x3d'attrName'\x3e"+a[0]+"\x3c/td\x3e";k+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+d.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";k+="\x3c/tr\x3e"}),k&&(k="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+k+"\x3c/table\x3e"));b.set(this._description,"innerHTML",k);k||m.add(this._description,"hidden");c.query("a",this._description).forEach(function(a){g._preventNewTab(a.href)?
"_blank"===a.target&&b.remove(a,"target"):b.set(a,"target","_blank")});f&&k?c.query(".mainSection .hzLine",p).removeClass("hidden"):f||k?c.query(".mainSection .hzLine",p).addClass("hidden"):c.query(".mainSection",p).addClass("hidden");if(f=this._dfd=t.getAttachments(r))f.addBoth(h.hitch(this,this._attListHandler,f)),b.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+d.NLS_searching+"...\x3c/li\x3e"),c.query(".attachmentsSection",p).removeClass("hidden");e&&e.length&&(c.query(".mediaSection",p).removeClass("hidden"),
w.setSelectable(this._mediaFrame,!1),this._mediaInfos=e,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(b.set(this._editSummary,"innerHTML",a.editSummary),e&&e.length&&m.remove(this._mediaBreak,"hidden"),m.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});k("extend-esri")&&h.setObject("dijit._PopupRenderer",r,v);return r})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(l,r,f,h,n,c,k,a,w,b,m,C,D,y,B,v,x,E,A,s,u,q,z){function e(d){return function(b){a[b?"set":"remove"](this.domNode,d,b);this._set(d,b)}}D.add("dijit-legacy-requires",!y.isAsync);D.add("dojo-bidi",!1);D("dijit-legacy-requires")&&x(0,function(){l(["dijit/_base/manager"])});var p={};h=c("dijit._WidgetBase",[E,u],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:e("lang"),dir:"",_setDirAttr:e("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:h.blankGif||l.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},e;for(e in b.attributeMap)c.push(e);for(e in b)/^on/.test(e)&&(a[e.substring(2).toLowerCase()]=e),/^_set[A-Z](.*)Attr$/.test(e)&&(e=e.charAt(4).toLowerCase()+e.substr(5,
e.length-9),(!b.attributeMap||!(e in b.attributeMap))&&c.push(e))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=k.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,B.mixin(this,a));this.postMixInProperties();this.id||(this.id=z.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=s.body(this.ownerDocument);z.add(this);this.buildRendering();var e;if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&(c.parentNode&&this.domNode!==c)&&(c.parentNode.replaceChild(this.domNode,c),e=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();e&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);r.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var e=this._get(b);e&&this.set(b,e)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(r.map(a,function(a){return a+"Rtl"})));w.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,r.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&B.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(e){e.destroyRecursive?e.destroyRecursive(a):e.destroy&&e.destroy(a)}this._beingDestroyed=!0;this.uninitialize();r.forEach(this._connects,B.hitch(this,"disconnect"));r.forEach(this._supportingWidgets,b);this.domNode&&r.forEach(z.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
z.remove(this.id);this._destroyed=!0},destroyRendering:function(d){this.bgIframe&&(this.bgIframe.destroy(d),delete this.bgIframe);this.domNode&&(d?a.remove(this.domNode,"widgetId"):b.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(d||b.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){r.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;B.isObject(a)?
C.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(d,b,e){e=3<=arguments.length?e:this.attributeMap[d];r.forEach(B.isArray(e)?e:[e],function(e){var c=this[e.node||e||"domNode"];switch(e.type||"attribute"){case "attribute":B.isFunction(b)&&(b=B.hitch(this,b));e=e.attribute?e.attribute:/^on[A-Z][a-zA-Z]*$/.test(d)?d.toLowerCase():d;c.tagName?a.set(c,e,b):c.set(e,b);break;case "innerText":c.innerHTML="";c.appendChild(this.ownerDocument.createTextNode(b));
break;case "innerHTML":c.innerHTML=b;break;case "class":w.replace(c,b,this[d])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var e in a)this.set(e,a[e]);return this}e=this._getAttrNames(a);var c=this[e.s];if(B.isFunction(c))var h=c.apply(this,Array.prototype.slice.call(arguments,1));else{var c=this.focusNode&&!B.isFunction(this.focusNode)?"focusNode":"domNode",f=this[c]&&this[c].tagName,k;if(k=f)if(!(k=
p[f])){k=this[c];var n={},m;for(m in k)n[m.toLowerCase()]=!0;k=p[f]=n}m=k;e=a in this.attributeMap?this.attributeMap[a]:e.s in this?this[e.s]:m&&e.l in m&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?c:null;null!=e&&this._attrToDom(a,b,e);this._set(a,b)}return h||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var e=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+e+"Attr",
g:"_get"+e+"Attr",l:e.toLowerCase()}},_set:function(a,b){var e=this[a];this[a]=b;if(this._created&&!(e===b||e!==e&&b!==b))this._watchCallbacks&&this._watchCallbacks(a,e,b),this.emit("attrmodified-"+a,{detail:{prevValue:e,newValue:b}})},_get:function(a){return this[a]},emit:function(a,b,e){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var c,p=this["on"+a];p&&(c=p.apply(this,e?e:[b]));this._started&&!this._beingDestroyed&&
v.emit(this.domNode,a.toLowerCase(),b);return c},on:function(a,b){var e=this._onMap(a);return e?f.after(this,e,b,!0):this.own(v(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,e=b._onMap;if(!e){var e=b._onMap={},c;for(c in b.prototype)/^on/.test(c)&&(e[c.replace(/^on/,"").toLowerCase()]=c)}return e["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?z.findWidgets(this.containerNode):
[]},getParent:function(){return z.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,e){return this.own(n.connect(a,b,this,e))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(A.subscribe(a,B.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:m.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=C.get(this.domNode,"display")},placeAt:function(a,e){var c=!a.tagName&&
z.byId(a);c&&c.addChild&&(!e||"number"===typeof e)?c.addChild(this,e):(c=c&&"domNode"in c?c.containerNode&&!/after|before|replace/.test(e||"")?c.containerNode:c.domNode:k.byId(a,this.ownerDocument),b.place(this.domNode,c,e),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var e=setTimeout(B.hitch(this,function(){e&&(e=null,this._destroyed||B.hitch(this,a)())}),b||0);return{remove:function(){e&&(clearTimeout(e),e=null);return null}}}});D("dojo-bidi")&&
h.extend(q);return h})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(l,r){var f={};l.setObject("dojo.date.stamp",f);f.fromISOString=function(h,n){f._isoRegExp||(f._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var c=f._isoRegExp.exec(h),k=null;if(c){c.shift();c[1]&&c[1]--;c[6]&&(c[6]*=1E3);n&&(n=new Date(n),r.forEach(r.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),
function(a){return n["get"+a]()}),function(a,h){c[h]=c[h]||a}));k=new Date(c[0]||1970,c[1]||0,c[2]||1,c[3]||0,c[4]||0,c[5]||0,c[6]||0);100>c[0]&&k.setFullYear(c[0]||1970);var a=0,l=c[7]&&c[7].charAt(0);"Z"!=l&&(a=60*(c[8]||0)+(Number(c[9])||0),"-"!=l&&(a*=-1));l&&(a-=k.getTimezoneOffset());a&&k.setTime(k.getTime()+6E4*a)}return k};f.toISOString=function(h,f){var c=function(a){return 10>a?"0"+a:a};f=f||{};var k=[],a=f.zulu?"getUTC":"get",l="";"time"!=f.selector&&(l=h[a+"FullYear"](),l=["0000".substr((l+
"").length)+l,c(h[a+"Month"]()+1),c(h[a+"Date"]())].join("-"));k.push(l);if("date"!=f.selector){l=[c(h[a+"Hours"]()),c(h[a+"Minutes"]()),c(h[a+"Seconds"]())].join(":");a=h[a+"Milliseconds"]();f.milliseconds&&(l+="."+(100>a?"0":"")+c(a));if(f.zulu)l+="Z";else if("time"!=f.selector)var a=h.getTimezoneOffset(),b=Math.abs(a),l=l+((0<a?"-":"+")+c(Math.floor(b/60))+":"+c(b%60));k.push(l)}return k.join("T")};return f})},"*noref":1}});
define("esri/layers/KMLLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(l,r,f,h,n,c,k,a,w,b,m,C,D,y,B,v,x,E,A,s,u,q){var z=r([E],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+
"//utility.arcgis.com/sharing/kml",constructor:function(a,b){a||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=b&&b.outSR||new B({wkid:4326});this._options=h.mixin({},b);C.defaults.kmlService&&(this.serviceUrl=C.defaults.kmlService);var d=this.linkInfo=b&&b.linkInfo;d&&(this.visible=!!d.visibility,this._waitingForMap=!!d.viewFormat);(!d||d&&d.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=h.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",
!0)},getFeature:function(a){if(a){var b=a.type,d=a.id,c;switch(b){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(a=this["_"+b])&&(c=h.getObject("_mode._featureMap."+d,!1,a));break;case "GroundOverlay":if(a=this._groundLyr){var f=a.getImages(),b=f.length;for(a=0;a<b;a++)if(f[a].id===d){c=f[a];break}}break;case "ScreenOverlay":break;case "NetworkLink":n.some(this._links,function(a){return a.linkInfo&&a.linkInfo.id===d?(c=a,!0):!1});break;case "Folder":b=(f=this.folders)?
f.length:0;for(a=0;a<b;a++)if(f[a].id===d){c=f[a];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return c}},getLayers:function(){var a=[];this._groundLyr&&a.push(this._groundLyr);this._fLayers&&(a=a.concat(this._fLayers));this._links&&n.forEach(this._links,function(b){b.declaredClass&&a.push(b)});return a},setFolderVisibility:function(a,b){a&&(this._fireUpdateStart(),(a.visible=b)&&(b=this._areLocalAncestorsVisible(a)),this._setState(a,b),this._fireUpdateEnd())},onRefresh:function(){},
onOpacityChange:function(){},_parseKml:function(a){var b=this;this._fireUpdateStart();this._io=y({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(a),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:c.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(a){b._io=null;b._initLayer(a)},error:function(a){b._io=null;a=h.mixin(Error(),a);a.message="Unable to load KML: "+b.url+" "+(a.message||"");b._fireUpdateEnd(a);b.onError(a)}})},_initLayer:function(a){var b;
this.loaded&&(b=[],n.forEach(this.folders,function(a){a.visible&&b.push(a.id)}),this._removeInternalLayers());this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.visibility=a.visibility;this.featureInfos=a.featureInfos;var c,g,f=this.folders=a.folders,k=[],m;if(f){g=f.length;for(c=0;c<g;c++)m=f[c]=new A(f[c]),-1===m.parentFolderId&&k.push(m)}var f=this._links=a.networkLinks,l;g=f?f.length:0;for(c=0;c<g;c++)f[c].viewRefreshMode&&-1!==f[c].viewRefreshMode.toLowerCase().indexOf("onregion")||
(l=h.mixin({},this._options),l.linkInfo=f[c],l.id&&(l.id=l.id+"_"+c),f[c]=new z(f[c].href,l),f[c]._parentLayer=this,f[c]._parentFolderId=this._getLinkParentId(f[c].linkInfo.id));if((f=a.groundOverlays)&&0<f.length){l=h.mixin({},this._options);l.id&&(l.id+="_mapImage");m=this._groundLyr=new u(l);g=f.length;for(c=0;c<g;c++)m.addImage(new s(f[c]))}if((a=h.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=[],n.forEach(a,function(a,b){var c=h.getObject("featureSet.features",!1,a);c&&
0<c.length&&(l=h.mixin({outFields:["*"],infoTemplate:a.popupInfo?new x(a.popupInfo):null,editable:!1},this._options),l.id&&(l.id=l.id+"_"+b),a.layerDefinition.capabilities="Query,Data",c=new q(a,l),c.geometryType&&(this["_"+c.geometryType]=c),this._fLayers.push(c))},this),0===this._fLayers.length&&delete this._fLayers;if(!this.loaded){g=k.length;for(c=0;c<g;c++)m=k[c],this._setState(m,m.visible)}this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),n.forEach(this.folders,function(a){-1<n.indexOf(b,
a.id)?this.setFolderVisibility(a,!0):this.setFolderVisibility(a,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();this._links&&n.forEach(this._links,function(b){b.declaredClass&&(a.addLayer(b),b._waitingForMap&&(b._waitingForMap=null,b.visible?b._parseKml(a):b._wMap=a))});var b=a.spatialReference,c=this._outSR,g;if(!b.equals(c))if(b.isWebMercator()&&4326===c.wkid)g=v.geographicToWebMercator;else if(c.isWebMercator()&&
4326===b.wkid)g=v.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");return}this._groundLyr&&(g&&n.forEach(this._groundLyr.getImages(),function(a){a.extent=g(a.extent)}),a.addLayer(this._groundLyr));(b=this._fLayers)&&0<b.length&&n.forEach(b,function(b){if(g){var c=b.graphics,d,f,p=c?c.length:0;for(d=0;d<p;d++)(f=c[d].geometry)&&c[d].setGeometry(g(f))}a.addLayer(b)});
this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var a=this._map;this._links&&n.forEach(this._links,function(a){a.declaredClass&&a._io&&a._io.cancel()});a&&n.forEach(this.getLayers(),a.removeLayer,a)},_setState:function(a,b){var c=a.featureInfos,g,f,h,k=c?c.length:0,l=b?"show":"hide";for(h=0;h<k;h++)if(g=c[h],f=this.getFeature(g))if("Folder"===g.type)this._setState(f,b&&f.visible);else if("NetworkLink"===g.type)this._setInternalVisibility(f,b);else f[l]()},_areLocalAncestorsVisible:function(a){var b=
a.parentFolderId;for(a=a.visible;a&&-1!==b;)b=this.getFeature({type:"Folder",id:b}),a=a&&b.visible,b=b.parentFolderId;return a},_setInternalVisibility:function(a,b){var c=a._parentLayer,g=a._parentFolderId;for(b=b&&a.visible;b&&c;)b=b&&c.visible,-1<g&&(b=b&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",id:g}))),g=c._parentFolderId,c=c._parentLayer;this._setIntState(a,b)},_setIntState:function(a,b){a&&n.forEach(a.getLayers(),function(c){c.linkInfo?a._setIntState(c,b&&c.visible&&a._areLocalAncestorsVisible(a.getFeature({type:"Folder",
id:c._parentFolderId}))):c.setVisibility(b)})},_getLinkParentId:function(a){var b=-1;this.folders&&n.some(this.folders,function(c){return c.networkLinkIds&&-1!==n.indexOf(c.networkLinkIds,a)?(b=c.id,!0):!1});return b},_checkAutoRefresh:function(){var a=this.linkInfo;if(a)if(this.visible){if(this.loaded&&this._map){var b=a.refreshMode,c=a.refreshInterval,g=a.viewRefreshMode,a=a.viewRefreshTime;b&&(-1!==b.toLowerCase().indexOf("oninterval")&&0<c)&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,
1E3*c));g&&(-1!==g.toLowerCase().indexOf("onstop")&&0<a)&&!this._extChgHandle&&(this._extChgHandle=f.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),f.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(b){b=b||this._map;var c={},d=this.linkInfo,g=b&&b.extent,f;this._url.query&&(h.mixin(c,this._url.query),f=!!this._url.query.token);
if(m.id&&!f&&(f=m.id.findCredential(this._url.path)))c.token=f.token;if(d){f=d.viewFormat;var k=d.httpQuery,d=d.viewBoundScale;if(g&&f){var n=g,q=g,r=g.spatialReference;r&&(r.isWebMercator()?n=v.webMercatorToGeographic(g):4326===r.wkid&&(q=v.geographicToWebMercator(g)));g=n.getCenter();q=Math.max(q.getWidth(),q.getHeight());d&&(n=n.expand(d));f=f.replace(/\[bboxWest\]/ig,n.xmin).replace(/\[bboxEast\]/ig,n.xmax).replace(/\[bboxSouth\]/ig,n.ymin).replace(/\[bboxNorth\]/ig,n.ymax).replace(/\[lookatLon\]/ig,
g.x).replace(/\[lookatLat\]/ig,g.y).replace(/\[lookatRange\]/ig,q).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,g.x).replace(/\[lookatTerrainLat\]/ig,g.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,g.x).replace(/\[cameraLat\]/ig,g.y).replace(/\[cameraAlt\]/ig,q).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,b.width).replace(/\[vertPixels\]/ig,b.height).replace(/\[terrainEnabled\]/ig,0);h.mixin(c,
a.queryToObject(f))}k&&(k=k.replace(/\[clientVersion\]/ig,m.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,l.locale),h.mixin(c,a.queryToObject(k)))}b=[];for(var s in c)D.isDefined(c[s])&&b.push(s+"\x3d"+c[s]);return(b=b.join("\x26"))?"?"+b:""},setScaleRange:function(a,b){this.inherited(arguments);n.forEach(this.getLayers(),function(c){c.setScaleRange(a,b)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},
setOpacity:function(a){this.opacity!=a&&(n.forEach(this.getLayers(),function(b){b.setOpacity(a)}),this.opacity=this._options.opacity=a,this.onOpacityChange(a))},_setMap:function(a,c){this.inherited(arguments);this._map=a;var d=this._div=w.create("div",null,c);b.set(d,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return d},_unsetMap:function(a,b){this._io&&this._io.cancel();this._stopAutoRefresh();f.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();
var c=this._div;c&&(b.removeChild(c),w.destroy(c));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(a){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,a),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&a&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._parseKml()},getFeatureCollection:function(a){var b,c=[];if(a=this.getFeature({type:"Folder",id:a}))(b=
n.map(a.featureInfos,function(a){if("esriGeometryPoint"===a.type||"esriGeometryPolyline"===a.type||"esriGeometryPolygon"===a.type)return a.id},this))&&0<b.length&&n.forEach(this._fLayers,function(a){var e,f;e=a.toJson();e.featureSet.features&&0<e.featureSet.features.length&&(f=n.filter(e.featureSet.features,function(c){if(-1!==n.indexOf(b,c.attributes[a.objectIdField]))return c},this));f&&0<f.length&&(e.featureSet.features=f,c.push(e))},this);return c},getFeatureCount:function(a){a=this.getFeature({type:"Folder",
id:a});var b={points:0,polylines:0,polygons:0};a&&n.forEach(a.featureInfos,function(a){"esriGeometryPoint"===a.type&&(b.points+=1);"esriGeometryPolyline"===a.type&&(b.polylines+=1);"esriGeometryPolygon"===a.type&&(b.polygons+=1)});return b},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});k("extend-esri")&&h.setObject("layers.KMLLayer",z,m);return z});