// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.12/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(g,e,k,n,d,f){g=n("dijit._OnDijitClickMixin",null,{connect:function(b,a,c){return this.inherited(arguments,[b,"ondijitclick"==a?f:a,c])}});g.a11yclick=f;return g})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(g,e,k,n,d,f,b){var a={_isElementShown:function(a){var h=
n.get(a);return"hidden"!=h.visibility&&"collapsed"!=h.visibility&&"none"!=h.display&&"hidden"!=k.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return k.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var h;try{var b=a.contentDocument;if("designMode"in b&&"on"==b.designMode)return!0;h=b.body}catch(t){try{h=a.contentWindow.document.body}catch(x){return!1}}return h&&("true"==h.contentEditable||
h.firstChild&&"true"==h.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(c){return k.get(c,"disabled")?void 0:k.has(c,"tabIndex")?+k.get(c,"tabIndex"):a.hasDefaultTabStop(c)?0:void 0},isTabNavigable:function(c){return 0<=a.effectiveTabIndex(c)},isFocusable:function(c){return-1<=a.effectiveTabIndex(c)},_getTabNavigable:function(c){function h(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}
var b,t,x,g,d,r,e={},n=a._isElementShown,y=a.effectiveTabIndex,p=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=f("ie")&&"HTML"!==a.scopeName||!n(a))){var c=y(a);if(0<=c){if(0==c)b||(b=a),t=a;else if(0<c){if(!x||c<g)g=c,x=a;if(!d||c>=r)r=c,d=a}c=h(a);k.get(a,"checked")&&c&&(e[c]=a)}"SELECT"!=a.nodeName.toUpperCase()&&p(a)}};n(c)&&p(c);return{first:e[h(b)]||b,last:e[h(t)]||t,lowest:e[h(x)]||x,highest:e[h(d)]||d}},getFirstInTabbingOrder:function(c,h){var b=a._getTabNavigable(e.byId(c,
h));return b.lowest?b.lowest:b.first},getLastInTabbingOrder:function(c,h){var b=a._getTabNavigable(e.byId(c,h));return b.last?b.last:b.highest}};d.mixin(b,a);return a})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/has dojo/string ../kernel ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(g,e,k,n,d,f,b,a,c,h,v,t){g=g(v,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(a,
b){b||(b={});this.urlTemplate=a;var d=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new c({wkid:102100})),g=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new c({wkid:102100}));this.initialExtent=b.initialExtent||d;this.fullExtent=b.fullExtent||g;this.tileInfo=b.tileInfo?b.tileInfo:new t({rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},
{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,
scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new c(this.tileInfo.spatialReference.toJson());this.copyright=b.copyright||"";var e=new n(a),d=e.scheme+"://"+e.authority+"/";this.urlPath=a.substring(d.length);this.tileServers=b.tileServers||[];-1===e.authority.indexOf("{subDomain}")&&this.tileServers.push(d);if(b.subDomains&&0<b.subDomains.length&&1<e.authority.split(".").length){this.subDomains=b.subDomains;var v;k.forEach(b.subDomains,function(a,
c){-1<e.authority.indexOf("${subDomain}")?v=e.scheme+"://"+f.substitute(e.authority,{subDomain:a})+"/":-1<e.authority.indexOf("{subDomain}")&&(v=e.scheme+"://"+e.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(v)},this)}this.tileServers=k.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});this._levelToLevelValue=[];k.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=a.levelValue||a.level},this);this.loaded=!0;this.onLoad(this)},
getTileUrl:function(c,b,h){c=this._levelToLevelValue[c];var e=this.tileServers[b%this.tileServers.length]+f.substitute(this.urlPath,{level:c,col:h,row:b}),e=e.replace(/\{level\}/gi,c).replace(/\{row\}/gi,b).replace(/\{col\}/gi,h),e=this.addTimestampToURL(e);return a.addProxy(e)}});d("extend-esri")&&e.setObject("layers.WebTiledLayer",g,b);return g})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(g,e,
k,n,d,f){var b=g(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){e.isObject(a)&&(e.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&
"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new f(a.viewpoint)))},toJson:function(){var a=null,c=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(c)for(var a=[],b=0;b<c;b++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[b].declaredClass?this.multidimensionalDefinition[b].toJson():this.multidimensionalDefinition[b]);a=
{mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return d.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var c=b.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":c=b.METHOD_ATTRIBUTE;break;case "center":c=b.METHOD_CENTER;break;
case "lockraster":c=b.METHOD_LOCKRASTER;break;case "nadir":c=b.METHOD_NADIR;break;case "northwest":c=b.METHOD_NORTHWEST;break;case "seamline":c=b.METHOD_SEAMLINE;break;case "viewpoint":c=b.METHOD_VIEWPOINT}return c}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return b.OPERATION_FIRST;case "last":return b.OPERATION_LAST;case "max":return b.OPERATION_MAX;case "min":return b.OPERATION_MIN;case "blend":return b.OPERATION_BLEND;case "mean":return b.OPERATION_MEAN}}});e.mixin(b,
{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});k("extend-esri")&&e.setObject("layers.MosaicRule",b,n);return b})},
"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(g,e,k,n){function d(a){if((a.keyCode===g.ENTER||a.keyCode===g.SPACE)&&!/input|button|textarea/i.test(a.target.nodeName))for(a=a.target;a;a=a.parentNode)if(a.dojoClick)return!0}var f;k(document,"keydown",function(a){d(a)?(f=a.target,a.preventDefault()):f=null});k(document,"keyup",function(a){d(a)&&a.target==f&&(f=null,k.emit(a.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,
metaKey:a.metaKey,altKey:a.altKey,_origType:a.type}))});var b=function(a,c){a.dojoClick=!0;return k(a,"click",c)};b.click=b;b.press=function(a,c){var b=k(a,n.press,function(a){("mousedown"!=a.type||e.isLeft(a))&&c(a)}),d=k(a,"keydown",function(a){(a.keyCode===g.ENTER||a.keyCode===g.SPACE)&&c(a)});return{remove:function(){b.remove();d.remove()}}};b.release=function(a,c){var b=k(a,n.release,function(a){("mouseup"!=a.type||e.isLeft(a))&&c(a)}),d=k(a,"keyup",function(a){(a.keyCode===g.ENTER||a.keyCode===
g.SPACE)&&c(a)});return{remove:function(){b.remove();d.remove()}}};b.move=n.move;return b})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(g,e,k,n,d,f){g=g(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(b){b.catalogItems&&(this.catalogItems=new f(b.catalogItems));b.location&&(this.location=d.fromJson(b.location));this.catalogItemVisibilities=
b.catalogItemVisibilities;this.name=b.name;this.objectId=b.objectId;this.value=b.value;this.properties=b.properties}});k("extend-esri")&&e.setObject("tasks.ImageServiceIdentifyResult",g,n);return g})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(g,e,k,n,d,f,b,a,c,h){function v(l,m,a){return w&&a?function(l,m){return f(l,a,m)}:D?function(a,s){var c=f(a,m,function(l){s.call(this,l);q=(new Date).getTime()}),
A=f(a,l,function(l){(!q||(new Date).getTime()>q+1E3)&&s.call(this,l)});return{remove:function(){c.remove();A.remove()}}}:function(m,a){return f(m,l,a)}}function t(l){do if(void 0!==l.dojoClick)return l;while(l=l.parentNode)}function x(a,m,s){var q=t(a.target);if(y=!a.target.disabled&&q&&q.dojoClick)if(z=(p="useTarget"==y)?q:a.target,p&&a.preventDefault(),F=a.changedTouches?a.changedTouches[0].pageX-h.global.pageXOffset:a.clientX,C=a.changedTouches?a.changedTouches[0].pageY-h.global.pageYOffset:a.clientY,
E=("object"==typeof y?y.x:"number"==typeof y?y:0)||4,I=("object"==typeof y?y.y:"number"==typeof y?y:0)||4,!B){B=!0;var c=function(l){y=p?k.isDescendant(h.doc.elementFromPoint(l.changedTouches?l.changedTouches[0].pageX-h.global.pageXOffset:l.clientX,l.changedTouches?l.changedTouches[0].pageY-h.global.pageYOffset:l.clientY),z):y&&(l.changedTouches?l.changedTouches[0].target:l.target)==z&&Math.abs((l.changedTouches?l.changedTouches[0].pageX-h.global.pageXOffset:l.clientX)-F)<=E&&Math.abs((l.changedTouches?
l.changedTouches[0].pageY-h.global.pageYOffset:l.clientY)-C)<=I};h.doc.addEventListener(m,function(l){c(l);p&&l.preventDefault()},!0);h.doc.addEventListener(s,function(a){c(a);if(y){l=(new Date).getTime();var m=p?z:a.target;"LABEL"===m.tagName&&(m=k.byId(m.getAttribute("for"))||m);var s=a.changedTouches?a.changedTouches[0]:a,q=document.createEvent("MouseEvents");q._dojo_click=!0;q.initMouseEvent("click",!0,!0,a.view,a.detail,s.screenX,s.screenY,s.clientX,s.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,
0,null);setTimeout(function(){f.emit(m,"click",q);l=(new Date).getTime()},0)}},!0);a=function(a){h.doc.addEventListener(a,function(m){!m._dojo_click&&((new Date).getTime()<=l+1E3&&!("INPUT"==m.target.tagName&&n.contains(m.target,"dijitOffScreen")))&&(m.stopPropagation(),m.stopImmediatePropagation&&m.stopImmediatePropagation(),"click"==a&&(("INPUT"!=m.target.tagName||"radio"==m.target.type||"checkbox"==m.target.type)&&"TEXTAREA"!=m.target.tagName&&"AUDIO"!=m.target.tagName&&"VIDEO"!=m.target.tagName)&&
m.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var u=5>b("ios"),w=b("pointer-events")||b("MSPointer"),r=function(){var l={},a;for(a in{down:1,move:1,up:1,cancel:1,over:1,out:1})l[a]=b("MSPointer")?"MSPointer"+a.charAt(0).toUpperCase()+a.slice(1):"pointer"+a;return l}(),D=b("touch-events"),B,y,p=!1,z,F,C,E,I,l,q,s;w?c(function(){h.doc.addEventListener(r.down,function(l){x(l,r.move,r.up)},!0)}):D&&c(function(){function l(a){var s=d.delegate(a,{bubbles:!0});6<=b("ios")&&(s.touches=
a.touches,s.altKey=a.altKey,s.changedTouches=a.changedTouches,s.ctrlKey=a.ctrlKey,s.metaKey=a.metaKey,s.shiftKey=a.shiftKey,s.targetTouches=a.targetTouches);return s}s=h.body();h.doc.addEventListener("touchstart",function(l){q=(new Date).getTime();var a=s;s=l.target;f.emit(a,"dojotouchout",{relatedTarget:s,bubbles:!0});f.emit(s,"dojotouchover",{relatedTarget:a,bubbles:!0});x(l,"touchmove","touchend")},!0);f(h.doc,"touchmove",function(a){q=(new Date).getTime();var c=h.doc.elementFromPoint(a.pageX-
(u?0:h.global.pageXOffset),a.pageY-(u?0:h.global.pageYOffset));c&&(s!==c&&(f.emit(s,"dojotouchout",{relatedTarget:c,bubbles:!0}),f.emit(c,"dojotouchover",{relatedTarget:s,bubbles:!0}),s=c),f.emit(c,"dojotouchmove",l(a))||a.preventDefault())});f(h.doc,"touchend",function(a){q=(new Date).getTime();var s=h.doc.elementFromPoint(a.pageX-(u?0:h.global.pageXOffset),a.pageY-(u?0:h.global.pageYOffset))||h.body();f.emit(s,"dojotouchend",l(a))})});e={press:v("mousedown","touchstart",r.down),move:v("mousemove",
"dojotouchmove",r.move),release:v("mouseup","dojotouchend",r.up),cancel:v(a.leave,"touchcancel",w?r.cancel:null),over:v("mouseover","dojotouchover",r.over),out:v("mouseout","dojotouchout",r.out),enter:a._eventHandler(v("mouseover","dojotouchover",r.over)),leave:a._eventHandler(v("mouseout","dojotouchout",r.out))};return g.touch=e})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),
function(g,e,k,n,d,f,b,a,c){var h=d.delegate(a,{mouseenter:f.enter,mouseleave:f.leave,keypress:k._keypress}),v;k=n("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var c=a;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(a,c){return a.getAttribute(c)},this._attach)||
this.searchContainerNode)&&c.firstChild)c=c.firstChild;else{if(c==a)break;for(;!c.nextSibling;)if(c=c.parentNode,c==a)return;c=c.nextSibling}},_processTemplateNode:function(a,c,b){var h=!0,e=this.attachScope||this,k=c(a,"dojoAttachPoint")||c(a,"data-dojo-attach-point");if(k)for(var g=k.split(/\s*,\s*/);k=g.shift();)d.isArray(e[k])?e[k].push(a):e[k]=a,h="containerNode"!=k,this._attachPoints.push(k);if(c=c(a,"dojoAttachEvent")||c(a,"data-dojo-attach-event")){k=c.split(/\s*,\s*/);for(g=d.trim;c=k.shift();)if(c){var f=
null;-1!=c.indexOf(":")?(f=c.split(":"),c=g(f[0]),f=g(f[1])):c=g(c);f||(f=c);this._attachEvents.push(b(a,c,d.hitch(e,f)))}}return h},_attach:function(a,c,e){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?v||(v=g("./a11yclick")):h[c]||c;return b(a,c,e)},_detachTemplateNodes:function(){var a=this.attachScope||this;e.forEach(this._attachPoints,function(c){delete a[c]});this._attachPoints=[];e.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();
this.inherited(arguments)}});d.extend(c,{dojoAttachEvent:"",dojoAttachPoint:""});return k})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(g,e,k,n,d,f,b){g=g(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,
toJson:function(a){var c=a&&a.geometry||this.geometry;a={geometry:c,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?k.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?k.toJson(this.renderingRule.toJson()):null};c&&(a.geometryType=b.getJsonType(c));c=this.timeExtent;a.time=c?c.toJson().join(","):null;f.isDefined(this.pixelSizeX)&&f.isDefined(this.pixelSizeY)?a.pixelSize=k.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):
this.pixelSize&&(a.pixelSize=this.pixelSize?k.toJson(this.pixelSize.toJson()):null);return a}});n("extend-esri")&&e.setObject("tasks.ImageServiceIdentifyParameters",g,d);return g})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(g,e,k,n,d,f,b,a,c,h,v,t,x,u,w,r,D){var B,y,p=new (e([t,
b],{curNode:null,activeStack:[],constructor:function(){var c=a.hitch(this,function(a){k.isDescendant(this.curNode,a)&&this.set("curNode",null);k.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});g.before(f,"empty",c);g.before(f,"destroy",c)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,b){var h=this,e=a.document&&a.document.body;if(e){var l=v("pointer-events")?"pointerdown":v("MSPointer")?"MSPointerDown":v("touch-events")?"mousedown, touchstart":
"mousedown",q=c(a.document,l,function(a){if(!a||!(a.target&&null==a.target.parentNode))h._onTouchNode(b||a.target,"mouse")}),s=c(e,"focusin",function(a){if(a.target.tagName){var l=a.target.tagName.toLowerCase();"#document"==l||"body"==l||(w.isFocusable(a.target)?h._onFocusNode(b||a.target):h._onTouchNode(b||a.target))}}),k=c(e,"focusout",function(a){h._onBlurNode(b||a.target)});return{remove:function(){q.remove();s.remove();k.remove();e=q=s=k=null}}}},_onBlurNode:function(c){c=(new Date).getTime();
c<B+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(a.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),c<y+100||(this._clearActiveWidgetsTimer=setTimeout(a.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,c){y=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),
delete this._clearActiveWidgetsTimer);d.contains(a,"dijitPopup")&&(a=a.firstChild);var b=[];try{for(;a;){var h=n.get(a,"dijitPopupParent");if(h)a=r.byId(h).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===x.body())break;a=u.get(a.ownerDocument).frameElement}else{var l=a.getAttribute&&a.getAttribute("widgetId"),q=l&&r.byId(l);q&&!("mouse"==c&&q.get("disabled"))&&b.unshift(l);a=a.parentNode}}}catch(s){}this._setStack(b,c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(B=(new Date).getTime(),
this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,c){var b=this.activeStack,h=b.length-1,l=a.length-1;if(a[l]!=b[h]){this.set("activeStack",a);var q;for(q=h;0<=q&&b[q]!=a[q];q--)if(h=r.byId(b[q]))h._hasBeenBlurred=!0,h.set("focused",!1),h._focusManager==this&&h._onBlur(c),this.emit("widget-blur",h,c);for(q++;q<=l;q++)if(h=r.byId(a[q]))h.set("focused",
!0),h._focusManager==this&&h._onFocus(c),this.emit("widget-focus",h,c)}},focus:function(a){if(a)try{a.focus()}catch(c){}}}));h(function(){var a=p.registerWin(u.get(document));v("ie")&&c(window,"unload",function(){a&&(a.remove(),a=null)})});D.focus=function(a){p.focus(a)};for(var z in p)/^_/.test(z)||(D.focus[z]="function"==typeof p[z]?a.hitch(p,z):p[z]);p.watch(function(a,c,b){D.focus[a]=b});return p})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),
function(g,e,k,n,d,f){return g([f,d],{_onMap:function(b){var a=this.constructor._onMap,c;if(!a||!a.FINAL)delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=!0;b=b.toLowerCase();a[b]?c=this[a[b].method]:(b=this._onCamelCase(b),this[b]&&(c=b));return c},on:function(b,a){var c=this._onMap(b),h=b.replace(/\-/g,""),e="on"+h in this.domNode;return c||!e?this.inherited(arguments):this.own(n(this.domNode,h,a))[0]},emit:function(b,a,c){var h,k,d,g=b.toLowerCase(),f=this.constructor._onMap||
this.registerConnectEvents();k=this[this._onMap(g)];a=a||{};a.target||(a.target=this);k&&(f&&f[g])&&(this._onObj2Arr(function(){h=Array.prototype.slice.call(arguments)},f[g].argKeys)(a),d=e.mixin({},arguments),d[2]=h,d[0]=f[g].name.replace(/^on/,""));return this.inherited(d||arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(g,e,k,n,d,f,b,a,c,h,v,t,x,u,w,r){function D(a){return eval("("+a+")")}function B(a){var c=a._nameCaseMap,b=a.prototype;if(!c||c._extendCnt<p){var c=a._nameCaseMap={},l;for(l in b)"_"!==l.charAt(0)&&(c[l.toLowerCase()]=l);c._extendCnt=p}return c}function y(a,c){var b=a.join();if(!z[b]){for(var l=[],q=0,s=a.length;q<s;q++){var h=a[q];l[l.length]=z[h]=z[h]||k.getObject(h)||~h.indexOf("/")&&(c?c(h):g(h))}q=l.shift();z[b]=l.length?q.createSubclass?q.createSubclass(l):q.extend.apply(q,l):q}return z[b]}
new Date("X");var p=0;c.after(k,"extend",function(){p++},!0);var z={},F={_clearCache:function(){p++;z={}},_functionFromScript:function(a,c){var b="",l="",q=a.getAttribute(c+"args")||a.getAttribute("args"),s=a.getAttribute("with"),q=(q||"").split(/\s*,\s*/);s&&s.length&&n.forEach(s.split(/\s*,\s*/),function(a){b+="with("+a+"){";l+="}"});return new Function(q,b+a.innerHTML+l)},instantiate:function(a,c,b){c=c||{};b=b||{};var l=(b.scope||e._scopeName)+"Type",q="data-"+(b.scope||e._scopeName)+"-",s=q+
"type",h=q+"mixins",m=[];n.forEach(a,function(a){var q=l in c?c[l]:a.getAttribute(s)||a.getAttribute(l);if(q){var b=a.getAttribute(h),q=b?[q].concat(b.split(/\s*,\s*/)):[q];m.push({node:a,types:q})}});return this._instantiate(m,c,b)},_instantiate:function(a,c,b,l){function q(a){!c._started&&!b.noStart&&n.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=n.map(a,function(a){var l=a.ctor||y(a.types,b.contextRequire);if(!l)throw Error("Unable to resolve constructor for: '"+
a.types.join()+"'");return this.construct(l,a.node,c,b,a.scripts,a.inherited)},this);return l?h(a).then(q):q(a)},construct:function(b,h,d,l,q,s){function g(a){y&&k.setObject(y,a);for(t=0;t<K.length;t++)c[K[t].advice||"after"](a,K[t].method,k.hitch(a,K[t].func),!0);for(t=0;t<N.length;t++)N[t].call(a);for(t=0;t<J.length;t++)a.watch(J[t].prop,J[t].func);for(t=0;t<M.length;t++)w(a,M[t].event,M[t].func);return a}var m=b&&b.prototype;l=l||{};var A={};l.defaults&&k.mixin(A,l.defaults);s&&k.mixin(A,s);var G;
x("dom-attributes-explicit")?G=h.attributes:x("dom-attributes-specified-flag")?G=n.filter(h.attributes,function(a){return a.specified}):(s=(/^input$|^img$/i.test(h.nodeName)?h:h.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),G=n.map(s.split(/\s+/),function(a){var l=a.toLowerCase();return{name:a,value:"LI"==h.nodeName&&"value"==a||"enctype"==l?h.getAttribute(l):h.getAttributeNode(l).value}}));var f=l.scope||e._scopeName;
s="data-"+f+"-";var r={};"dojo"!==f&&(r[s+"props"]="data-dojo-props",r[s+"type"]="data-dojo-type",r[s+"mixins"]="data-dojo-mixins",r[f+"type"]="dojoType",r[s+"id"]="data-dojo-id");for(var t=0,p,f=[],y,z;p=G[t++];){var H=p.name,F=H.toLowerCase();p=p.value;switch(r[F]||F){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":z=p;break;case "data-dojo-id":case "jsid":y=p;break;case "data-dojo-attach-point":case "dojoattachpoint":A.dojoAttachPoint=p;break;case "data-dojo-attach-event":case "dojoattachevent":A.dojoAttachEvent=
p;break;case "class":A["class"]=h.className;break;case "style":A.style=h.style&&h.style.cssText;break;default:if(H in m||(H=B(b)[F]||H),H in m)switch(typeof m[H]){case "string":A[H]=p;break;case "number":A[H]=p.length?Number(p):NaN;break;case "boolean":A[H]="false"!=p.toLowerCase();break;case "function":""===p||-1!=p.search(/[^\w\.]+/i)?A[H]=new Function(p):A[H]=k.getObject(p,!1)||new Function(p);f.push(H);break;default:F=m[H],A[H]=F&&"length"in F?p?p.split(/\s*,\s*/):[]:F instanceof Date?""==p?new Date(""):
"now"==p?new Date:v.fromISOString(p):F instanceof a?e.baseUrl+p:D(p)}else A[H]=p}}for(G=0;G<f.length;G++)r=f[G].toLowerCase(),h.removeAttribute(r),h[r]=null;if(z)try{z=D.call(l.propsThis,"{"+z+"}"),k.mixin(A,z)}catch(O){throw Error(O.toString()+" in data-dojo-props\x3d'"+z+"'");}k.mixin(A,d);q||(q=b&&(b._noScript||m._noScript)?[]:u("\x3e script[type^\x3d'dojo/']",h));var K=[],N=[],J=[],M=[];if(q)for(t=0;t<q.length;t++)r=q[t],h.removeChild(r),d=r.getAttribute(s+"event")||r.getAttribute("event"),l=
r.getAttribute(s+"prop"),z=r.getAttribute(s+"method"),f=r.getAttribute(s+"advice"),G=r.getAttribute("type"),r=this._functionFromScript(r,s),d?"dojo/connect"==G?K.push({method:d,func:r}):"dojo/on"==G?M.push({event:d,func:r}):A[d]=r:"dojo/aspect"==G?K.push({method:z,advice:f,func:r}):"dojo/watch"==G?J.push({prop:l,func:r}):N.push(r);b=(q=b.markupFactory||m.markupFactory)?q(A,h,b):new b(A,h);return b.then?b.then(g):g(b)},scan:function(a,c){function b(a){if(!a.inherited){a.inherited={};var l=a.node,c=
b(a.parent),l={dir:l.getAttribute("dir")||c.dir,lang:l.getAttribute("lang")||c.lang,textDir:l.getAttribute(G)||c.textDir},m;for(m in l)l[m]&&(a.inherited[m]=l[m])}return a.inherited}var l=[],q=[],s={},h=(c.scope||e._scopeName)+"Type",m="data-"+(c.scope||e._scopeName)+"-",A=m+"type",G=m+"textdir",m=m+"mixins",d=a.firstChild,f=c.inherited;if(!f){var k=function(a,l){return a.getAttribute&&a.getAttribute(l)||a.parentNode&&k(a.parentNode,l)},f={dir:k(a,"dir"),lang:k(a,"lang"),textDir:k(a,G)},r;for(r in f)f[r]||
delete f[r]}for(var f={inherited:f},v,p;;)if(d)if(1!=d.nodeType)d=d.nextSibling;else if(v&&"script"==d.nodeName.toLowerCase())(u=d.getAttribute("type"))&&/^dojo\/\w/i.test(u)&&v.push(d),d=d.nextSibling;else if(p)d=d.nextSibling;else{var u=d.getAttribute(A)||d.getAttribute(h);r=d.firstChild;if(!u&&(!r||3==r.nodeType&&!r.nextSibling))d=d.nextSibling;else{p=null;if(u){var w=d.getAttribute(m);v=w?[u].concat(w.split(/\s*,\s*/)):[u];try{p=y(v,c.contextRequire)}catch(D){}p||n.forEach(v,function(a){~a.indexOf("/")&&
!s[a]&&(s[a]=!0,q[q.length]=a)});w=p&&!p.prototype._noScript?[]:null;f={types:v,ctor:p,parent:f,node:d,scripts:w};f.inherited=b(f);l.push(f)}else f={node:d,scripts:v,parent:f};v=w;p=d.stopParser||p&&p.prototype.stopParser&&!c.template;d=r}}else{if(!f||!f.node)break;d=f.node.nextSibling;p=!1;f=f.parent;v=f.scripts}var B=new t;q.length?(x("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+q.join(", ")),(c.contextRequire||g)(q,function(){B.resolve(n.filter(l,function(a){if(!a.ctor)try{a.ctor=
y(a.types,c.contextRequire)}catch(l){}for(var m=a.parent;m&&!m.types;)m=m.parent;var q=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(q&&q.stopParser&&!c.template);a.instantiate=!m||m.instantiate&&m.instantiateChildren;return a.instantiate}))})):B.resolve(l);return B.promise},_require:function(a,c){var b=D("{"+a.innerHTML+"}"),l=[],q=[],s=new t,h=c&&c.contextRequire||g,m;for(m in b)l.push(m),q.push(b[m]);h(q,function(){for(var a=0;a<l.length;a++)k.setObject(l[a],arguments[a]);s.resolve(arguments)});
return s.promise},_scanAmd:function(a,c){var b=new t,l=b.promise;b.resolve(!0);var q=this;u("script[type\x3d'dojo/require']",a).forEach(function(a){l=l.then(function(){return q._require(a,c)});a.parentNode.removeChild(a)});return l},parse:function(a,c){var h;!c&&a&&a.rootNode?(c=a,h=c.rootNode):a&&k.isObject(a)&&!("nodeType"in a)?c=a:h=a;h=h?f.byId(h):b.body();c=c||{};var l=c.template?{template:!0}:{},q=[],s=this,d=this._scanAmd(h,c).then(function(){return s.scan(h,c)}).then(function(a){return s._instantiate(a,
l,c,!0)}).then(function(a){return q=q.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});k.mixin(q,d);return q}};e.parser=F;d.parseOnLoad&&r(100,F,"parse");return F})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(g,e,k){return k("dijit.Destroyable",null,{destroy:function(e){this._destroyed=!0},own:function(){var k=["destroyRecursive","destroy","remove"];g.forEach(arguments,function(d){function f(){a.remove();
g.forEach(c,function(a){a.remove()})}var b,a=e.before(this,"destroy",function(a){d[b](a)}),c=[];d.then?(b="cancel",d.then(f,f)):g.forEach(k,function(a){"function"===typeof d[a]&&(b||(b=a),c.push(e.after(d,a,f,!0)))})},this);return arguments}})})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(g,e,k,n,d){return k("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,
_beforeFillContent:function(){if(this.widgetsInTemplate){var f=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);d.parse(f,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(n.hitch(this,function(b){this._startupWidgets=b;for(var a=0;a<b.length;a++)this._processTemplateNode(b[a],function(a,b){return a[b]},function(a,b,d){return b in
a?a.connect(a,b,d):a.on(b,d,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(d,b,a){return b(d,"dojoType")||b(d,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){g.forEach(this._startupWidgets,
function(d){d&&(!d._started&&d.startup)&&d.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(g,e,k,n,d,f,b,a){var c=e("dijit._TemplatedMixin",a,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var c=this.declaredClass,d=this;return b.substitute(a,this,
function(a,b){"!"==b.charAt(0)&&(a=n.getObject(b.substr(1),!1,d));if("undefined"==typeof a)throw Error(c+" template:"+b);return null==a?"":"!"==b.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=g(this.templatePath,{sanitize:!0}));var a=c.getCachedTemplate(this.templateString,
this._skipNodeCache,this.ownerDocument),b;if(n.isString(a)){if(b=k.toDom(this._stringRepl(a),this.ownerDocument),1!=b.nodeType)throw Error("Invalid template: "+a);}else b=a.cloneNode(!0);this.domNode=b}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var c=this.containerNode;if(a&&c)for(;a.hasChildNodes();)c.appendChild(a.firstChild)}});c._templateCache={};c.getCachedTemplate=function(a,d,f){var e=c._templateCache,g=a,n=e[g];
if(n){try{if(!n.ownerDocument||n.ownerDocument==(f||document))return n}catch(r){}k.destroy(n)}a=b.trim(a);if(d||a.match(/\$\{([^\}]+)\}/g))return e[g]=a;d=k.toDom(a,f);if(1!=d.nodeType)throw Error("Invalid template: "+a);return e[g]=d};f("ie")&&d(window,"unload",function(){var a=c._templateCache,b;for(b in a){var d=a[b];"object"==typeof d&&k.destroy(d);delete a[b]}});return c})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(g,e,k){g.DeferredList=
function(g,d,f,b,a){var c=[];e.call(this);var h=this;0===g.length&&!d&&this.resolve([0,[]]);var v=0;k.forEach(g,function(a,e){function k(a,b){c[e]=[a,b];v++;v===g.length&&h.resolve(c)}a.then(function(a){d?h.resolve([e,a]):k(!0,a)},function(a){f?h.reject(a):k(!1,a);if(b)return null;throw a;})})};g.DeferredList.prototype=new e;g.DeferredList.prototype.gatherResults=function(e){e=new g.DeferredList(e,!1,!0,!1);e.addCallback(function(d){var e=[];k.forEach(d,function(b){e.push(b[1])});return e});return e};
return g.DeferredList})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(g){return g.cache})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),function(g,e,k,n,d,f,b,a,c,h,v,t,x,u,w){g=g(x,{declaredClass:"esri.virtualearth.VETiledLayer",
constructor:function(a){try{a=e.mixin({bingMapsKey:null,culture:"en-US"},a||{});var c=window.location.protocol;"file:"===c&&(c="http:");this.url=c+"//dev.virtualearth.net/REST/v1";this._url=h.urlToObject(this.url);this.spatialReference=new v({wkid:102100});this.tileInfo=new t({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},
{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,
scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=
this.fullExtent=new u(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new v({wkid:102100}));e.mixin(this,a);this.hasAttributionData=this.showAttribution;this._initLayer=e.hitch(this,this._initLayer);this._errorHandler=e.hitch(this,this._errorHandler);this._getTileInfo=e.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");}catch(b){throw this.onError(b),b;}},_unsetMap:function(a,c){this.inherited("_unsetMap",
arguments)},_getTileInfo:function(){if(this.mapStyle){var a=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var c=this.resourceInfo;!this.loaded&&c?this._initLayer(c):w({url:a,content:e.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(a,c){if(200!==a.statusCode){var d=Error();d.code=a.statusCode;d.message=a.statusDescription;
d.details=a.errorDetails;d.authenticationResultCode=a.authenticationResultCode;this.onError(d)}else try{this.resourceInfo=k.toJson(a);var d=a.resourceSets[0].resources[0],h=d.imageUrl.replace("{","${");this.tileServers=n.map(d.imageUrlSubdomains,function(a){var c=window.location.protocol;"file:"===c&&(c="http:");return b.substitute(h,{subdomain:a}).replace("http:",c)});this._tsLength=this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||
"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var e=this.loadCallback;e&&(delete this.loadCallback,e(this))}}catch(f){this.onError(f)}},getAttributionData:function(){var c=new a,b=k.fromJson(this.resourceInfo),h;this.hasAttributionData&&b&&(h=e.getObject("resourceSets.0.resources.0.imageryProviders",!1,b));h?c.callback({contributors:h}):(b=Error("Layer does not have attribution data"),b.log=d.isDebug,c.errback(b));return c},getTileUrl:function(a,c,
d){return b.substitute(this.tileServers[c%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(a,c,d),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(a,c,b){var d="",h,e;for(e=a;0<e;e--)a="0",h=1<<e-1,0!=(b&h)&&a++,0!=(c&h)&&(a++,a++),d+=a;return d},setMapStyle:function(a){this.mapStyle=a;this._getTileInfo()},setCulture:function(a){this.culture=a;this._getTileInfo()},setBingMapsKey:function(a){this.bingMapsKey=a},onMapStyleChange:function(){}});e.mixin(g,{MAP_STYLE_AERIAL:"aerial",
MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});f("extend-esri")&&e.setObject("virtualearth.VETiledLayer",g,c);return g})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(g,e,k,n){k(function(){e("highcontrast")&&g.add(n.body(),"dijit_a11y")});return e})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(g,e,k,n,d,f,b,a){g=g(b,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+="/identify";this._handler=e.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(c,b,d,e,f){try{var k=new a(c);this._successHandler([k],"onComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},execute:function(a,b,f,k){var g=k.assembly;a=this._encode(e.mixin({},this._url.query,{f:"json"},a.toJson(g&&g[0])));var n=this._handler,
w=this._errorHandler;return d({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,c){n(a,c,b,f,k.dfd)},error:function(a){w(a,f,k.dfd)}})},onComplete:function(){}});f._createWrappers(g);k("extend-esri")&&e.setObject("tasks.ImageServiceIdentifyTask",g,n);return g})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(g,e,k,n,d,f,b){d.add("highcontrast",function(){var a=b.doc.createElement("div");a.style.cssText=
'border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(e.blankGif||g.toUrl("./resources/blank.gif"))+'");';b.body().appendChild(a);var c=n.getComputedStyle(a),h=c.backgroundImage,c=c.borderTopColor==c.borderRightColor||h&&("none"==h||"url(invalid-url:)"==h);8>=d("ie")?a.outerHTML="":b.body().removeChild(a);return c});f(function(){d("highcontrast")&&k.add(b.body(),"dj_a11y")});return d})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(g,e,k,n){g=g(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(d){d=d||{};!d.url&&!d.type&&console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=d.url;this.type=d.type;this.isReference=!0===d.isReference?!0:!1;this.opacity=d.opacity;this.visibleLayers=d.visibleLayers;this.displayLevels=d.displayLevels;this.exclusionAreas=d.exclusionAreas;this.bandIds=d.bandIds;this.copyright=
d.copyright;this.subDomains=d.subDomains;this.fullExtent=d.fullExtent;this.initialExtent=d.initialExtent;this.tileInfo=d.tileInfo;this.tileServers=d.tileServers}});k("extend-esri")&&e.setObject("dijit.BasemapLayer",g,n);return g})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(g,e,k,n,d,f,b){f.extend(g,{waiRole:"",waiState:""});return d("dijit._Templated",[e,
k],{widgetsInTemplate:!1,constructor:function(){b.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(a,c){var b=this.inherited(arguments),d=c(a,"waiRole");d&&a.setAttribute("role",d);(d=c(a,"waiState"))&&n.forEach(d.split(/\s*,\s*/),function(c){-1!=c.indexOf("-")&&(c=c.split("-"),a.setAttribute("aria-"+c[0],c[1]))});return b}})})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase",
"dojo/_base/declare","dojo/_base/lang"],function(g,e,k,n){n.extend(e,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return k("dijit._FocusMixin",null,{_focusManager:g})})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(g,e,k,n,d,f,b,a,c,h,v,t,x){function u(){}function w(a){return function(c,d,h,e){return c&&"string"==typeof d&&c[d]==u?c.on(d.substring(2).toLowerCase(),b.hitch(h,e)):a.apply(k,arguments)}}g.around(k,"connect",w);f.connect&&g.around(f,"connect",w);g=n("dijit._Widget",[v,t,x],{onClick:u,onDblClick:u,onKeyDown:u,onKeyPress:u,onKeyUp:u,onMouseDown:u,onMouseMove:u,onMouseOut:u,onMouseOver:u,onMouseLeave:u,onMouseEnter:u,onMouseUp:u,constructor:function(a){this._toConnect={};for(var c in a)this[c]===
u&&(this._toConnect[c.replace(/^on/,"").toLowerCase()]=a[c],delete a[c])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,c){return this[this._onMap(a)]===u?k.connect(this.domNode,a.toLowerCase(),this,c):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,c){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,c)},attr:function(a,c){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(h.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});d("dijit-legacy-requires")&&c(0,function(){require(["dijit/_base"])});
return g})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(g,e,k,n,d,f){g=g(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(b){var a=this.bbox||this.extent;b=(a=a&&b&&a._normalize(!0))?
a.spatialReference.wkid||k.toJson(a.spatialReference.toJson()):null;var c=this.imageSpatialReference,a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:b,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:c?c.wkid||k.toJson(c.toJson()):b,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?k.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?
k.toJson(this.renderingRule.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation};b=this.timeExtent;a.time=b?b.toJson().join(","):null;return f.filter(a,function(a){if(null!==a&&void 0!==a)return!0})}});e.mixin(g,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});
n("extend-esri")&&e.setObject("layers.ImageServiceParameters",g,d);return g})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(g,e,k,n,d,f,b,a){g=g(a,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,d){a&&e.isString(a)&&(this._url=b.urlToObject(this.url=a));d&&d.requestOptions&&(this.requestOptions=d.requestOptions);this.normalization=
!0;this._errorHandler=e.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},_encode:function(a,b,d){var f,g,n={},w,r;for(w in a)if("declaredClass"!==w&&(f=a[w],g=typeof f,null!==f&&void 0!==f&&"function"!==g))if(e.isArray(f)){n[w]=[];r=f.length;for(g=0;g<r;g++)n[w][g]=this._encode(f[g])}else"object"===g?f.toJson&&(g=f.toJson(d&&d[w]),"esri.tasks.FeatureSet"===
f.declaredClass&&g.spatialReference&&(g.sr=g.spatialReference,delete g.spatialReference),n[w]=b?g:k.toJson(g)):n[w]=f;return n},_successHandler:function(a,b,d,e){b&&this[b].apply(this,a);d&&d.apply(null,a);e&&f._resDfd(e,a)},_errorHandler:function(a,b,d){this.onError(a);b&&b(a);d&&d.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});n("extend-esri")&&(d.Task=g);return g})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../SpatialReference ./MosaicRule ./DynamicMapServiceLayer ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters ../geometry/Polygon".split(" "),
function(g,e,k,n,d,f,b,a,c,h,v,t,x,u,w,r,D,B,y,p,z,F,C,E,I){g=g(y,{declaredClass:"esri.layers.ArcGISImageServiceLayer",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,c){this._url=u.urlToObject(a);var b=c&&c.imageServiceParameters;this.format=b&&b.format;this.interpolation=b?b.interpolation:null;this.compressionQuality=b?b.compressionQuality:null;this.bandIds=b?b.bandIds:null;this.mosaicRule=b?b.mosaicRule:null;this.renderingRule=b?b.renderingRule:null;this._params=
e.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},b?b.toJson():{});this._initLayer=e.hitch(this,this._initLayer);this._queryVisibleRastersHandler=e.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this.useMapImage=c&&c.useMapImage||!1;this.infoTemplate=c&&c.infoTemplate;this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=
c&&c.loadCallback;(b=c&&c.resourceInfo)?this._initLayer(b):t({url:this._url.path,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,c){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var b=this.minScale,d=this.maxScale;e.mixin(this,a);this.minScale=b;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=
new w(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var m=this.minValues,f=this.maxValues,g=this.meanValues,h=this.stdvValues,k=this.bands=[],b=0,d=this.bandCount;b<d;b++)k[b]={min:m[b],max:f[b],mean:g[b],stddev:h[b]};this.timeInfo=(b=this.timeInfo)&&b.timeExtent?new p(b):null;d=this.fields=[];if(m=a.fields)for(b=0;b<m.length;b++)d.push(new z(m[b]));this.version=a.currentVersion;this.version||
(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);v.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);v.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);b={};a.defaultMosaicMethod?(b.method=a.defaultMosaicMethod,b.operation=a.mosaicOperator,b.sortField=a.sortField,b.sortValue=a.sortValue):b.method=B.METHOD_NONE;this.defaultMosaicRule=new B(b);this.defaultMosaicRule.ascending=!0;10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(e.hitch(this,
function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=e.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=e.clone(a.fields))}));this.loaded=!0;this.onLoad(this);if(b=this._loadCallback)delete this._loadCallback,b(this)},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new k(x._dfdCanceller);10<this.version?(b._pendingDfd=t({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=f.isDebug,b.errback(a));return b},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",b=new k(x._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(b._pendingDfd=t({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=f.isDebug,
b.errback(a));return b},_getRasterAttributeTableFeatures:function(){var a=new k;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=e.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var b=
a?a.rasterAttributeTableFieldPrefix:"",c={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?e.clone(this.fields):[];var d=a.length;a[d]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a[d+1]=c;this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&
(c=n.filter(this._rasterAttributeTableFields,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),c=n.map(c,function(a){var c=e.clone(a);c.name=b+a.name;return c}),a=a.concat(c));return a},getImageUrl:function(b,c,s,f){var m=b.spatialReference.wkid||d.toJson(b.spatialReference.toJson());delete this._params._ts;var g=this._url.path+"/exportImage?";e.mixin(this._params,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:m,bboxSR:m,size:c+","+s},this.disableClientCaching?
{_ts:(new Date).getTime()}:{});var k=this._params.token=this._getToken();b=u.addProxy(g+a.objectToQuery(e.mixin(this._params,{f:"image"})));b.length>h.defaults.io.postLength||this.useMapImage?this._jsonRequest=t({url:g,content:e.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;k&&(c+=-1===c.indexOf("?")?"?token\x3d"+k:"\x26token\x3d"+k);f(u.addProxy(c))},error:this._errorHandler}):f(b)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=
a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=d.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?d.toJson(a.toJson()):null;if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=B.METHOD_NONE);c.where=a;c=new B(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=
b}},exportMapImage:function(a,b){var c=h.defaults.map,c=e.mixin({size:c.width+","+c.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete c._ts;this._exportMapImage(this._url.path+"/exportImage",c,b)},queryVisibleRasters:function(a,b,c,d){var m=this._map,f=x._fixDfd(new k(x._dfdCanceller));this._visibleRasters=[];var e,g,h=!0,n;if(this.infoTemplate&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){h=!1;n=this.infoTemplate.info;for(e=0;e<n.fieldInfos.length;e++)if((g=
n.fieldInfos[e])&&"raster.servicepixelvalue"!==g.fieldName.toLowerCase()&&(g.visible||n.title&&-1<n.title.toLowerCase().indexOf(g.fieldName.toLowerCase()))){h=!0;break}}e=new E;e.geometry=a.geometry;e.returnGeometry=this._map.spatialReference.equals(this.spatialReference);e.returnCatalogItems=h;e.timeExtent=a.timeExtent;e.mosaicRule=this.mosaicRule?this.mosaicRule:null;e.renderingRule=this.renderingRule?this.renderingRule:null;m&&(a=new r((m.extent.xmax-m.extent.xmin)/(2*m.width),(m.extent.ymax-m.extent.ymin)/
(2*m.height),m.extent.spatialReference),e.pixelSize=a);var t=this;a=new C(this.url);(f._pendingDfd=a.execute(e)).addCallbacks(function(a){t._queryVisibleRastersHandler(a,b,c,d,f)},function(a){t._resolve([a],null,d,f,!0)});return f},_queryVisibleRastersHandler:function(a,b,c,f,m){function g(){var a=this.getCustomRasterFields(b),l=this._getDomainFields(a),d=b?b.returnDomainValues:!1,f=b&&b.rasterAttributeTableFieldPrefix,A,p,t,L,x,u,w,C;this._getRasterAttributeTableFeatures().then(e.hitch(this,function(a){for(A=
0;A<r.length;A++){E=r[A];E.setInfoTemplate(this.infoTemplate);E._layer=this;if(h&&(p=h,k&&k.length>=A&&(t=k[A],p=t.replace(/ /gi,", ")),E.attributes["Raster.ItemPixelValue"]=p,E.attributes["Raster.ServicePixelValue"]=h,a&&0<a.length&&(L=n.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==p:a.attributes.VALUE==p}),0<L.length&&(x=e.clone(L[0]),f&&x)))){C={};for(u in x.attributes)x.attributes.hasOwnProperty(u)&&(w=f+u,C[w]=x.attributes[u]);x.attributes=
C;E.attributes=e.mixin(E.attributes,x.attributes)}d&&(l&&0<l.length)&&n.forEach(l,function(a){if(a){var b=E.attributes[a.name];v.isDefined(b)&&(b=this._getDomainValue(a.domain,b),v.isDefined(b)&&(E.attributes[a.name]=b))}},this);J.push(E);this._visibleRasters.push(E)}this._resolve([J,null,!0],null,c,m)}))}var h=a.value,k,r,p=0,x=0,u=this,C=this.objectIdField,z;if(a.catalogItems){f=0;var y,B,D=a.catalogItems.features.length;y=0;r=Array(D);k=Array(D);z=Array(D);for(p=0;p<D;p++)-1<a.properties.Values[p].toLowerCase().indexOf("nodata")&&
y++;y=D-y;for(p=0;p<D;p++)B=-1<a.properties.Values[p].toLowerCase().indexOf("nodata")?y++:f++,r[B]=a.catalogItems.features[p],k[B]=a.properties.Values[p],z[B]=r[B].attributes[C]}this._visibleRasters=[];var E;a=-1<h.toLowerCase().indexOf("nodata");h&&(!r&&!a)&&(C="ObjectId",r=[],E=new F(new w(this.fullExtent),null,{ObjectId:0}),r.push(E));var J=[];r?!this._map.spatialReference.equals(this.spatialReference)&&z&&0<z.length?t({url:this._url.path+"/query",content:{f:"json",objectIds:z.join(","),returnGeometry:!0,
outSR:d.toJson(u._map.spatialReference.toJson()),outFields:C},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)u._resolve([J,null,null],null,c,m);else{for(p=0;p<a.features.length;p++)for(x=0;x<r.length;x++)r[x].attributes[C]==a.features[p].attributes[C]&&(r[x].geometry=new I(a.features[p].geometry),r[x].geometry.setSpatialReference(u._map.spatialReference));g.call(u)}},error:function(a){u._resolve([J,null,null],null,c,m)}}):g.call(this):this._resolve([J,null,
null],null,c,m)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];n.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;n.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_resolve:function(a,b,c,d,m){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&x._resDfd(d,
a,m)}});b("extend-esri")&&e.setObject("layers.ArcGISImageServiceLayer",g,c);return g})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(g,e,k,n,d,f,b){g=g(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,b){a=a||{};!a.layers&&!a.itemId&&console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");
this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=b},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=f({url:(a||d.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:k.hitch(this,function(a,b){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),
a.addCallback(k.hitch(this,function(a,d){if(a.baseMap)return this.layers=[],e.forEach(a.baseMap.baseMapLayers,function(a){this.layers.push(new b(a))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.");return[]})),a}});n("extend-esri")&&k.setObject("dijit.Basemap",g,d);return g})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(g,e,k,n,d,f,b,a,c,h,v,t,x,u,w,r,D,B,y,p,z,F,C){function E(b){return function(c){a[c?"set":"remove"](this.domNode,b,c);this._set(b,c)}}x.add("dijit-legacy-requires",!u.isAsync);x.add("dojo-bidi",!1);x("dijit-legacy-requires")&&D(0,function(){g(["dijit/_base/manager"])});var I={};n=f("dijit._WidgetBase",[B,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:E("lang"),dir:"",_setDirAttr:E("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:n.blankGif||g.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,
d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,c){this._introspect();this.srcNodeRef=b.byId(c);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,w.mixin(this,a));this.postMixInProperties();this.id||(this.id=C.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=p.body(this.ownerDocument);C.add(this);this.buildRendering();var d;if(this.domNode){this._applyAttributes();var e=this.srcNodeRef;e&&(e.parentNode&&this.domNode!==e)&&(e.parentNode.replaceChild(this.domNode,e),d=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();d&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);e.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(e.map(a,function(a){return a+"Rtl"})));c.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,e.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&w.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();e.forEach(this._connects,w.hitch(this,"disconnect"));e.forEach(this._supportingWidgets,b);this.domNode&&e.forEach(C.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
C.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);this.domNode&&(b?a.remove(this.domNode,"widgetId"):h.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||h.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){e.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;w.isObject(a)?
t.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(b,d,f){f=3<=arguments.length?f:this.attributeMap[b];e.forEach(w.isArray(f)?f:[f],function(e){var m=this[e.node||e||"domNode"];switch(e.type||"attribute"){case "attribute":w.isFunction(d)&&(d=w.hitch(this,d));e=e.attribute?e.attribute:/^on[A-Z][a-zA-Z]*$/.test(b)?b.toLowerCase():b;m.tagName?a.set(m,e,d):m.set(e,d);break;case "innerText":m.innerHTML="";m.appendChild(this.ownerDocument.createTextNode(d));
break;case "innerHTML":m.innerHTML=d;break;case "class":c.replace(m,d,this[b])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(w.isFunction(d))var m=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!w.isFunction(this.focusNode)?"focusNode":"domNode",e=this[d]&&this[d].tagName,f;if(f=e)if(!(f=
I[e])){f=this[d];var g={},h;for(h in f)g[h.toLowerCase()]=!0;f=I[e]=g}h=f;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:h&&c.l in h&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return m||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",
g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(a,b,c){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var d,m=this["on"+a];m&&(d=m.apply(this,c?c:[b]));this._started&&!this._beingDestroyed&&
r.emit(this.domNode,a.toLowerCase(),b);return d},on:function(a,b){var c=this._onMap(a);return c?k.after(this,c,b,!0):this.own(r(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?C.findWidgets(this.containerNode):
[]},getParent:function(){return C.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,c){return this.own(d.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(y.subscribe(a,w.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:v.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=t.get(this.domNode,"display")},placeAt:function(a,c){var d=!a.tagName&&
C.byId(a);d&&d.addChild&&(!c||"number"===typeof c)?d.addChild(this,c):(d=d&&"domNode"in d?d.containerNode&&!/after|before|replace/.test(c||"")?d.containerNode:d.domNode:b.byId(a,this.ownerDocument),h.place(this.domNode,d,c),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(w.hitch(this,function(){c&&(c=null,this._destroyed||w.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});x("dojo-bidi")&&
n.extend(F);return n})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(g,e){var k={};g.setObject("dojo.date.stamp",k);k.fromISOString=function(g,d){k._isoRegExp||(k._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var f=k._isoRegExp.exec(g),b=null;if(f){f.shift();f[1]&&f[1]--;f[6]&&(f[6]*=1E3);d&&(d=new Date(d),e.forEach(e.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),
function(a){return d["get"+a]()}),function(a,b){f[b]=f[b]||a}));b=new Date(f[0]||1970,f[1]||0,f[2]||1,f[3]||0,f[4]||0,f[5]||0,f[6]||0);100>f[0]&&b.setFullYear(f[0]||1970);var a=0,c=f[7]&&f[7].charAt(0);"Z"!=c&&(a=60*(f[8]||0)+(Number(f[9])||0),"-"!=c&&(a*=-1));c&&(a-=b.getTimezoneOffset());a&&b.setTime(b.getTime()+6E4*a)}return b};k.toISOString=function(e,d){var f=function(a){return 10>a?"0"+a:a};d=d||{};var b=[],a=d.zulu?"getUTC":"get",c="";"time"!=d.selector&&(c=e[a+"FullYear"](),c=["0000".substr((c+
"").length)+c,f(e[a+"Month"]()+1),f(e[a+"Date"]())].join("-"));b.push(c);if("date"!=d.selector){c=[f(e[a+"Hours"]()),f(e[a+"Minutes"]()),f(e[a+"Seconds"]())].join(":");a=e[a+"Milliseconds"]();d.milliseconds&&(c+="."+(100>a?"0":"")+f(a));if(d.zulu)c+="Z";else if("time"!=d.selector)var a=e.getTimezoneOffset(),g=Math.abs(a),c=c+((0<a?"-":"+")+f(Math.floor(g/60))+":"+f(g%60));b.push(c)}return b.join("T")};return k})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(g,e,k,n,d,f,b,a,c,h,v){g=g(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(c){if(c){e.mixin(this,c);var d=this.features,f=c.spatialReference,g=h.getGeometryType(c.geometryType),f=this.spatialReference=new a(f);this.geometryType=c.geometryType;c.fields&&(this.fields=c.fields);k.forEach(d,function(a,c){var e=a.geometry&&a.geometry.spatialReference;d[c]=new b(g&&a.geometry?new g(a.geometry):null,a.symbol&&v.fromJson(a.symbol),a.attributes);d[c].geometry&&!e&&d[c].geometry.setSpatialReference(f)});
this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(a){var b={};this.displayFieldName&&(b.displayFieldName=this.displayFieldName);this.fields&&(b.fields=this.fields);this.spatialReference?b.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(b.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(b.geometryType=
h.getJsonType(this.features[0].geometry)),b.features=c._encodeGraphics(this.features,a));b.exceededTransferLimit=this.exceededTransferLimit;return f.fixJson(b)},_hydrate:function(){var a=this.transform;if(a){var b=this.features,c,d=a.translate[0],e=a.translate[1],f=a.scale[0],g=a.scale[1],h=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var d,e,f,g,h,k,m,A;d=0;for(e=
a.length;d<e;d++){h=a[d];f=0;for(g=h.length;f<g;f++)k=h[f],0<f?(m+=k[0],A+=k[1]):(m=k[0],A=k[1]),k[0]=b(m),k[1]=c(A)}};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,e,f;d=0;for(e=a.length;d<e;d++)f=a[d],f[0]=b(void 0),f[1]=c(void 0)}}(this.geometryType,function(a){return a*f+d},function(a){return e-a*g}),a=0;for(c=b.length;a<c;a++)b[a].geometry&&h(b[a].geometry);
this.transform=null}}});n("extend-esri")&&e.setObject("tasks.FeatureSet",g,d);return g})},"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\n  \x3c/div\x3e\n\x3c/div\x3e',"*noref":1}});
define("esri/dijit/BasemapGallery","require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../urlUtils ../request ../geometry/Extent ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),function(g,
e,k,n,d,f,b,a,c,h,v,t,x,u,w,r,D,B,y,p,z,F,C,E,I,l,q,s,L){g=e([s,u,w],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:L,basePath:g.toUrl(".")+"/",loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(a,b){a=a||{};a.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=a.map;this._hasUI=b?!0:!1;this.bingMapsKey=a.bingMapsKey&&0<a.bingMapsKey.length?a.bingMapsKey:null;this.showArcGISBasemaps=!1===a.showArcGISBasemaps?!1:!0;this.basemaps=a.basemaps||[];this.basemapIds=a.basemapIds;this.referenceIds=a.referenceIds;this.basemapsGroup=a.basemapsGroup;this.arcgisUrl=r.dijit._arcgisUrl;a.portalUrl&&(this.arcgisUrl=a.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=window.location.protocol+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);k.forEach(this.basemaps,function(a,b){if(!a.id||0===a.id.length)a.id=this._getUniqueId();k.forEach(a.layers,function(a){a.opacity=0<=a.opacity?a.opacity:1;a.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&k.forEach(this.basemapIds,function(a){this.map.getLayer(a)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&k.forEach(this.referenceIds,
function(a){this.map.getLayer(a)._basemapGalleryLayerType="reference"},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(d.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(d.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():n.connect(this,"onLoad",d.hitch(this,function(){this._refreshUI()}))},select:function(a){this._select(a)},
getSelected:function(){return this._selectedBasemap},get:function(a){var b;for(b=0;b<this.basemaps.length;b++)if(this.basemaps[b].id==a)return this.basemaps[b];return null},add:function(a){return a&&!a.id?(a.id=this._getUniqueId(),this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):a&&this._isUniqueId(a.id)?(this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):!1},remove:function(a){var b;for(b=0;b<this.basemaps.length;b++){var c=this.basemaps[b];if(c.id===a)return this._selectedBasemap&&
this._selectedBasemap.id===c.id&&(this._selectedBasemap=null),this.basemaps.splice(b,1),this._refreshUI(),this.onRemove(c),c}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(a){},onRemove:function(a){},onError:function(a){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&(0<this.basemaps.length&&!this._selectBasemapInProgress)&&
this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(a){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,a):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(a))},_findArcGISBasemapsGroup:function(a){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(a);else{var b=this.arcgisUrl+"/accounts/self",c={f:"json"};c.culture=f.locale;B({url:b,
content:c,callbackParamName:"callback",load:d.hitch(this,function(b,c){this._basemapGalleryGroupQuery=b&&b.basemapGalleryGroupQuery?b.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(a)}),error:d.hitch(this,function(a,b){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(a){var b=d.hitch(this,"_findArcGISBasemaps"),c=this.arcgisUrl+"/community/groups",e={};e.q=this._basemapGalleryGroupQuery;
e.f="json";B({url:c,content:e,callbackParamName:"callback",load:d.hitch(this,function(c,d){if(0<c.results.length)b(c.results[0].id,a);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:d.hitch(this,function(a){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(a,b){var c=this.arcgisUrl+"/search",e={};e.q="group:"+a+' AND type:"web map"';e.sortField="name";e.sortOrder="desc";e.num=50;e.f="json";B({url:c,
content:e,callbackParamName:"callback",load:d.hitch(this,function(a,c){if(0<a.results.length)b(a.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:d.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_handleArcGISBasemapsResponse:function(a){0<a.length&&(k.forEach(a,function(a,b){if(this.bingMapsKey||!this.bingMapsKey&&a.title&&-1==a.title.indexOf("Bing Maps")){var c={};c.id=this._getUniqueId();
c.title=a.title;c.thumbnailUrl="";if(a.thumbnail&&a.thumbnail.length&&(c.thumbnailUrl=this.arcgisUrl+"/content/items/"+a.id+"/info/"+a.thumbnail,r.id)){var d=r.id.findCredential(D.urlToObject(this.arcgisUrl).path);d&&(c.thumbnailUrl+="?token\x3d"+d.token)}c.itemId=a.id;c=new q(c,this);this.basemaps.splice(0,0,c)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(t.empty(this.flowContainer),k.forEach(this.basemaps,function(a,b){a.id||(a.id="basemap_"+b);this.flowContainer.appendChild(this._buildNodeLayout(a))},
this),t.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(a){var b=t.create("div",{id:"galleryNode_"+a.id,"class":"esriBasemapGalleryNode"}),c=t.create("a",{href:"javascript:void(0);"},b);n.connect(c,"onclick",d.hitch(this,"_onNodeClick",a));a.thumbnailUrl?t.create("img",{"class":"esriBasemapGalleryThumbnail",src:a.thumbnailUrl},c):t.create("img",{"class":"esriBasemapGalleryThumbnail",src:this.basePath.toString()+"images/transparent.gif"},
c);c=t.create("div",{"class":"esriBasemapGalleryLabelContainer"},b);a=a.title||"";t.create("span",{innerHTML:a,alt:a,title:a},c);return b},_onNodeClick:function(a,b){b.preventDefault();this._markSelected(a);this.select(a.id)},_markSelected:function(a){a&&(k.forEach(f.query(".esriBasemapGallerySelectedNode",this.domNode),function(a){x.remove(a,"esriBasemapGallerySelectedNode")}),(a=v.byId("galleryNode_"+a.id))&&x.add(a,"esriBasemapGallerySelectedNode"))},_select:function(a){this._selectBasemapInProgress=
!0;var b=this.get(a);b?(b.layers?this._getServiceInfos(b):(a=b.getLayers(this.arcgisUrl),d.isArray(a)?this._getServiceInfos(b):a.addCallback(d.hitch(this,function(a){this._getServiceInfos(b)}))),this._markSelected(b)):this._selectBasemapInProgress=!1},_getServiceInfos:function(a){"https:"==location.protocol&&k.forEach(a.layers,function(a){if(this._isAgolService(a.url)||this._isHostedService(a.url))a.url=a.url.replace("http:","https:")},this);this._selectedBasemap=a;var b=[];k.forEach(a.layers,function(a){a.url&&
(0<a.url.length&&!a.isReference&&!a.type)&&(a.deferredsPos=b.length,b.push(this._getServiceInfo(a.url)))},this);0<b.length?(new h(b)).addCallback(d.hitch(this,function(b){var c=null;k.forEach(a.layers,function(a){if(0===a.deferredsPos||a.deferredsPos){a.serviceInfoResponse=b[a.deferredsPos][1];var d=a.serviceInfoResponse.fullExtent;d||(d=a.serviceInfoResponse.extent);c=c?c.union(new y(d)):new y(d)}},this);this.map.extent&&5>this._getIntersectionPercent(c,this.map.extent)&&this.map.setExtent(c,!0);
this._switchBasemapLayers(a);this._updateReferenceLayer(a)})):(this._switchBasemapLayers(a),this._updateReferenceLayer(a))},_switchBasemapLayers:function(a){a=a.layers;if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===a[0].type||a[0].type&&-1<a[0].type.indexOf("BingMaps")||"WebTiledLayer"===a[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{k.forEach(a,function(a){if(!a.isReference&&
a.type&&-1<a.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);this._removeBasemapLayers();var b=0;k.forEach(a,function(a){if(!a.isReference){var c;if("OpenStreetMap"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=new z({id:"layer_osm",opacity:a.opacity})}else if(a.type&&
-1<a.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=p.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"==a.type?c=p.MAP_STYLE_AERIAL:"BingMapsRoad"==a.type&&(c=p.MAP_STYLE_ROAD);c=new p({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:c,opacity:a.opacity})}else if("WebTiledLayer"==a.type){if(0<this.map.layerIds.length&&
0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=new E(a.url,{visible:a.visibility,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent,initialExtent:a.initialExtent||a.fullExtent,subDomains:a.subDomains,tileInfo:a.tileInfo,tileServers:a.tileServers})}else a.serviceInfoResponse&&a.serviceInfoResponse.mapName?c=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&
!0===a.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):a.serviceInfoResponse&&a.serviceInfoResponse.pixelSizeX&&(c=new l,c.bandIds=a.bandIds,!a.bandIds&&(a.serviceInfoResponse.bandCount&&3<parseInt(a.serviceInfoResponse.bandCount))&&(c.bandIds=[0,1,2]),c=new I(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageServiceParameters:c}));c&&(c._basemapGalleryLayerType="basemap",this.map.addLayer(c,b),b++)}},this);this._selectBasemapInProgress=
!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var a=this.map.layerIds,b=[];k.forEach(a,function(a){a=this.map.getLayer(a);"basemap"===a._basemapGalleryLayerType&&b.push(a)},this);0===b.length&&0<a.length&&b.push(this.map.getLayer(a[0]));0<b.length&&k.forEach(b,function(a){this.map.removeLayer(a)},this)},_updateReferenceLayer:function(a){var b;this._removeReferenceLayer();for(b=0;b<a.layers.length;b++)!0===a.layers[b].isReference&&this._addReferenceLayer(a.layers[b])},_removeReferenceLayer:function(){var a;
for(a=this.map.layerIds.length-1;0<=a;a--){var b=this.map.getLayer(this.map.layerIds[a]);"reference"===b._basemapGalleryLayerType&&this.map.removeLayer(b)}},_addReferenceLayer:function(a){this._getServiceInfo(a.url,d.hitch(this,"_handleReferenceServiceInfoResponse",a))},_handleReferenceServiceInfoResponse:function(a,b,c){var d;(a.serviceInfoResponse=b)&&b.mapName?d=!0===b.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):b&&b.pixelSizeX&&(c=new l,c.bandIds=a.bandIds,!a.bandIds&&(b.bandCount&&
3<parseInt(b.bandCount))&&(c.bandIds=[0,1,2]),d=new I(a.url,{resourceInfo:b,opacity:a.opacity,visible:a.visibility,imageServiceParameters:c}));d&&(d._basemapGalleryLayerType="reference",this.map.addLayer(d))},_getServiceInfo:function(a,b){return B({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,c){b&&b(a,c)},error:d.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(a){var b=[];a.displayLevels||(b=k.map(a.serviceInfoResponse.tileInfo.lods,
function(a){return a.level}));var c=null;a.exclusionAreas&&a.exclusionAreas.length&&(c=[],k.forEach(a.exclusionAreas,function(a){c.push({minZoom:a.minZoom,maxZoom:a.maxZoom,minScale:a.minScale,maxScale:a.maxScale,geometry:new y(a.geometry)})}));return new F(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,exclusionAreas:c,displayLevels:a.displayLevels||b})},_loadAsDynamic:function(a){var b=new C(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility});
a.visibleLayers&&b.setVisibleLayers(a.visibleLayers);return b},_getIntersectionPercent:function(a,b){var c=b.intersects(a);if(c){var c=c.getWidth()*c.getHeight(),d=b.getWidth()*b.getHeight();return 100*(c/d)}return 0},_getIds:function(){var a=[];k.forEach(this.basemaps,function(b){a.push(b.id)},this);return a},_getUniqueId:function(){for(var a=","+this._getIds().toString()+",",b=0;;)if(-1<a.indexOf(",basemap_"+b+","))b++;else return"basemap_"+b},_isUniqueId:function(a){return-1===(","+this._getIds().toString()+
",").indexOf(","+a+",")?!0:!1},_isAgolService:function(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")},_isHostedService:function(a){return!a?!1:-1!==a.indexOf(".arcgis.com/")}});a("extend-esri")&&d.setObject("dijit.BasemapGallery",g,r);return g});