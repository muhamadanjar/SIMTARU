// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.12/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(g,h,f,b,e,d,l){var a={_isElementShown:function(a){var n=b.get(a);return"hidden"!=n.visibility&&"collapsed"!=n.visibility&&"none"!=n.display&&"hidden"!=f.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return f.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;
case "iframe":var b;try{var e=a.contentDocument;if("designMode"in e&&"on"==e.designMode)return!0;b=e.body}catch(d){try{b=a.contentWindow.document.body}catch(l){return!1}}return b&&("true"==b.contentEditable||b.firstChild&&"true"==b.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(b){return f.get(b,"disabled")?void 0:f.has(b,"tabIndex")?+f.get(b,"tabIndex"):a.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=a.effectiveTabIndex(b)},
isFocusable:function(b){return-1<=a.effectiveTabIndex(b)},_getTabNavigable:function(b){function e(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}var l,g,h,c,p,t,x={},C=a._isElementShown,u=a.effectiveTabIndex,w=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=d("ie")&&"HTML"!==a.scopeName||!C(a))){var b=u(a);if(0<=b){if(0==b)l||(l=a),g=a;else if(0<b){if(!h||b<c)c=b,h=a;if(!p||b>=t)t=b,p=a}b=e(a);f.get(a,"checked")&&
b&&(x[b]=a)}"SELECT"!=a.nodeName.toUpperCase()&&w(a)}};C(b)&&w(b);return{first:x[e(l)]||l,last:x[e(g)]||g,lowest:x[e(h)]||h,highest:x[e(p)]||p}},getFirstInTabbingOrder:function(b,e){var d=a._getTabNavigable(h.byId(b,e));return d.lowest?d.lowest:d.first},getLastInTabbingOrder:function(b,e){var d=a._getTabNavigable(h.byId(b,e));return d.last?d.last:d.highest}};e.mixin(l,a);return a})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(g,h,f,b){function e(a){if((a.keyCode===
g.ENTER||a.keyCode===g.SPACE)&&!/input|button|textarea/i.test(a.target.nodeName))for(a=a.target;a;a=a.parentNode)if(a.dojoClick)return!0}var d;f(document,"keydown",function(a){e(a)?(d=a.target,a.preventDefault()):d=null});f(document,"keyup",function(a){e(a)&&a.target==d&&(d=null,f.emit(a.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,metaKey:a.metaKey,altKey:a.altKey,_origType:a.type}))});var l=function(a,b){a.dojoClick=!0;return f(a,"click",b)};l.click=l;l.press=function(a,
e){var d=f(a,b.press,function(a){("mousedown"!=a.type||h.isLeft(a))&&e(a)}),l=f(a,"keydown",function(a){(a.keyCode===g.ENTER||a.keyCode===g.SPACE)&&e(a)});return{remove:function(){d.remove();l.remove()}}};l.release=function(a,e){var d=f(a,b.release,function(a){("mouseup"!=a.type||h.isLeft(a))&&e(a)}),l=f(a,"keyup",function(a){(a.keyCode===g.ENTER||a.keyCode===g.SPACE)&&e(a)});return{remove:function(){d.remove();l.remove()}}};l.move=b.move;return l})},"dijit/hccss":function(){define(["dojo/dom-class",
"dojo/hccss","dojo/domReady","dojo/_base/window"],function(g,h,f,b){f(function(){h("highcontrast")&&g.add(b.body(),"dijit_a11y")});return h})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(g,h,f){return f("dijit.Destroyable",null,{destroy:function(b){this._destroyed=!0},own:function(){var b=["destroyRecursive","destroy","remove"];g.forEach(arguments,function(e){function d(){a.remove();g.forEach(f,function(a){a.remove()})}var l,a=h.before(this,
"destroy",function(a){e[l](a)}),f=[];e.then?(l="cancel",e.then(d,d)):g.forEach(b,function(a){"function"===typeof e[a]&&(l||(l=a),f.push(h.after(e,a,d,!0)))})},this);return arguments}})})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(g,h,f,b,e,d){return g([d,e],{_onMap:function(b){var a=this.constructor._onMap,e;if(!a||!a.FINAL)delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=
!0;b=b.toLowerCase();a[b]?e=this[a[b].method]:(b=this._onCamelCase(b),this[b]&&(e=b));return e},on:function(e,a){var d=this._onMap(e),f=e.replace(/\-/g,""),g="on"+f in this.domNode;return d||!g?this.inherited(arguments):this.own(b(this.domNode,f,a))[0]},emit:function(b,a,e){var d,f,g,r=b.toLowerCase(),c=this.constructor._onMap||this.registerConnectEvents();f=this[this._onMap(r)];a=a||{};a.target||(a.target=this);f&&(c&&c[r])&&(this._onObj2Arr(function(){d=Array.prototype.slice.call(arguments)},c[r].argKeys)(a),
g=h.mixin({},arguments),g[2]=d,g[0]=c[r].name.replace(/^on/,""));return this.inherited(g||arguments)}})})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(g){var h=g.getObject("dojox.html.entities",!0),f=function(b,d){var f,a;if(d._encCache&&d._encCache.regexp&&d._encCache.mapper&&d.length==d._encCache.length)f=d._encCache.mapper,a=d._encCache.regexp;else{f={};a=["["];var g;for(g=0;g<d.length;g++)f[d[g][0]]="\x26"+d[g][1]+";",a.push(d[g][0]);a.push("]");a=RegExp(a.join(""),"g");
d._encCache={mapper:f,regexp:a,length:d.length}}return b=b.replace(a,function(a){return f[a]})},b=function(b,d){var f,a;if(d._decCache&&d._decCache.regexp&&d._decCache.mapper&&d.length==d._decCache.length)f=d._decCache.mapper,a=d._decCache.regexp;else{f={};a=["("];var g;for(g=0;g<d.length;g++){var h="\x26"+d[g][1]+";";g&&a.push("|");f[h]=d[g][0];a.push(h)}a.push(")");a=RegExp(a.join(""),"g");d._decCache={mapper:f,regexp:a,length:d.length}}return b=b.replace(a,function(a){return f[a]})};h.html=[["\x26",
"amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];h.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7",
"middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],
["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],
["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396",
"Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba",
"kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],
["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e",
"infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329",
"lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d",
"rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];h.encode=function(b,d){b&&(d?b=f(b,d):(b=f(b,h.html),b=f(b,h.latin)));return b};h.decode=function(e,d){e&&(d?e=b(e,d):(e=b(e,h.html),e=b(e,h.latin)));return e};return h})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(g,h,f,b,e,d,l,a,y,n,s,E,r){function c(){}function p(a){return function(b,d,e,g){return b&&"string"==typeof d&&b[d]==c?b.on(d.substring(2).toLowerCase(),l.hitch(e,g)):a.apply(f,arguments)}}g.around(f,"connect",p);d.connect&&g.around(d,"connect",p);g=b("dijit._Widget",[s,E,r],{onClick:c,onDblClick:c,onKeyDown:c,onKeyPress:c,onKeyUp:c,onMouseDown:c,onMouseMove:c,onMouseOut:c,onMouseOver:c,onMouseLeave:c,onMouseEnter:c,onMouseUp:c,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
c&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===c?f.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){d.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){d.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(n.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});e("dijit-legacy-requires")&&y(0,function(){require(["dijit/_base"])});
return g})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(g,h,f,b,e,d,l,a,y,n,s,E,r,c,p,t,x,C,u,w,z,H,A){function I(b){return function(c){a[c?
"set":"remove"](this.domNode,b,c);this._set(b,c)}}r.add("dijit-legacy-requires",!c.isAsync);r.add("dojo-bidi",!1);r("dijit-legacy-requires")&&x(0,function(){g(["dijit/_base/manager"])});var L={};b=d("dijit._WidgetBase",[C,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:I("lang"),dir:"",_setDirAttr:I("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",
a)},attributeMap:{},_blankGif:b.blankGif||g.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();
this.srcNodeRef=l.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,p.mixin(this,a));this.postMixInProperties();this.id||(this.id=A.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=w.body(this.ownerDocument);A.add(this);this.buildRendering();
var c;if(this.domNode){this._applyAttributes();var d=this.srcNodeRef;d&&(d.parentNode&&this.domNode!==d)&&(d.parentNode.replaceChild(this.domNode,d),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);h.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(h.map(a,function(a){return a+"Rtl"})));y.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,h.forEach(this.getChildren(),function(a){!a._started&&(!a._destroyed&&p.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=
!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();h.forEach(this._connects,p.hitch(this,"disconnect"));h.forEach(this._supportingWidgets,b);this.domNode&&h.forEach(A.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);A.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);
this.domNode&&(b?a.remove(this.domNode,"widgetId"):n.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||n.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){h.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;p.isObject(a)?E.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(b,c,d){d=3<=
arguments.length?d:this.attributeMap[b];h.forEach(p.isArray(d)?d:[d],function(d){var e=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":p.isFunction(c)&&(c=p.hitch(this,c));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(b)?b.toLowerCase():b;e.tagName?a.set(e,d,c):e.set(d,c);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(c));break;case "innerHTML":e.innerHTML=c;break;case "class":y.replace(e,c,this[b])}},this)},get:function(a){var b=
this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(p.isFunction(d))var e=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!p.isFunction(this.focusNode)?"focusNode":"domNode",f=this[d]&&this[d].tagName,g;if(g=f)if(!(g=L[f])){g=this[d];var H={},h;for(h in g)H[h.toLowerCase()]=!0;g=L[f]=H}h=g;c=a in this.attributeMap?this.attributeMap[a]:
c.s in this?this[c.s]:h&&c.l in h&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return e||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==
b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(a,b,c){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var d,e=this["on"+a];e&&(d=e.apply(this,c?c:[b]));this._started&&!this._beingDestroyed&&t.emit(this.domNode,a.toLowerCase(),b);return d},on:function(a,b){var c=this._onMap(a);return c?f.after(this,c,b,
!0):this.own(t(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?A.findWidgets(this.containerNode):[]},getParent:function(){return A.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,
b,c){return this.own(e.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(u.subscribe(a,p.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:s.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=E.get(this.domNode,"display")},placeAt:function(a,b){var c=!a.tagName&&A.byId(a);c&&c.addChild&&(!b||"number"===typeof b)?c.addChild(this,b):(c=c&&"domNode"in c?c.containerNode&&
!/after|before|replace/.test(b||"")?c.containerNode:c.domNode:l.byId(a,this.ownerDocument),n.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(p.hitch(this,function(){c&&(c=null,this._destroyed||p.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});r("dojo-bidi")&&b.extend(H);return b})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare",
"dojo/_base/lang"],function(g,h,f,b){b.extend(h,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return f("dijit._FocusMixin",null,{_focusManager:g})})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(g,h,f){g.DeferredList=function(b,e,d,g,a){var y=[];h.call(this);var n=this;0===b.length&&!e&&this.resolve([0,[]]);var s=0;f.forEach(b,function(a,f){function c(a,c){y[f]=[a,
c];s++;s===b.length&&n.resolve(y)}a.then(function(a){e?n.resolve([f,a]):c(!0,a)},function(a){d?n.reject(a):c(!1,a);if(g)return null;throw a;})})};g.DeferredList.prototype=new h;g.DeferredList.prototype.gatherResults=function(b){b=new g.DeferredList(b,!1,!0,!1);b.addCallback(function(b){var d=[];f.forEach(b,function(b){d.push(b[1])});return d});return b};return g.DeferredList})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(g,h,f,b,e,d,l,a,y,n,s,E,r,c,p,t,x){var C,u,w=new (h([E,l],{curNode:null,activeStack:[],constructor:function(){var b=a.hitch(this,function(a){f.isDescendant(this.curNode,a)&&this.set("curNode",null);f.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});g.before(d,"empty",b);g.before(d,"destroy",b)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,b){var c=this,d=a.document&&a.document.body;if(d){var e=s("pointer-events")?"pointerdown":s("MSPointer")?
"MSPointerDown":s("touch-events")?"mousedown, touchstart":"mousedown",f=y(a.document,e,function(a){if(!a||!(a.target&&null==a.target.parentNode))c._onTouchNode(b||a.target,"mouse")}),g=y(d,"focusin",function(a){if(a.target.tagName){var d=a.target.tagName.toLowerCase();"#document"==d||"body"==d||(p.isFocusable(a.target)?c._onFocusNode(b||a.target):c._onTouchNode(b||a.target))}}),h=y(d,"focusout",function(a){c._onBlurNode(b||a.target)});return{remove:function(){f.remove();g.remove();h.remove();d=f=
g=h=null}}}},_onBlurNode:function(b){b=(new Date).getTime();b<C+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(a.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),b<u+100||(this._clearActiveWidgetsTimer=setTimeout(a.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,d){u=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);e.contains(a,"dijitPopup")&&(a=a.firstChild);var f=[];try{for(;a;){var g=b.get(a,"dijitPopupParent");if(g)a=t.byId(g).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===r.body())break;a=c.get(a.ownerDocument).frameElement}else{var h=a.getAttribute&&a.getAttribute("widgetId"),l=h&&t.byId(h);l&&!("mouse"==d&&l.get("disabled"))&&f.unshift(h);a=a.parentNode}}}catch(p){}this._setStack(f,
d)},_onFocusNode:function(a){a&&9!=a.nodeType&&(C=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var c=this.activeStack,d=c.length-1,e=a.length-1;if(a[e]!=c[d]){this.set("activeStack",a);var f;for(f=d;0<=f&&c[f]!=a[f];f--)if(d=t.byId(c[f]))d._hasBeenBlurred=!0,d.set("focused",!1),d._focusManager==this&&d._onBlur(b),
this.emit("widget-blur",d,b);for(f++;f<=e;f++)if(d=t.byId(a[f]))d.set("focused",!0),d._focusManager==this&&d._onFocus(b),this.emit("widget-focus",d,b)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));n(function(){var a=w.registerWin(c.get(document));s("ie")&&y(window,"unload",function(){a&&(a.remove(),a=null)})});x.focus=function(a){w.focus(a)};for(var z in w)/^_/.test(z)||(x.focus[z]="function"==typeof w[z]?a.hitch(w,z):w[z]);w.watch(function(a,b,c){x.focus[a]=c});return w})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),
function(g,h,f,b,e,d,l,a,y,n){function s(a,b,c){return p&&c?function(a,b){return d(a,c,b)}:x?function(c,e){var f=d(c,b,function(a){e.call(this,a);K=(new Date).getTime()}),g=d(c,a,function(a){(!K||(new Date).getTime()>K+1E3)&&e.call(this,a)});return{remove:function(){f.remove();g.remove()}}}:function(b,c){return d(b,a,c)}}function E(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function r(a,c,e){var g=E(a.target);if(u=!a.target.disabled&&g&&g.dojoClick)if(z=(w="useTarget"==u)?g:a.target,
w&&a.preventDefault(),H=a.changedTouches?a.changedTouches[0].pageX-n.global.pageXOffset:a.clientX,A=a.changedTouches?a.changedTouches[0].pageY-n.global.pageYOffset:a.clientY,I=("object"==typeof u?u.x:"number"==typeof u?u:0)||4,L=("object"==typeof u?u.y:"number"==typeof u?u:0)||4,!C){C=!0;var h=function(a){u=w?f.isDescendant(n.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-n.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-n.global.pageYOffset:a.clientY),z):
u&&(a.changedTouches?a.changedTouches[0].target:a.target)==z&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-n.global.pageXOffset:a.clientX)-H)<=I&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-n.global.pageYOffset:a.clientY)-A)<=L};n.doc.addEventListener(c,function(a){h(a);w&&a.preventDefault()},!0);n.doc.addEventListener(e,function(a){h(a);if(u){P=(new Date).getTime();var b=w?z:a.target;"LABEL"===b.tagName&&(b=f.byId(b.getAttribute("for"))||b);var c=a.changedTouches?a.changedTouches[0]:
a,e=document.createEvent("MouseEvents");e._dojo_click=!0;e.initMouseEvent("click",!0,!0,a.view,a.detail,c.screenX,c.screenY,c.clientX,c.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);setTimeout(function(){d.emit(b,"click",e);P=(new Date).getTime()},0)}},!0);a=function(a){n.doc.addEventListener(a,function(c){!c._dojo_click&&((new Date).getTime()<=P+1E3&&!("INPUT"==c.target.tagName&&b.contains(c.target,"dijitOffScreen")))&&(c.stopPropagation(),c.stopImmediatePropagation&&c.stopImmediatePropagation(),
"click"==a&&(("INPUT"!=c.target.tagName||"radio"==c.target.type||"checkbox"==c.target.type)&&"TEXTAREA"!=c.target.tagName&&"AUDIO"!=c.target.tagName&&"VIDEO"!=c.target.tagName)&&c.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var c=5>l("ios"),p=l("pointer-events")||l("MSPointer"),t=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=l("MSPointer")?"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),x=l("touch-events"),C,u,w=!1,z,H,A,
I,L,P,K,F;p?y(function(){n.doc.addEventListener(t.down,function(a){r(a,t.move,t.up)},!0)}):x&&y(function(){function a(b){var c=e.delegate(b,{bubbles:!0});6<=l("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}F=n.body();n.doc.addEventListener("touchstart",function(a){K=(new Date).getTime();var b=F;F=a.target;d.emit(b,"dojotouchout",{relatedTarget:F,bubbles:!0});d.emit(F,
"dojotouchover",{relatedTarget:b,bubbles:!0});r(a,"touchmove","touchend")},!0);d(n.doc,"touchmove",function(b){K=(new Date).getTime();var e=n.doc.elementFromPoint(b.pageX-(c?0:n.global.pageXOffset),b.pageY-(c?0:n.global.pageYOffset));e&&(F!==e&&(d.emit(F,"dojotouchout",{relatedTarget:e,bubbles:!0}),d.emit(e,"dojotouchover",{relatedTarget:F,bubbles:!0}),F=e),d.emit(e,"dojotouchmove",a(b))||b.preventDefault())});d(n.doc,"touchend",function(b){K=(new Date).getTime();var e=n.doc.elementFromPoint(b.pageX-
(c?0:n.global.pageXOffset),b.pageY-(c?0:n.global.pageYOffset))||n.body();d.emit(e,"dojotouchend",a(b))})});h={press:s("mousedown","touchstart",t.down),move:s("mousemove","dojotouchmove",t.move),release:s("mouseup","dojotouchend",t.up),cancel:s(a.leave,"touchcancel",p?t.cancel:null),over:s("mouseover","dojotouchover",t.over),out:s("mouseout","dojotouchout",t.out),enter:a._eventHandler(s("mouseover","dojotouchover",t.over)),leave:a._eventHandler(s("mouseout","dojotouchout",t.out))};return g.touch=h})},
"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(g,h,f,b,e,d,l){e.add("highcontrast",function(){var a=l.doc.createElement("div");a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(h.blankGif||g.toUrl("./resources/blank.gif"))+'");';l.body().appendChild(a);var d=b.getComputedStyle(a),f=d.backgroundImage,d=d.borderTopColor==d.borderRightColor||
f&&("none"==f||"url(invalid-url:)"==f);8>=e("ie")?a.outerHTML="":l.body().removeChild(a);return d});d(function(){e("highcontrast")&&f.add(l.body(),"dj_a11y")});return e})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(g,h,f,b,e,d){g=b("dijit._OnDijitClickMixin",null,{connect:function(b,a,e){return this.inherited(arguments,[b,"ondijitclick"==a?d:a,e])}});g.a11yclick=d;return g})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/number dojo/dom dojo/dom-construct dojo/dom-style dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/HeatmapRenderer ../symbols/SimpleMarkerSymbol ../symbols/PictureFillSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/number".split(" "),
function(g,h,f,b,e,d,l,a,y,n,s,E,r,c,p,t,x,C,u,w,z,H,A,I,L,P,K,F,S,T,U,V,R,W,Y,X){var Q=h([W,t],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,reZeros:RegExp("\\"+X.decimal+"0+$","g"),reZerosFractional:RegExp("(\\d)0*$","g"),_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){f.mixin(this,Y.widgets.legend);a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=
!1===a.respectCurrentMapScale?!1:!0,this.arrangement=a.arrangement===Q.ALIGN_RIGHT?Q.ALIGN_RIGHT:Q.ALIGN_LEFT,this.arrangement===Q.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[]):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],g.locale&&
-1!==g.locale.indexOf(c)&&(-1!==g.locale.indexOf("-")?-1!==g.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>a("ie")&&(this._repaintItems=f.hitch(this,this._repaintItems),
setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],b.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],
a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)c.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],b.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&
(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],c=[];b.forEach(this.map.layerIds,function(k){k=this.map.getLayer(k);
var B;this._isSupportedLayerType(k)&&(k.arcgisProps&&k.arcgisProps.title&&(k._titleForLegend=k.arcgisProps.title),this.layers.push(k));"esri.layers.KMLLayer"==k.declaredClass&&(B=k.getLayers(),b.forEach(B,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==k.declaredClass&&(B=k.getFeatureLayers(),b.forEach(B,function(a){c.push(a.id)},this))},this);b.forEach(this.map.graphicsLayerIds,function(k){var B=this.map.getLayer(k);-1==b.indexOf(a,k)&&-1==b.indexOf(c,k)&&(this._isSupportedLayerType(B)&&
B._params&&B._params.drawMode)&&(B.arcgisProps&&B.arcgisProps.title&&(B._titleForLegend=B.arcgisProps.title),this.layers.push(B))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=e.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=e.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=e.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=
e.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),b.forEach(this.layers,function(a){a.ovcConnect=e.connect(a,"onVisibilityChange",this,"_refreshLayers");a.oscConnect=e.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(a.odcConnect=e.connect(a,"_onDynamicLayersChange",f.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(a.oirConnect=e.connect(a,
"onRenderingChange",f.partial(this._updateImageServiceLayers,this,a)))},this))},_deactivate:function(){this._ozeConnect&&e.disconnect(this._ozeConnect);this._olaConnect&&e.disconnect(this._olaConnect);this._olroConnect&&e.disconnect(this._olroConnect);this._olrConnect&&e.disconnect(this._olrConnect);b.forEach(this.layers,function(a){a.ovcConnect&&e.disconnect(a.ovcConnect);a.oscConnect&&e.disconnect(a.oscConnect);a.odcConnect&&e.disconnect(a.odcConnect);a.oirConnect&&e.disconnect(a.oirConnect)},this)},
_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];b.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);b.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&
this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1;p.set(this.domNode,"position","relative");c.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var v=[];b.forEach(this.layers,function(k){if("esri.layers.KMLLayer"==k.declaredClass||"esri.layers.GeoRSSLayer"==k.declaredClass){var d;k.loaded?("esri.layers.KMLLayer"==k.declaredClass?d=k.getLayers():"esri.layers.GeoRSSLayer"==k.declaredClass&&(d=k.getFeatureLayers(),
k._hideLayersInLegend&&(d=b.filter(d,function(a){return-1==b.indexOf(k._hideLayersInLegend,a.id)}))),b.forEach(d,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&k._titleForLegend&&(a._titleForLegend=k._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),v.push(a))},this)):e.connect(k,"onLoad",f.hitch(this,
function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===k.declaredClass)if(k.loaded){if(k.visible&&0<k.layerInfos.length&&b.some(k.layerInfos,function(a){return a.legendURL})){var G=!1;b.forEach(k.layerInfos,function(v){v.legendURL&&-1<b.indexOf(k.visibleLayers,v.name)&&(G||(c.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(k._titleForLegend||k.name||k.id)+"\x3c/span\x3e"},this.domNode),G=!0),c.create("div",{innerHTML:"\x3cimg src\x3d'"+v.legendURL+"'/\x3e"},
this.domNode),a=!0)},this)}}else e.connect(k,"onLoad",f.hitch(this,function(){this.refresh(this.layerInfos)}));else v.push(k)},this);var k=[];b.forEach(v,function(a){if(a.loaded){if(!0===a.visible&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=c.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});c.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",
{},c.create("tbody",{},c.create("table",{width:"95%"},b)))));c.place(b,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):k.push(this._legendRequest(a))}}else var M=e.connect(a,"onLoad",this,function(a){e.disconnect(M);M=null;this.refresh()})},this);0===k.length&&!a?(r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new n(k)).addCallback(f.hitch(this,function(b){a?r.byId(this.id+"_msg").innerHTML="":r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},
_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var c=!1;if(a.legendResponse){var k=a.dynamicLayerInfos||a.layerInfos;k&&k.length?b.forEach(k,function(k,d){if(!a._hideLayersInLegend||-1==b.indexOf(a._hideLayersInLegend,k.id)){var e=this._buildLegendItems(a,k,d);c=c||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(c=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(k=a.url?a.url.substring(a.url.lastIndexOf("/")+
1,a.url.length):"fc_"+a.id,c=this._buildLegendItems(a,{id:k,name:null,subLayerIds:null,parentLayerId:-1},0));c&&(p.set(r.byId(this.id+"_"+a.id),"display","block"),p.set(r.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);e.connect(a,"onLoad",f.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";
(c=a._getToken())&&(b+="?token\x3d"+c);var d=f.hitch(this,"_processLegendResponse"),c={f:"json"};a._params.dynamicLayers&&(c.dynamicLayers=s.stringify(this._createDynamicLayers(a)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));a._params.bandIds&&(c.bandIds=a._params.bandIds);a._params.renderingRule&&(c.renderingRule=a._params.renderingRule);return H({url:b,content:c,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:z.defaults.io.errorHandler})},_legendRequestTools:function(b){var c=
b.url.toLowerCase().indexOf("/rest/"),c=b.url.substring(0,c)+b.url.substring(c+5,b.url.length),c=this._legendUrl+"?soapUrl\x3d"+window.escape(c);if(!a("ie")||8<a("ie"))c+="\x26returnbytes\x3dtrue";var k=f.hitch(this,"_processLegendResponse");return H({url:c,content:{f:"json"},callbackParamName:"callback",load:function(a,c){k(b,a,c)},error:z.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,r.byId(this.id+"_"+a.id)&&c.empty(r.byId(this.id+"_"+a.id)),c.create("span",
{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},r.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+d.toJson(b))},_buildLegendItems:function(a,b,k){var d=!1,e=r.byId(this.id+"_"+a.id),f=b.parentLayerId;if(b.subLayerIds)a=c.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==
f?0<k?"esriLegendGroupLayer":"":this._legendAlign},-1==f?e:r.byId(this.id+"_"+a.id+"_"+f+"_group")),c.create("td",{innerHTML:b.name,align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return d;k=c.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<f?this._legendAlign:""},-1==f?e:r.byId(this.id+"_"+a.id+"_"+f+"_group"));c.create("td",
{innerHTML:b.name||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},k))));a.legendResponse?d=d||this._buildLegendItems_Tools(a,b,k):a.renderer&&(d=d||this._buildLegendItems_Renderer(a,b,k))}return d},_buildLegendItems_Tools:function(a,v,k){var d=v.parentLayerId,e=this.map.getScale(),f=!1,g=function(a,b){var c,M;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(M=0;M<b.dynamicLayerInfos[M].length;M++){if(b.dynamicLayerInfos[M].mapLayerId==
a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,v,e)){var D=!0;if("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass){var h=this._getEffectiveScale(a,v);if(h.minScale&&h.minScale<e||h.maxScale&&h.maxScale>e)D=!1}if(D){var e=g(a.legendResponse.layers,v),m=e.legendType,l=e.legend;if(l){k=c.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},k);var n=c.create("tbody",{},k);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(k,a,v);b.forEach(l,function(b){if(!(10.1<=a.version&&!b.values&&1<l.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===b.label||!b.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version))))if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)f=!0,this._buildRow_Tools(b,n,a,v.id,m)},this)}}}f&&(p.set(r.byId(this.id+"_"+
a.id+"_"+v.id),"display","block"),-1<d&&(p.set(r.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,a,d)));return f},_buildRow_Tools:function(b,v,k,d,e){var f=c.create("tr",{},v),g;this.alignRight?(v=c.create("td",{align:this._isRightToLeft?"left":"right"},f),g=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},f)):(g=c.create("td",{width:35},f),v=c.create("td",{},f));f=b.url;(!a("ie")||9<=a("ie")||9>a("ie")&&"esri.layers.ArcGISImageServiceLayer"===
k.declaredClass)&&b.imageData&&0<b.imageData.length?f="data:image/png;base64,"+b.imageData:0!==b.url.indexOf("http")&&(f=k.url+"/"+d+"/images/"+b.url,(d=k._getToken())&&(f+="?token\x3d"+d));d=c.create("img",{src:f,border:0,style:"opacity:"+k.opacity},g);b=c.create("td",{innerHTML:b.label,align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%",dir:"ltr"},v))));e&&("Stretched"===e&&10.3<=k.version&&"esri.layers.ArcGISImageServiceLayer"===k.declaredClass)&&(b.style.verticalAlign=
"top",b.style.lineHeight="1",d.style.marginBottom="-1px",d.style.display="block",v.style.verticalAlign="top");9>a("ie")&&(d.style.filter="alpha(opacity\x3d"+100*k.opacity+")")},_getVariable:function(a,c){return a?a[c]||b.filter(a.visualVariables,function(a){return a.type===c})[0]:null},_buildLegendItems_Renderer:function(a,d,k){var e=d.parentLayerId,g=this.map,G=g.getScale(),J=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,d,G)){var h,q,m=a.renderer,l,n,N,O,t;if(m instanceof K&&(m=(m=
"zoom"===m.rangeType?m.getRendererInfoByZoom(g.getZoom()):m.getRendererInfoByScale(G))&&m.renderer,!m))return!1;var g=this._getVariable(m,"colorInfo"),G=this._getVariable(m,"opacityInfo"),s=this._getVariable(m,"sizeInfo");g?(l=this._getMedianColor(m,g),g.field&&(N=f.isFunction(g.field)?null:a._getField(g.field,!0))):G&&(t=f.isFunction(G.field)?null:a._getField(G.field,!0));s&&s.field&&(O=f.isFunction(s.field)?null:a._getField(s.field,!0));if(m instanceof T)J=!0,this._showHeatRamp(a,d,m,k);else if(m instanceof
F)J=!0,this._showDotDensityLegend(a,d,m,k);else if(m instanceof S)J=!0,q=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),h=c.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,d),m.latestObservationRenderer&&m.latestObservationRenderer instanceof I&&this._buildRow_Renderer(a,m.latestObservationRenderer.symbol,l,m.latestObservationRenderer.label||this.NLS_currentObservations,null,h),m.observationRenderer&&m.observationRenderer instanceof
I&&this._buildRow_Renderer(a,m.observationRenderer.symbol,l,m.observationRenderer.label||this.NLS_previousObservations,null,h);else if(m instanceof L){if(m.infos&&0<m.infos.length){J=!0;q=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k);h=c.create("tbody",{},q);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,d);var u=[];b.forEach(m.infos,function(c){var d=null;a._editable&&a.types&&(d=this._getTemplateFromTypes(a.types,c.value));var k=c.label;null==
k&&(k=c.value);-1===b.indexOf(u,k)&&(u.push(k),this._buildRow_Renderer(a,c.symbol,l,k,d,h))},this)}}else m instanceof P?m.infos&&0<m.infos.length&&(J=!0,q=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),h=c.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,d),b.forEach(m.infos,function(b){var c=b.label;null==c&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,l,c,null,h)},this)):m instanceof I&&(J=!0,q=c.create("table",
{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),h=c.create("tbody",{},q),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(q,a,d),n=null,a._editable&&(a.templates&&0<a.templates.length)&&(n=a.templates[0]),q=(N||t)&&O?null:N||t||O,this._buildRow_Renderer(a,m.symbol,l,q?q.alias||q.name:m.label,n,h),n=m.symbol&&m.symbol.color,q&&(N=t=O=null));J&&(g&&g.field?(N&&this._isSmartRenderer(m,N.name)&&(N=null),this._showColorRamp(a,d,m,null,k,g,N)):G&&n&&this._showColorRamp(a,
d,m,n,k,G,t),s&&s.field&&(O&&this._isSmartRenderer(m,O.name)&&(O=null),this._showSizeLegend(a,d,m,s,l,k,O)));!a._hideDefaultSymbol&&m.defaultSymbol&&(J=!0,q=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},k),h=c.create("tbody",{},q),this._buildRow_Renderer(a,m.defaultSymbol,null,m.defaultLabel||"others",null,h))}J&&(p.set(r.byId(this.id+"_"+a.id+"_"+d.id),"display","block"),-1<e&&(p.set(r.byId(this.id+"_"+a.id+"_"+e+"_group"),"display","block"),this._findParentGroup(a.id,
e)));return J},_isSmartRenderer:function(a,b){return a instanceof P&&a.infos&&1===a.infos.length&&a.attributeField===b},_showColorRamp:function(a,b,d,e,f,g,h){var D;D=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},f);f=c.create("tbody",{},D);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(D,a,b);h&&this._addSubHeader(f,h.alias||h.name);b=this._getRampStops(d,g,e);b.length&&this._drawColorRamp(f,b,a)},_getMedianColor:function(a,b){var c,d;b.colors?(c=
b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,c,d){var e,f,g,h,D=!1;c.colors||c.opacityValues?(f=c.maxDataValue-c.minDataValue,e=b.map([0,0.25,0.5,0.75,1],function(a){g=c.minDataValue+a*f;return Number(g.toFixed(6))}),this._checkPrecision(0,4,e)):c.stops&&(e=b.map(c.stops,function(a){return a.value}),(D=b.some(c.stops,function(a){return!!a.label}))&&(h=b.map(c.stops,function(a){return a.label})));
var q=e[0],m,n,p;f=e[e.length-1]-q;return b.map(e,function(b,g){d?(m=new l(d.toRgba()),n=a.getOpacity(b,{opacityInfo:c}),null!=n&&(m.a=n)):m=a.getColor(b,{colorInfo:c});p="";0===g?p="\u2264 ":g===e.length-1&&(p="\u2265 ");return{value:b,color:m,offset:1-(b-q)/f,label:D?h[g]:p+E.format(b,{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"")}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],f=c[d],g=c[b],h=Math.floor(e),q=Math.floor(f),m=Math.floor(g);
h===e&&(m===g&&q!==f&&h!==q&&m!==q)&&(c[d]=q);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_drawColorRamp:function(d,v,k){var e=c.create("tr",{},d),f,g,h,D,q,m,n;this.alignRight?(d=c.create("td",{align:this._isRightToLeft?"left":"right"},e),f=c.create("td",{align:this._isRightToLeft?"left":"right",width:34},e)):(f=c.create("td",{width:34,align:"center"},e),d=c.create("td",{},e));g=c.create("div",{style:"position: relative; width:34px;"},f);h=c.create("div",{"class":"esriLegendColorRamp"},
g);e=p.get(h,"width");f=p.get(h,"height");p.set(g,"height",f+"px");h=x.createSurface(h,e,f);9>a("ie")&&(q=h.getEventSource(),p.set(q,"position","relative"),p.set(q.parentNode,"position","relative"));try{m=h.createRect({width:e,height:f}),m.setFill({type:"linear",x1:0,y1:0,x2:0,y2:f,colors:v}).setStroke(null),h.createRect({width:e,height:f}).setFill(new l([255,255,255,1-k.opacity])).setStroke(null),this._surfaceItems.push(h)}catch(r){h.clear(),h.destroy()}D=c.create("div",{"class":"esriLegendColorRampLabels"},
d);b.forEach(v,function(a,b){a.label&&(n="top:"+100*a.offset+"%;",c.create("div",{"class":"esriLegendColorRampTick"+(b===v.length-1?" esriLegendColorRampTickLast":""),innerHTML:"\x26nbsp;",style:n},g),c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:a.label,style:n},D))})},_showHeatRamp:function(a,b,d,e){var f,g=d.field;f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=c.create("tbody",{},f);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,
a,b);(g=g&&a.getField(g))&&this._addSubHeader(e,g.alias||g.name);b=this._getHeatmapStops(d);b.length&&this._drawColorRamp(e,b,a)},_getHeatmapStops:function(a){var c=a.colorStops;a=a.colors;var d,e,f,g;if(c&&c[0])if(d=c.length-1,a=c[0]&&null!=c[0].ratio){if((a=c[d])&&1!==a.ratio)c=c.slice(0),c.push({ratio:1,color:a.color}),d++}else e=c[0].value,f=c[d].value-e,c=b.map(c,function(a){return{color:a.color,ratio:(a.value-e)/f}});else a&&a[0]&&(d=a.length-1,g=1/(a.length-1),c=b.map(a,function(a,b){return{color:a,
ratio:b*g}}));c=b.map(c,function(a,b){var c="";0===b?c="Low":b===d&&(c="High");return{color:a.color,label:c,offset:1-a.ratio}});return c.reverse()},_showDotDensityLegend:function(a,d,k,e){var g=k.legendOptions,h,l,n,q,m,p,r,s=this.dotDensitySwatchSize,t=Math.round(s/2);g&&(l=g.backgroundColor,n=g.outline,q=g.valueUnit,m=g.dotCoverage);m=(m||this.dotCoverage)/100;r=Math.round(s*s/Math.pow(k.dotSize,2)*m);e=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);p=c.create("tbody",
{},e);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(e,a,d);this._addSubHeader(p,A.substitute({value:k.dotValue,unit:q||""},this.NLS_dotValue));b.forEach(k.fields,function(b){b=f.mixin({},b);b.numPoints=r;h=new V(k._generateImageSrc(s,s,[b],{x:0,y:0},{x:s,y:s},l),n||k.outline,s,s);b=a._getField(b.name,!0)||b;this._buildRow_Renderer(a,h,null,b.alias||b.name,null,p,{type:"path",path:"M "+-t+","+-t+" L "+t+","+-t+" L "+t+","+t+" L "+-t+","+t+" L "+-t+","+-t+" E"})},this)},_showSizeLegend:function(a,
d,k,e,f,g,h){var l=e.legendOptions,l=l&&l.customValues,q,m=e.minDataValue,n=e.maxDataValue,p=this._getSizeSymbol(k,f);"unknown"!==e.valueUnit||(!p||!l&&(null==m||null==n))||(f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),q=c.create("tbody",{},f),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,a,d),h&&this._addSubHeader(q,h.alias||h.name),d=l||this._getDataValues(m,n),b.forEach(d,function(b){p=R.fromJson(p.toJson());this._applySize(p,k,e,b);b=E.format(b,
{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"");this._buildRow_Renderer(a,p,null,b,null,q)},this))},_getSizeSymbol:function(a,b){var c,d;if(a instanceof I)d=!0,c=a.symbol;else if(a instanceof L||a instanceof P)c=a.infos[0].symbol;if(c=-1!==c.type.indexOf("fillsymbol")?null:c)!d&&"picturemarkersymbol"===c.type?(c=new U,c.setStyle("square"),c.outline.setWidth(1)):c=R.fromJson(c.toJson()),b?c.setColor(new l(b.toRgba())):d||c.setColor(new l([127,127,127]));return c},
_applySize:function(a,b,c,d){var e=a.type;c={sizeInfo:c,shape:-1!==e.indexOf("markersymbol")?a.style:null};b=b.getSize(d,c);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":a.setWidth(b);a.setHeight(b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b)}},_getDataValues:function(a,c){var d=[a,c],e=Math.LN10,f=Math.log(a),g=Math.log(c),h,l,n,m,p;b.forEach([1,2.5,5],function(a){m=Math.log(a);h=Math.ceil((f-m)/e);l=Math.floor((g-m)/e);if(!(Infinity===
Math.abs(h)||Infinity===Math.abs(l)))for(n=h;n<l+1;n++)p=a*Math.pow(10,n),-1===b.indexOf(d,p)&&d.push(p)});d.sort(this._sorter);return d.reverse()},_sorter:function(a,b){return a-b},_buildRow_Renderer:function(a,b,d,e,f,g,h){var l=c.create("tr",{},g),n;this.alignRight?(g=c.create("td",{align:this._isRightToLeft?"left":"right"},l),n=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},l)):(n=c.create("td",{width:35,align:"center"},l),g=c.create("td",{},l));var m=l=30;"simplemarkersymbol"==
b.type?(l=Math.min(Math.max(l,b.size+12),125),m=Math.min(Math.max(m,b.size+12),125)):"picturemarkersymbol"==b.type&&(l=Math.min(Math.max(l,b.width),125),m=Math.min(b.height||m,125));n=c.create("div",{style:"width:"+l+"px;height:"+m+"px;"},n);A.isDefined(e)&&"number"===typeof e&&(e=""+e);c.create("td",{innerHTML:e||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},g))));a=this._drawSymbol(n,b,d,l,m,f,a,h);this._surfaceItems.push(a)},_addSubHeader:function(a,
b){var d=c.create("tr",{},a),d=c.create("td",{align:this._align,colspan:2},d);c.create("td",{innerHTML:b||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},d))))},_drawSymbol:function(b,c,d,e,g,h,n,r){c=R.fromJson(c.toJson());var q=n.opacity;d&&c.setColor(new l(d.toRgba()));if("simplelinesymbol"===c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=q;c.color.setColor(d)}else if("simplemarkersymbol"===
c.type||"simplefillsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=q;c.color.setColor(d);c.outline&&c.outline.color&&(d=c.outline.color.toRgba(),d[3]*=q,c.outline.color.setColor(d))}else"picturemarkersymbol"===c.type&&(b.style.opacity=q,b.style.filter="alpha(opacity\x3d("+100*q+"))");b=x.createSurface(b,e,g);9>a("ie")&&(d=b.getEventSource(),p.set(d,"position","relative"),p.set(d.parentNode,"position","relative"));h=this._getDrawingToolShape(c,h)||R.getShapeDescriptors(c);var m;try{m=
b.createShape(r||h.defaultShape).setFill(h.fill).setStroke(h.stroke)}catch(t){b.clear();b.destroy();return}var s=m.getBoundingBox();r=s.width;h=s.height;var q=-(s.x+r/2),u=-(s.y+h/2);d=b.getDimensions();q={dx:q+d.width/2,dy:u+d.height/2};if("simplemarkersymbol"===c.type&&"path"===c.style)e=n._getScaleMatrix(s,c.size),m.applyTransform(C.scaleAt(e.xx,e.yy,{x:d.width/2,y:d.height/2}));else if(r>e||h>g)n=r/e>h/g,e=((n?e:g)-5)/(n?r:h),f.mixin(q,{xx:e,yy:e});m.applyTransform(q);return b},_getDrawingToolShape:function(a,
b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",
cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){b.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(c){}a.children&&f.isArray(a.children)&&b.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,d){var g=b._hoverLabel||b._hoverLabels[d.id];g&&(b.mouseMoveHandler=
b.mouseMoveHandler||{},b.mouseMoveHandler[d.id]=e.connect(a,"onmousemove",f.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(r.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(f.hitch(this,function(a,b,d){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,r.byId(this.id+"_hoverLabel")){var e=r.byId(this.id+"_hoverLabel");e.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";p.set(e,"top",
b+"px");p.set(e,"left",a+15+"px");p.set(e,"display","")}else c.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},g)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[d.id]=e.connect(a,"onmouseout",f.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(r.byId(this.id+"_hoverLabel"),"display","none"))})))},
_removeHoverHandlers:function(){var a;b.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)e.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)e.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var c=[],d;b.forEach(a.dynamicLayerInfos||a.layerInfos,function(b){d={id:b.id};d.source=b.source&&b.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[b.id]&&(e=a.layerDefinitions[b.id]);e&&(d.definitionExpression=
e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[b.id]&&(f=a.layerDrawingOptions[b.id]);f&&(d.drawingInfo=f.toJson());d.minScale=b.minScale||0;d.maxScale=b.maxScale||0;c.push(d)});return c},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(p.set(r.byId(this.id+
"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function c(d,e){var f=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,h;for(g=0;g<f.length;g++)if(f[g].id===d&&f[g].subLayerIds)for(h=0;h<f[g].subLayerIds.length;h++){var l=f[g].subLayerIds[h];-1===b.indexOf(e,l)&&(e.push(l),c(l,e))}}a.layer.layerInfos&&b.forEach(a.layer._hideLayersInLegend,function(b){c(b,a.layer._hideLayersInLegend)})},_isLayerInScale:function(a,
b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];if(b.id==f.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,h=Math.max(a.maxScale,f.maxScale));if(0<g&&g<c||h>c)e=!1;break}}else if(a.minScale||
a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));return u.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(A.isDefined(b.parentLayerId)){var e=a.layerInfos,f=b.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0==c&&0<e[g].minScale?c=e[g].minScale:0<c&&0==e[g].minScale||0<c&&0<e[g].minScale&&(c=Math.min(c,e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&
("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});f.mixin(Q,{ALIGN_LEFT:0,ALIGN_RIGHT:1});
a("extend-esri")&&f.setObject("dijit.Legend",Q,w);return Q});